!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():t()}(this,function(){"use strict";var e={sd:null,lib_version:"0.0.3",para:{},default_para:{url:"",path:"",project_key:"",timeout_milliseconds:3e3,update_interval:6e5,collect_bridge_status:!0,session_limit:6e5},value_type_list:["Number","String","Object","Boolean"],state:{platform:"",storage:{isSupport:!0,name:"sawebjssdkabtest"}},bridgeState:"",localdata:{},originalData:[],triggerList:{},updateTime:null},t={},i=Array.prototype,r=Object.prototype,a=i.slice,s=r.toString,n=r.hasOwnProperty,o=i.forEach,l=Array.isArray,c={};return t.each=function(e,i,r){if(null==e)return!1;if(o&&e.forEach===o)e.forEach(i,r);else if(t.isArray(e)&&e.length===+e.length){for(var a=0,s=e.length;a<s;a++)if(a in e&&i.call(r,e[a],a,e)===c)return!1}else for(var l in e)if(n.call(e,l)&&i.call(r,e[l],l,e)===c)return!1},t.extend=function(e){return t.each(a.call(arguments,1),function(t){for(var i in t)n.call(t,i)&&void 0!==t[i]&&(e[i]=t[i])}),e},t.isArray=l||function(e){return"[object Array]"===s.call(e)},t.isObject=function(e){return null!=e&&"[object Object]"==s.call(e)},t.isElement=function(e){return!(!e||1!==e.nodeType)},t.isString=function(e){return"[object String]"==s.call(e)},t.isBoolean=function(e){return"[object Boolean]"==s.call(e)},t.isNumber=function(e){return"[object Number]"==s.call(e)&&/[\d\.]+/.test(String(e))},t.unique=function(e){for(var t,i=[],r={},a=0;a<e.length;a++)t=e[a],t in r||(r[t]=!0,i.push(t));return i},t.decodeURIComponent=function(e){var t=e;try{t=decodeURIComponent(e)}catch(i){t=e}return t},t.getQueryParam=function(e,i){i=i.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=t.decodeURIComponent(e);var r="[\\?&]"+i+"=([^&#]*)",a=new RegExp(r),s=a.exec(e);return null===s||s&&"string"!=typeof s[1]&&s[1].length?"":t.decodeURIComponent(s[1])},t.indexOf=function(e,t){var i=e.indexOf;if(i)return i.call(e,t);for(var r=0;r<e.length;r++)if(t===e[r])return r;return-1},t.isFunction=function(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object Function]"==t||"[object AsyncFunction]"==t},t.isEmptyObject=function(e){if(t.isObject(e)){for(var i in e)if(n.call(e,i))return!1;return!0}return!1},t.map=function(e,i){var r=[];return null==e?r:Array.prototype.map&&e.map===Array.prototype.map?e.map(i):(t.each(e,function(e,t,a){r.push(i(e,t,a))}),r)},t.base64Decode=function(e){var i=t.map(atob(e).split(""),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)});return decodeURIComponent(i.join(""))},t.getURLSearchParams=function(e){e=e||"";for(var t=function(e){return decodeURIComponent(e)},i={},r=e.substring(1),a=r.split("&"),s=0;s<a.length;s++){var n=a[s].indexOf("=");if(n!==-1){var o=a[s].substring(0,n),l=a[s].substring(n+1);o=t(o),l=t(l),i[o]=l}}return i},t.urlParse=function(e){var i=function(e){this._fields={Username:4,Password:5,Port:7,Protocol:2,Host:6,Path:8,URL:0,QueryString:9,Fragment:10},this._values={},this._regex=null,this._regex=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/,"undefined"!=typeof e&&this._parse(e)};return i.prototype.setUrl=function(e){this._parse(e)},i.prototype._initValues=function(){for(var e in this._fields)this._values[e]=""},i.prototype.addQueryString=function(e){if("object"!=typeof e)return!1;var t=this._values.QueryString||"";for(var i in e)t=new RegExp(i+"[^&]+").test(t)?t.replace(new RegExp(i+"[^&]+"),i+"="+e[i]):"&"===t.slice(-1)?t+i+"="+e[i]:""===t?i+"="+e[i]:t+"&"+i+"="+e[i];this._values.QueryString=t},i.prototype.getUrl=function(){var e="";return e+=this._values.Origin,e+=this._values.Port?":"+this._values.Port:"",e+=this._values.Path,e+=this._values.QueryString?"?"+this._values.QueryString:"",e+=this._values.Fragment?"#"+this._values.Fragment:""},i.prototype.getUrl=function(){var e="";return e+=this._values.Origin,e+=this._values.Port?":"+this._values.Port:"",e+=this._values.Path,e+=this._values.QueryString?"?"+this._values.QueryString:""},i.prototype._parse=function(e){this._initValues();var i=this._regex.exec(e);i||t.log("DPURLParser::_parse -> Invalid URL");for(var r in this._fields)"undefined"!=typeof i[this._fields[r]]&&(this._values[r]=i[this._fields[r]]);this._values.Hostname=this._values.Host.replace(/:\d+$/,""),this._values.Origin=this._values.Protocol+"://"+this._values.Hostname},new i(e)},t.URL=function(e){var i={},r=function(){var e;try{return e=new URL("http://modernizr.com/"),"http://modernizr.com/"===e.href}catch(t){return!1}};if("function"==typeof window.URL&&r())i=new URL(e),i.searchParams||(i.searchParams=function(){var e=t.getURLSearchParams(i.search);return{get:function(t){return e[t]}}}());else{var a=/^https?:\/\/.+/;a.test(e)===!1&&t.log("Invalid URL");var s=t.urlParse(e);i.hash="",i.host=s._values.Host?s._values.Host+(s._values.Port?":"+s._values.Port:""):"",i.href=s._values.URL,i.password=s._values.Password,i.pathname=s._values.Path,i.port=s._values.Port,i.search=s._values.QueryString?"?"+s._values.QueryString:"",i.username=s._values.Username,i.hostname=s._values.Hostname,i.protocol=s._values.Protocol?s._values.Protocol+":":"",i.origin=s._values.Origin?s._values.Origin+(s._values.Port?":"+s._values.Port:""):"",i.searchParams=function(){var e=t.getURLSearchParams("?"+s._values.QueryString);return{get:function(t){return e[t]}}}()}return i},t.getQueryParam=function(e,i){i=i.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=t.decodeURIComponent(e);var r="[\\?&]"+i+"=([^&#]*)",a=new RegExp(r),s=a.exec(e);return null===s||s&&"string"!=typeof s[1]&&s[1].length?"":t.decodeURIComponent(s[1])},t.isEmptyObject=function(e){if(t.isObject(e)){for(var i in e)if(n.call(e,i))return!1;return!0}return!1},t.contentLoaded=function(e,t){var i=!1,r=!0,a=e.document,s=a.documentElement,n=a.addEventListener,o=n?"addEventListener":"attachEvent",l=n?"removeEventListener":"detachEvent",c=n?"":"on",u=function(r){"readystatechange"==r.type&&"complete"!=a.readyState||(("load"==r.type?e:a)[l](c+r.type,u,!1),!i&&(i=!0)&&t.call(e,r.type||r))},h=function(){try{s.doScroll("left")}catch(e){return void setTimeout(h,50)}u("poll")};if("complete"==a.readyState)t.call(e,"lazy");else{if(!n&&s.doScroll){try{r=!e.frameElement}catch(p){}r&&h()}a[o](c+"DOMContentLoaded",u,!1),a[o](c+"readystatechange",u,!1),e[o](c+"load",u,!1)}},t.secCheck={isHttpUrl:function(e){if("string"!=typeof e)return!1;var i=/^https?:\/\/.+/;return i.test(e)!==!1||(t.log("Invalid URL"),!1)},removeScriptProtocol:function(e){if("string"!=typeof e)return"";for(var t=/^\s*javascript/i;t.test(e);)e=e.replace(t,"");return e}},t.addEvent=function(){function e(t){return t&&(t.preventDefault=e.preventDefault,t.stopPropagation=e.stopPropagation,t._getPath=e._getPath),t}function t(t,i,r){var a=function(a){if(a=a||e(window.event)){a.target=a.srcElement;var s,n,o=!0;return"function"==typeof r&&(s=r(a)),n=i.call(t,a),!1!==s&&!1!==n||(o=!1),o}};return a}e._getPath=function(){var e=this,t=function(){try{var t=e.target,i=[t];if(null===t||null===t.parentElement)return[];for(;null!==t.parentElement;)t=t.parentElement,i.unshift(t);return i}catch(r){return[]}};return this.path||this.composedPath&&this.composedPath()||t()},e.preventDefault=function(){this.returnValue=!1},e.stopPropagation=function(){this.cancelBubble=!0};var i=function(i,r,a){var s=!0;if(i&&i.addEventListener)i.addEventListener(r,function(t){t._getPath=e._getPath,a.call(this,t)},s);else{var n="on"+r,o=i[n];i[n]=t(i,a,o)}};i.apply(null,arguments)},t.addSinglePageEvent=function(e){var i=location.href,r=window.history.pushState,a=window.history.replaceState;window.history.pushState=function(){r.apply(window.history,arguments),e(i),i=location.href},window.history.replaceState=function(){a.apply(window.history,arguments),e(i),i=location.href};var s=r?"popstate":"hashchange";t.addEvent(window,s,function(){e(i),i=location.href})},e.verifyStore={valueType:function(e,i){switch(i){case"Number":if(t.isNumber(e))return!0;break;case"String":if(t.isString(e))return!0;break;case"Object":if(t.isObject(e))return!0;break;case"Boolean":if(e===!0||e===!1)return!0;break;default:return!1}return!1},para:function(i,r,a){var s={verify_success:!0,para:null};return t.each(a,function(a,n){if("essential"===a)switch(n){case"param_name":t.isString(r.param_name)&&r.param_name.length>0||(e.error(i+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cparam_name\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e\uff01param_name:",r.param_name),s.verify_success=!1);break;case"value_type":t.isString(r.value_type)&&t.indexOf(e.value_type_list,r.value_type)!==-1||(e.error(i+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cvalue_type\u914d\u7f6e\u9519\u8bef",r.value_type),s.verify_success=!1);break;case"default_value":"undefined"==typeof r.default_value?(e.error(i+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u53c2\u6570\u672a\u914d\u7f6e"),s.verify_success=!1):e.verifyStore.valueType(r.default_value,r.value_type)||(e.error(i+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u7c7b\u578b\u5fc5\u987b\u4e0evalue_type\u4e00\u81f4\uff01",r.default_value,r.value_type),s.verify_success=!1);break;case"callback":t.isFunction(r.callback)||(e.error(i+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0ccallback\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),s.verify_success=!1);break;default:s.verify_success=!1}else if("not_essential"===a)switch(n){case"timeout_milliseconds":r.timeout_milliseconds=r.timeout_milliseconds||e.para.timeout_milliseconds||e.default_para.timeout_milliseconds,(!t.isNumber(r.timeout_milliseconds)||t.isNumber(r.timeout_milliseconds)&&r.timeout_milliseconds<=0)&&(t.log("timeout_milliseconds \u53c2\u6570\u9519\u8bef",r.timeout_milliseconds),r.timeout_milliseconds=e.para.timeout_milliseconds),r.timeout_milliseconds<200&&(r.timeout_milliseconds=200);break;case"properties":r.properties=t.isObject(r.properties)?r.properties:{}}}),s.para=r,s}},e.getSA=function(e){return!!(t.isObject(e)&&t.isObject(e.readyState)&&e.readyState.state>=3)&&(this.sd=e,!0)},e.log=function(){if("object"==typeof console&&console.log){t.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]);try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}}},e.error=function(){if("object"==typeof console&&console.error)try{return console.error.apply(console,arguments)}catch(e){console.error(arguments[0])}},e.listenPageState=function(e){var i={visibleHandle:t.isFunction(e.visible)?e.visible:function(){},hiddenHandler:t.isFunction(e.hidden)?e.hidden:function(){},visibilityChange:null,hidden:null,isSupport:function(){return"undefined"!=typeof document[this.hidden]},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var e=this;document.addEventListener(e.visibilityChange,function(){document[e.hidden]?e.hiddenHandler():e.visibleHandle()},1)}else document.addEventListener?(window.addEventListener("focus",this.visibleHandle,1),window.addEventListener("blur",this.hiddenHandler,1)):(document.attachEvent("onfocusin",this.visibleHandle),document.attachEvent("onfocusout",this.hiddenHandler))}};i.init()},e.storage={set:function(t,i){e.state.storage.isSupport&&window.localStorage.setItem(i,JSON.stringify(t))},get:function(i){var r=null;e.state.storage.isSupport&&(r=window.localStorage.getItem(i));try{r=JSON.parse(r)}catch(a){t.log(a)}return r}},e.getStorageData=function(){return this.storage.get(e.state.storage.name)},e.setStorageData=function(t){this.storage.set(t,e.state.storage.name)},e.Mask=function(e){this.element=e,this.remove_timer=null,this.is_added=!1,this.is_abort=!1},e.Mask.prototype={show:function(e){var i=this,r=(new Date).getTime();return!!t.isElement(this.element)&&void t.contentLoaded(window,function(){if(i.is_abort)return!1;var a=document.getElementsByTagName("body")[0];if(t.isElement(a)&&(a.appendChild(i.element),i.is_added=!0,t.isNumber(e))){var s=(new Date).getTime()-r;e-=s,i.remove_timer=setTimeout(function(){i.remove()},e)}})},remove:function(){if(t.isElement(this.element)){if(this.is_abort||(this.is_abort=!0),this.is_added){this.is_added=!1;var e=document.getElementsByTagName("body")[0];if(!t.isElement(e))return;e.removeChild(this.element)}this.remove_timer&&(clearTimeout(this.remove_timer),this.remove_timer=null),this.element=null}}},e.asyncFetchABTest=function(){e.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},e.fastFetchABTest=function(){e.error("fastFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},e.fetchCacheABTest=function(){e.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},e.searchLocalExp=function(t){return e.localdata[t]?e.localdata[t]:null},e.getExpResult=function(i,r){var a=i.default_value,s=r?r:e.searchLocalExp(i.param_name);return t.isObject(s)?t.isObject(s.js_config)&&(s.js_config.type===i.value_type?(a=s.js_config.value,this.triggerHandle(s,i)):t.log("\u8bd5\u9a8c\u7ed3\u679c\u7c7b\u578b\u4e0e\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e0d\u4e00\u81f4\uff0cparam_name\uff1a"+i.param_name+"\uff0c\u5f53\u524d\u8fd4\u56de\u7c7b\u578b\u4e3a\uff1a"+s.js_config.type+"\uff0c\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e3a\uff1a"+i.value_type)):t.log("localdata\u672a\u67e5\u8be2\u5230\u8bd5\u9a8c\u6570\u636e\uff0c\u8bd5\u9a8c\u53c2\u6570\u540d\u79f0\uff1a"+i.param_name),a},e.resolveVariables=function(i){this.localdata={};var r=this;t.each(i,function(i){if(t.isObject(i)&&i.variables&&t.isArray(i.variables)){if(i.experiment_type&&"CODE"!==i.experiment_type)return!1;t.each(i.variables,function(a){t.isObject(a)&&!r.localdata[a.name]&&(r.localdata[a.name]={abtest_experiment_id:i.abtest_experiment_id,abtest_experiment_group_id:i.abtest_experiment_group_id,is_control_group:i.is_control_group,is_white_list:i.is_white_list,value:a.value,type:a.type,js_config:e.getRelativeValue(a.value,a.type)})})}})},e.getRelativeValue=function(e,i){var r={},a={INTEGER:function(e){var i=parseFloat(e);isNaN(i)?t.log("\u539f\u59cb\u6570\u636e INTEGER \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e):(r.value=i,r.type="Number")},STRING:function(e){t.isString(e)?(r.value=e,r.type="String"):t.log("\u539f\u59cb\u6570\u636e STRING \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e)},JSON:function(e){var i=JSON.parse(e);t.isObject(i)?(r.value=i,r.type="Object"):t.log("\u539f\u59cb\u6570\u636e JSON \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e)},BOOLEAN:function(e){"true"===e?(r.value=!0,r.type="Boolean"):"false"===e?(r.value=!1,r.type="Boolean"):t.log("\u539f\u59cb\u6570\u636e BOOLEAN \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e)}};try{a[i]?a[i](e):t.log("\u8bd5\u9a8c\u6570\u636e\u7c7b\u578b\u89e3\u6790\u5931\u8d25",i,e)}catch(s){t.log(s,e,i)}return r},e.link={isFirst:!0,start_time:null,mask_instance:null,is_filtered_out:!1,para:{timeout:500,use_mask:!1,pass_params:!0,control_link_search:"default",experiment_link_search:"default"},init:function(e){return this.initPara(e),this.para?t.getQueryParam(location.href,"saSDKMultilink")?(this.is_filtered_out=!0,!1):(this.start_time=(new Date).getTime(),this.para.use_mask&&this.initMask(),void this.addSinglePageListener()):(t.log("multilink is closed"),!1)},addSinglePageListener:function(){var i=this;t.addSinglePageEvent(function(r){return r!==location.href&&(i.is_filtered_out=!1,i.isFirst=!0,i.mask_instance&&i.mask_instance.remove(),t.getQueryParam(location.href,"saSDKMultilink")?(i.is_filtered_out=!0,!1):(i.start_time=(new Date).getTime(),i.para.use_mask&&i.initMask(),void i.resolve(e.originalData)))})},initMask:function(){var t=document.createElement("div");t.style.position="fixed",t.style.width="100%",t.style.height="100%",t.style.top="0px",t.style.left="0px",t.style.background="#fff",this.mask_instance=new e.Mask(t),this.mask_instance.show(this.para.timeout)},initPara:function(e){if(t.isFunction(e))try{e=e()}catch(i){return t.log("link para error!"),void(this.para=!1)}e===!1?this.para=!1:t.isObject(e)&&(this.para.timeout=t.isNumber(e.timeout)&&e.timeout<=5e3&&e.timeout>=0?e.timeout:500,this.para.use_mask=!!t.isBoolean(e.use_mask)&&e.use_mask,this.para.control_link_search=t.isString(e.control_link_search)?e.control_link_search:"default",this.para.experiment_link_search=t.isString(e.experiment_link_search)?e.experiment_link_search:"default",this.pass_params=!t.isBoolean(e.pass_params)||e.pass_params)},resolve:function(i){var r=this;if(!this.para)return!1;if(!t.isArray(i))return!1;if(this.is_filtered_out)return!1;if(!this.isFirst)return!1;if(this.isFirst=!1,0===this.para.timeout)return!1;if((new Date).getTime()-this.start_time>this.para.timeout)return t.log("The multilink was stopped because the request timeout"),!1;var a=!1;t.each(i,function(i){if(!t.isObject(i))return!1;if(a)return!1;if("LINK"!==i.experiment_type)return!1;if(r.isTriggerLinkExp(i)){a=!0;var s=e.triggerHandle(i);s?setTimeout(function(){r.redirectUrl(i)},80):setTimeout(function(){r.redirectUrl(i)},0)}}),!a&&this.para.use_mask&&this.mask_instance.remove()},stopTrigger:function(){this.isFirst=!1,t.log("The multilink was stopped because the request failed"),this.para.use_mask&&this.mask_instance.remove()},isTriggerLinkExp:function(e){return t.isString(e.control_link)&&t.isString(e.link_match_type)?!!this.checkUrlIsMatch(e.control_link,e.link_match_type)||(t.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",e.abtest_experiment_id),!1):(t.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u6570\u636e\u5f02\u5e38",e.abtest_experiment_id),!1)},checkUrlIsMatch:function(e,i){var r,a;if("STRICT"===i)return location.href===e;if("FUZZY"===i){try{r=t.URL(location.href)}catch(s){return t.log("url \u89e3\u6790\u5931\u8d25",s),!1}try{a=t.URL(e)}catch(s){return t.log("control_url \u89e3\u6790\u5931\u8d25",s),!1}return r.host===a.host&&r.pathname===a.pathname}return t.log("link_match_type\u5b57\u6bb5\u5f02\u5e38",i),!1},redirectUrl:function(e){function i(e){return t.secCheck.isHttpUrl(e)?t.secCheck.removeScriptProtocol(e):(t.log("\u975e\u6cd5URL"),!1)}if(!e.experiment_link||!t.isString(e.experiment_link))return void t.log("\u9875\u9762\u8df3\u8f6c\u5931\u8d25\uff0cexperiment_link\u5b57\u6bb5\u5f02\u5e38",e.abtest_experiment_id);if(e.is_control_group!==!0||"STRICT"!==e.link_match_type){var r;if(this.para.pass_params){var a=this.getMergedUrl(e.experiment_link,location.href,e.is_control_group);r=i(a)}else r=i(e.experiment_link);r&&(location.href=r)}},getMergedUrl:function(e,i,r){function a(e){var t=/([^?#]+)(\?[^#]*)?(#.*)?/,i=t.exec(e);if(i){var r=i[1]||"",a=i[2]||"",s=i[3]||"";return{host:r,search:a,hash:s}}}function s(e){var i={hash:"",search:""};if(!t.isString(e))return i;var r=e.indexOf("?");return r>-1?(i.search=e.slice(r),i.hash=e.slice(0,r)):i.hash=e,i}var n="",o="",l="",c={parse_url:null,search:""},u={parse_url:null,search:"",hash:""};return c.parse_url=a(i),c.parse_url?(u.parse_url=a(e),u.parse_url?("after_hash"===this.para.control_link_search?c.search=s(c.parse_url.hash).search:c.search=c.parse_url.search,r?"after_hash"===this.para.control_link_search?(u.search=s(u.parse_url.hash).search,u.hash=s(u.parse_url.hash).hash):u.search=u.parse_url.search:"after_hash"===this.para.experiment_link_search?(u.search=s(u.parse_url.hash).search,u.hash=s(u.parse_url.hash).hash):u.search=u.parse_url.search,o=this.getSearchStr(c.search,u.search),r&&"after_hash"===this.para.control_link_search||!r&&"after_hash"===this.para.experiment_link_search?n=u.hash.length>0?u.parse_url.host+u.parse_url.search+u.hash+o:u.parse_url.search.length>0?u.parse_url.host+u.parse_url.search+"&"+o.substring(1):u.parse_url.host+o:(l="after_hash"===this.para.control_link_search?u.parse_url.hash:u.parse_url.hash||c.parse_url.hash,n=u.parse_url.host+o+l),n):void t.log("url \u89e3\u6790\u5931\u8d25",e)):void t.log("url \u89e3\u6790\u5931\u8d25",i)},getSearchStr:function(e,i){function r(e){var t={};if(!e.length||0!==e.indexOf("?"))return t;if(e=e.slice(1),!e.length)return t;for(var i=e.split("&"),r=0;r<i.length;r++)if(i[r].indexOf("=")<0)t[i[r]]=null;else{var a=i[r].split("=");t[a[0]]=a[1]}return t}var a=r(e),s=r(i),n=t.extend(a,s),o="";if(t.isEmptyObject(n))return"?saSDKMultilink=true";var l=!0;for(var c in n)l?(o+="?",l=!1):o+="&",null!==n[c]?o=o+c+"="+n[c]:o+=c;return o+="&saSDKMultilink=true"}},e.bridgeStore={init:function(i){return!!this.setPara(i)&&(t.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f"),e.state.storage.name="sawebjssdkabtest_bridge",e.abBridge=new e.sd.JSBridge({type:"abtest",app_call_js:function(e){try{e=t.base64Decode(e)}catch(i){t.log("App\u6570\u636ebase64\u89e3\u7801\u5f02\u5e38",e)}try{e=JSON.parse(e),e.message_id&&this["double"](e)}catch(i){t.log("App\u6570\u636e\u89e3\u6790\u5f02\u5e38",e)}}}),t.isObject(window.SensorsData_iOS_JS_Bridge)&&window.SensorsData_iOS_JS_Bridge.sensorsdata_abtest_module&&e.abBridge.hasAppBridge()?e.bridgeState="ab_bridge_ok":t.isObject(window.SensorsData_APP_New_H5_Bridge)&&t.isFunction(window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module)&&window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module()&&e.abBridge.hasAppBridge()?e.bridgeState="ab_bridge_ok":e.bridgeState="ab_no_abtest_bridge",void e.store.init(this.getResultFromApp,this))},setPara:function(i){var r=e.verifyStore.para("\u6253\u901a\u521d\u59cb\u5316",i,{timeout_milliseconds:"not_essential"});return e.para=t.extend({},e.default_para,r.para),t.isBoolean(e.para.collect_bridge_status)||(e.para.collect_bridge_status=!0),t.isNumber(e.para.update_interval)||(e.para.update_interval=6e5),!0},getResultFromApp:function(i){function r(){"ab_bridge_ok"===e.bridgeState?e.abBridge.requestToApp({data:{properties:a.properties,timeout:o,request_body:{origin_platform:"H5"}},callback:function(i){t.isObject(i)&&t.isObject(i.data)?(t.log("\u6210\u529f\u83b7\u53d6\u5230 App \u7aef\u8fd4\u56de\u7684\u8bd5\u9a8c\u6570\u636e","data:",i),e.dealResponseData(i.data),s&&s(i)):(t.log("App \u7aef\u8bf7\u6c42\u5931\u8d25"),n&&n()),e.fetchData.setNextFetch()},timeout:{time:o,callback:function(){t.log("\u83b7\u53d6App\u7aef\u6570\u636e\u5931\u8d25"),n&&n(),e.fetchData.setNextFetch()}}}):n&&(t.log("A/B Testing \u6253\u901a\u5931\u8d25\uff0c",e.bridgeState),n())}i=t.isObject(i)?i:{};var a=i.para||{},s=i.suc,n=i.err,o=a.timeout_milliseconds||e.para.timeout_milliseconds;t.log("\u5411App\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),r()},asyncFetch:function(i){e.bridgeStore.getResultFromApp({para:i,suc:function(r){if(t.isObject(r.properties)&&(i.properties=t.extend(r.properties,i.properties)),"SUCCESS"===r.data.status){var a=e.getExpResult(i);i.callback(a)}else i.callback(i.default_value)},err:function(){i.callback(i.default_value)}})}},e.bridgeStore.methods={asyncFetchABTest:function(i){if(!t.isObject(i))return e.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var r=e.verifyStore.para("asyncFetchABTest",i,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});r.verify_success&&(i=r.para,"ab_bridge_ok"===e.bridgeState?e.bridgeStore.asyncFetch(i):i.callback(i.default_value))},fastFetchABTest:function(i){if(!t.isObject(i))return e.error("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var r=e.verifyStore.para("fastFetchABTest",i,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(r.verify_success){i=r.para;var a=e.searchLocalExp(i.param_name);if(t.isObject(a)){var s=e.getExpResult(i,a);i.callback(s)}else t.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),"ab_bridge_ok"===e.bridgeState?e.bridgeStore.asyncFetch(i):i.callback(i.default_value)}},fetchCacheABTest:function(i){if(!t.isObject(i))return void e.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e");var r=e.verifyStore.para("fetchCacheABTest",i,{param_name:"essential",value_type:"essential",default_value:"essential"});if(r.verify_success)return e.getExpResult(r.para)}},e.normalStore={init:function(i){return!!this.setPara(i)&&(e.bridgeState="ab_no_host_bridge",/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?e.state.platform="H5":e.state.platform="Web",t.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f\uff0c\u8bd5\u9a8c URL\uff1a",i.url),e.checkSADebug(),void e.store.init(this.getResultFromServer,this))},setPara:function(i){if(!t.isString(i.url)||"http"!==i.url.slice(0,4))return t.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1;if("https"===location.protocol.slice(0,4)&&"http"===i.url.slice(0,4))return t.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0chttps \u9875\u9762\u5fc5\u987b\u4f7f\u7528 https \u7684 URL"),!1;var r=t.getQueryParam(i.url,"project-key");if(!r)return t.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff08\u5fc5\u987b\u5305\u542b project-key\uff09\uff01"),!1;i.project_key=r;var a=e.verifyStore.para("A/B Testing SDK \u521d\u59cb\u5316",i,{timeout_milliseconds:"not_essential"});return e.para=t.extend({},e.default_para,a.para),t.isBoolean(e.para.collect_bridge_status)||(e.para.collect_bridge_status=!0),t.isNumber(e.para.update_interval)||(e.para.update_interval=6e5),!0},asyncFetch:function(i){e.normalStore.getResultFromServer({para:i,suc:function(r){if(t.isObject(r)&&"SUCCESS"===r.status){var a=e.getExpResult(i);i.callback(a)}else i.callback(i.default_value)},err:function(){i.callback(i.default_value)}})},creatRequestData:function(i){var r="";t.isEmptyObject(e.sd.store._state)||(r=e.sd.store._state._first_id||e.sd.store._state.first_id||e.sd.store._state._distinct_id||e.sd.store._state.distinct_id);var a={anonymous_id:r,platform:e.state.platform,abtest_lib_version:e.lib_version,properties:{$is_first_day:e.sd._.cookie.getNewUser()}};return t.isObject(i.properties)&&(a.properties=t.extend({},a.properties,i.properties)),e.sd.store._state.first_id&&(a.login_id=e.sd.store.getDistinctId()),a},getResultFromServer:function(i){function r(){var i=e.sd.store.getDistinctId();e.sd._.ajax({url:e.para.url,type:"POST",data:JSON.stringify(o),credentials:!1,contentType:"application/json",timeout:a.timeout_milliseconds||e.para.timeout_milliseconds,cors:!0,success:function(t){e.dealResponseData(t,i),s&&s(t),e.fetchData.setNextFetch()},error:function(i){t.log("\u670d\u52a1\u7aef\u8bf7\u6c42\u53d1\u9001\u5931\u8d25",i),n&&n(),e.fetchData.setNextFetch()}})}i=t.isObject(i)?i:{};var a=i.para||{},s=i.suc,n=i.err,o=this.creatRequestData(a);t.log("\u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),r()}},e.normalStore.methods={asyncFetchABTest:function(i){if(!t.isObject(i))return e.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var r=e.verifyStore.para("asyncFetchABTest",i,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});r.verify_success&&(i=r.para,e.normalStore.asyncFetch(i))},fastFetchABTest:function(i){if(!t.isObject(i))return e.error("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var r=e.verifyStore.para("fastFetchABTest",i,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(r.verify_success){i=r.para;var a=e.searchLocalExp(i.param_name);if(t.isObject(a)){var s=e.getExpResult(i,a);i.callback(s)}else t.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),e.normalStore.asyncFetch(i)}},fetchCacheABTest:function(i){if(!t.isObject(i))return void e.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e");var r=e.verifyStore.para("fetchCacheABTest",i,{param_name:"essential",value_type:"essential",default_value:"essential"});if(r.verify_success)return e.getExpResult(r.para)}},e.dealResponseData=function(e,i){t.isObject(e)?"SUCCESS"===e.status?t.isArray(e.results)&&(this.originalData=e.results,this.updateLocalData(e.results,i)):"FAILED"===e.status&&t.log("\u83b7\u53d6\u8bd5\u9a8c\u5931\u8d25\uff1aerror_type\uff1a"+e.error_type+",error\uff1a"+e.error):t.log("\u8bd5\u9a8c\u6570\u636e\u89e3\u6790\u5931\u8d25\uff0cresponse \uff1a",e)},e.updateLocalData=function(e,i){this.analyzeData(e),this.updateStorage(i),t.log("\u66f4\u65b0\u8bd5\u9a8c\u6570\u636e\u6210\u529f")},e.updateStorage=function(t){var i=(new Date).getTime(),r={data:this.originalData,updateTime:i,triggerList:this.triggerList,distinct_id:t||e.sd.store.getDistinctId()};this.setStorageData(r),this.updateTime=i},e.analyzeData=function(i){return t.isArray(i)?(e.link.resolve(i),void e.resolveVariables(i)):(t.log("\u89e3\u6790——\u6570\u636e\u683c\u5f0f\u9519\u8bef",i),!1)},e.triggerHandle=function(i,r){var a=t.isObject(r)&&t.isObject(r.properties)?r.properties:{},s=e.trackTestTrigger(i,a),n=i.abtest_experiment_id;if(t.isString(n)){var o=e.sd.store.getDistinctId();this.triggerList[o]&&t.isArray(this.triggerList[o])?(this.triggerList[o].push(n),this.triggerList[o]=t.unique(this.triggerList[o])):this.triggerList[o]=[n],this.updateStorage()}return s},e.trackTestTrigger=function(i,r){var a=e.sd.store.getDistinctId(),s=!0,n=!0;if(r=t.isObject(r)?r:{},!i.is_white_list){if(this.triggerList&&t.isObject(this.triggerList)&&("{}"!==JSON.stringify(this.triggerList)&&(n=!1),this.triggerList[a]&&t.isArray(this.triggerList[a])&&t.each(this.triggerList[a],function(e){e===i.abtest_experiment_id&&(s=!1)})),s){var o={$abtest_experiment_id:i.abtest_experiment_id,$abtest_experiment_group_id:i.abtest_experiment_group_id};if(e.para.collect_bridge_status&&(o.$sdk_bridge_status=e.bridgeState),n){var l="web_abtesting:"+this.lib_version;o.$lib_plugin_version=[l]}var c=t.extend(o,r);this.sd.track("$ABTestTrigger",c)}return s}},e.checkSADebug=function(){var i=t.getQueryParam(location.href,"sensors_abtest_url"),r=t.getQueryParam(location.href,"feature_code"),a=+t.getQueryParam(location.href,"account_id");if(i.length&&r.length&&t.isNumber(a)&&0!==a){var s={distinct_id:e.sd.store.getDistinctId(),feature_code:r,account_id:a};e.sd._.ajax({url:i,type:"POST",data:JSON.stringify(s),credentials:!1,contentType:"application/json",timeout:e.para.timeout_milliseconds,cors:!0,success:function(){},error:function(e){t.log("distinct_id\u53d1\u9001\u5931\u8d25,err:",e)}})}},e.initMethods=function(i){var r=["asyncFetchABTest","fastFetchABTest","fetchCacheABTest"];t.each(r,function(t){e[t]=i.methods[t]})},e.fetchData={timer:null,method:null,context:null,init:function(e,t){this.method=e,this.context=t,this.start(!0)},getServerData:function(i){i?this.method.call(this.context,{suc:function(r){i&&("ab_bridge_ok"===e.bridgeState&&(r=r.data),t.isObject(r)&&"SUCCESS"===r.status&&t.isArray(r.results)||e.link.stopTrigger())},err:function(){i&&e.link.stopTrigger()}}):this.method.call(this.context)},setNextFetch:function(t){var i=this,r=t||e.para.update_interval;this.clearFetchTimer(this.timer),this.timer=setTimeout(function(){i.getServerData()},r)},start:function(i){var r=null,a=(new Date).getTime(),s=e.getStorageData(),n=e.sd.store.getDistinctId();if(s&&t.isObject(s)&&s.distinct_id===n)if(r=s.updateTime,i&&(e.originalData=s.data,r&&t.isNumber(r)&&a-r>0&&a-r<e.para.session_limit&&t.isObject(s.triggerList)&&(e.triggerList=s.triggerList),e.analyzeData(s.data)),r&&t.isNumber(r)&&a-r>0&&a-r<e.para.update_interval){t.log("\u6570\u636e\u4e0d\u66f4\u65b0",r,a);var o=a-r,l=e.para.update_interval-o;this.setNextFetch(l)}else t.log("\u7f13\u5b58\u6570\u636e\u8d85\u65f6",r,a),this.getServerData(i);else r=e.updateTime,r&&t.isNumber(r)&&a-r>0&&a-r<e.para.update_interval?t.log("\u6570\u636e\u4e0d\u66f4\u65b0",r,a):this.getServerData(i)},stop:function(){t.log("\u6e05\u7a7a\u62c9\u53d6\u5b9a\u65f6\u5668"),this.clearFetchTimer()},clearFetchTimer:function(){clearTimeout(this.timer),this.timer=null}},e.store={init:function(i,r){e.fetchData.init(i,r),e.initMethods(r),e.listenPageState({visible:function(){t.log("\u9875\u9762\u663e\u793a"),e.fetchData.start()},hidden:function(){e.fetchData.stop()}}),e.sd.events.on("changeDistinctId",function(t){e.localdata={},e.originalData=[],e.updateStorage(),e.fetchData.getServerData()}),e.sd.events.isReady()}},e.init=function(e,i){return this.sd?(this.log("A/B Testing SDK \u91cd\u590d\u521d\u59cb\u5316\uff01\u53ea\u6709\u7b2c\u4e00\u6b21\u521d\u59cb\u5316\u6709\u6548\uff01"),!1):(t.log=function(){return t.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]),e.log.apply(this,arguments)},this.getSA(e)?t.isObject(i)?("object"==typeof localStorage&&this.sd._.localStorage.isSupport()||(t.log("localstorage\u5f02\u5e38"),this.state.storage.isSupport=!1),this.link.init(i.multilink),void(e.bridge.is_verify_success?this.bridgeStore.init(i):this.normalStore.init(i))):(t.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f20\u5165\u6b63\u786e\u7684\u521d\u59cb\u5316\u53c2\u6570!para:",i),!1):(this.log("A/B Testing \u521d\u59cb\u5316\u5931\u8d25,Web JS SDK \u6ca1\u6709\u521d\u59cb\u5316\u5b8c\u6210"),!1))},window.SensorsDataWebJSSDKPlugin&&"[object Object]"==Object.prototype.toString.call(window.SensorsDataWebJSSDKPlugin)?window.SensorsDataWebJSSDKPlugin.SensorsABTest=window.SensorsDataWebJSSDKPlugin.SensorsABTest||e:window.SensorsDataWebJSSDKPlugin={SensorsABTest:e},e});