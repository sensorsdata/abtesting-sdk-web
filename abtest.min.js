!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():e()}(this,function(){"use strict";function t(t){var e="t6KJCZa5pDdQ9khoEM3Tj70fbP2eLSyc4BrsYugARqFIw1mzlGNVXOHiWvxUn8",r=e.length-1,i={},a=0;for(a=0;a<e.length;a++)i[e.charAt(a)]=e.charAt(r-a);var n="";for(a=0;a<t.length;a++)n+=t.charAt(a)in i?i[t.charAt(a)]:t.charAt(a);return n}function e(e){return 0===e.indexOf(U)&&(e=e.substring(U.length),e=t(e)),e}function r(e){return U+t(e)}function i(){var t,e={},r=navigator.userAgent.toLowerCase();return(t=r.match(/opera.([\d.]+)/))?e.opera=Number(t[1].split(".")[0]):(t=r.match(/msie ([\d.]+)/))?e.ie=Number(t[1].split(".")[0]):(t=r.match(/edge.([\d.]+)/))?e.edge=Number(t[1].split(".")[0]):(t=r.match(/firefox\/([\d.]+)/))?e.firefox=Number(t[1].split(".")[0]):(t=r.match(/chrome\/([\d.]+)/))?e.chrome=Number(t[1].split(".")[0]):(t=r.match(/version\/([\d.]+).*safari/))?e.safari=Number(t[1].match(/^\d*.\d*/)):(t=r.match(/trident\/([\d.]+)/))&&(e.ie=11),e}function a(){if(!window.name)return!1;try{var t=JSON.parse(decodeURIComponent(window.name||"")),e=t.is_vabtesting,r=t.source_url,i=t.link_match_type;return!(e!==!0||!O.checkUrlIsMatch(r,i))||(O.log("A/B Testing SDK \u9875\u9762\u5730\u5740\uff0c\u4e0e\u5f53\u524d\u5b9e\u9a8c URL \u4e0d\u5339\u914d\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1)}catch(a){return!1}}function n(t,e){t=t||window;var r=!1,i=!0,a=t.document,n=a.documentElement,s=a.addEventListener,o=s?"addEventListener":"attachEvent",l=s?"removeEventListener":"detachEvent",c=s?"":"on",u=function(i){"readystatechange"==i.type&&"complete"!=a.readyState||(("load"==i.type?t:a)[l](c+i.type,u,!1),!r&&(r=!0)&&e.call(t,i.type||i))},h=function(){try{n.doScroll("left")}catch(t){return void setTimeout(h,50)}u("poll")};if("complete"==a.readyState)e.call(t,"lazy");else{if(!s&&n.doScroll){try{i=!t.frameElement}catch(p){}i&&h()}a[o](c+"DOMContentLoaded",u,!1),a[o](c+"readystatechange",u,!1),t[o](c+"load",u,!1)}}function s(t){if(!t.parentNode)return-1;for(var e=0,r=t.tagName,i=t.parentNode.children,a=0;a<i.length;a++)if(i[a].tagName===r){if(t===i[a])return e;e++}return-1}function o(t){var e=t.parentNode&&9==t.parentNode.nodeType?-1:s(t);return t.getAttribute&&t.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(t.getAttribute("id"))?"#"+t.getAttribute("id"):t.tagName.toLowerCase()+(~e?":nth-of-type("+(e+1)+")":"")}function l(t,e){if(!t||!t.parentNode||!t.parentNode.children)return!1;e=e&&e.join?e:[];var r=t.nodeName.toLowerCase();return t&&"body"!==r&&1==t.nodeType?(e.unshift(o(t)),t.getAttribute&&t.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(t.getAttribute("id"))?e.join(" > "):l(t.parentNode,e)):(e.unshift("body"),e.join(" > "))}function c(t,e){return t.currentStyle?t.currentStyle[e]:t.ownerDocument.defaultView.getComputedStyle(t,null).getPropertyValue(e)}function u(t,e){var r={};return O.each(e||[],function(e){var i=e.replace(/[A-Z]+/g,function(t){return"-"+t.toLowerCase()});r[e]=c(t,i)}),r}function h(t){var e=t.childNodes,r="",i=!1;return O.each(e,function(t){i===!1&&3===t.nodeType&&(O.isString(t.textContent)||O.isString(t.innerText)||O.isString(t.nodeValue))&&(r=O.trim(t.textContent||t.innerText||t.nodeValue||""),i=!0)}),r}function p(t){function e(t,e){t=O.trim(t);var r;if("body"===t)return document.getElementsByTagName("body")[0];if(0===t.indexOf("#"))t=t.slice(1),r=document.getElementById(t);else if(t.indexOf(":nth-of-type")>-1){var i=t.split(":nth-of-type");if(!i[0]||!i[1])return null;var a=i[0],n=i[1].match(/\(([0-9]+)\)/);if(!n||!n[1])return null;var s=Number(n[1]);if(!(O.isElement(e)&&e.children&&e.children.length>0))return null;for(var o=e.children,l=0;l<o.length;l++)if(O.isElement(o[l])){var c=o[l].tagName.toLowerCase();if(c===a&&(s--,0===s)){r=o[l];break}}if(s>0)return null}return r?r:null}function r(t){var a,n=i.shift();if(!n)return t;try{a=e(n,t)}catch(s){a=null}return a&&O.isElement(a)?r(a):null}if(!O.isString(t))return null;var i=t.split(">"),a=null;return a=r(),a&&O.isElement(a)?a:null}function d(t){var e=t.match(/[\d.]+/g);if(e.length>=3){var r,i,a;return r=e[0],i=e[1],a=e[2],"rgb("+r+","+i+","+a+")"}return""}function f(t,e){function r(t,e){var r=t.length-e.length;return r>=0&&t.indexOf(e,r)==r}var a=i(),n=a.ie&&a.ie<9,s="";if(O.each(e,function(t,e){n&&t.indexOf("rgba")>-1&&(t=d(t));var r=e.replace(/[A-Z]+/g,function(t){return"-"+t.toLowerCase()});s+=";"+r+": "+t}),""!==s){var o=t.style,l=o.cssText||"";l&&!r(l,";")&&(l+=";"),o.cssText=l+s}}function g(t,e){var r=t.childNodes,i=!1;O.each(r,function(t){3===t.nodeType&&(i||(t.textContent?t.textContent=e:t.innerText?t.innerText=e:t.nodeValue=e,i=!0))})}function _(t,e){var r=t.originProps,i=e.originProps,a=r.attributes,n=i.attributes,s=!0;return r.text&&r.text!==i.text&&(s=!1),a&&O.each(["src","href","target"],function(t){a[t]&&a[t]!==n[t]&&(s=!1)}),s}function m(t,e,r){t.setAttribute(e,r)}function v(t,e){var r=e.originProps,i={attributes:{}},a=r.attributes;return O.each(a.style||{},function(e,r){i.attributes.style[r]=c(t,r)}),Object.hasOwnProperty.call(r,"text")&&(i.attributes.text=h(t)),O.each(["src","href"],function(e){Object.hasOwnProperty.call(a,e)&&(i.attributes[e]=t[e])}),Object.hasOwnProperty.call(a,"target")&&(i.attributes.target=t.getAttribute("target")),i}function b(t,e,r){if(r||(r=v(t,e)),_(e,r)){var i=e.props;O.isObject(i)&&y(t,i)}}function y(t,e){if(Object.hasOwnProperty.call(e,"attributes")){var r=e.attributes;Object.hasOwnProperty.call(r,"style")&&f(t,r.style),O.each(["href","target","src"],function(e){Object.hasOwnProperty.call(r,e)&&m(t,e,r[e])})}Object.hasOwnProperty.call(e,"text")&&g(t,e.text)}function S(t){t=O.extend({success:function(){},error:function(){},appendCall:function(t){document.getElementsByTagName("head")[0].appendChild(t)}},t);var e=null;"css"===t.type&&(e=document.createElement("link"),e.rel="stylesheet",e.href=t.url),"js"===t.type&&(e=document.createElement("script"),e.async="async",e.setAttribute("charset","UTF-8"),e.src=t.url,e.type="text/javascript"),e.onload=e.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(t.success(),e.onload=e.onreadystatechange=null)},e.onerror=function(){t.error(),e.onerror=null},t.appendCall(e)}function k(t){S({success:function(){},error:function(){},type:"js",url:t})}function w(t){var e={childList:!0,subtree:!0},r=window.MutationObserver,i=new r(t);i.observe(document.body,e)}function x(t,e){var r=t.tagName.toLowerCase(),i=u(t,e),a={selector:l(t),originProps:{attributes:{style:i},text:h(t)},type:"text",tagName:r};"a"===r&&(a.originProps.attributes.href=t.href,t.getAttribute("target")&&(a.originProps.attributes.target=t.getAttribute("target")),a.type="link"),"img"===r&&(a.originProps.attributes.src=t.src,a.type="img");var n=t.getAttribute("style");return{originStyle:n,eleInfo:a,ele:t}}function T(t){var e=t.eleInfo,r=t.ele;if(r){var i=t.originStyle;y(r,e.originProps),i?r.style.cssText=i:r.style.cssText=""}}function A(){this.enable_visualize=!1,this.vabtest_url=location.protocol+"//static.sensorsdata.cn/sdk/plugin/vabtest/"+D.lib_version+"/vabtest.min.js",this.timeout=500,this.is_editor=!1,this.use_mask=!0,this.originData=[],this.visualExp=null,this.isFirst=!0,this.start_time=null,this.is_have_observer=!1,this.imgLoadingList=[]}var D={sd:null,lib_version:"0.0.10",para:{},default_para:{url:"",path:"",project_key:"",timeout_milliseconds:3e3,update_interval:6e5,collect_bridge_status:!0,session_limit:6e5,encrypt_cookie:!1},value_type_list:["Number","String","Object","Boolean"],state:{platform:"",storage:{isSupport:!0,name:"sawebjssdkabtest"}},bridgeState:"",localdata:{},originalData:[],triggerList:{},updateTime:null},O={},E=Array.prototype,P=Object.prototype,j=E.slice,L=P.toString,B=P.hasOwnProperty,N=E.forEach,F=Array.isArray,R={};O.each=function(t,e,r){if(null==t)return!1;if(N&&t.forEach===N)t.forEach(e,r);else if(O.isArray(t)&&t.length===+t.length){for(var i=0,a=t.length;i<a;i++)if(i in t&&e.call(r,t[i],i,t)===R)return!1}else for(var n in t)if(B.call(t,n)&&e.call(r,t[n],n,t)===R)return!1},O.extend=function(t){return O.each(j.call(arguments,1),function(e){for(var r in e)B.call(e,r)&&void 0!==e[r]&&(t[r]=e[r])}),t},O.isArray=F||function(t){return"[object Array]"===L.call(t)},O.isObject=function(t){return null!=t&&"[object Object]"==L.call(t)},O.isElement=function(t){return!(!t||1!==t.nodeType)},O.isString=function(t){return"[object String]"==L.call(t)},O.isBoolean=function(t){return"[object Boolean]"==L.call(t)},O.isNumber=function(t){return"[object Number]"==L.call(t)&&/[\d\.]+/.test(String(t))},O.unique=function(t){for(var e,r=[],i={},a=0;a<t.length;a++)e=t[a],e in i||(i[e]=!0,r.push(e));return r},O.decodeURIComponent=function(t){var e=t;try{e=decodeURIComponent(t)}catch(r){e=t}return e},O.getQueryParam=function(t,e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),t=O.decodeURIComponent(t);var r="[\\?&]"+e+"=([^&#]*)",i=new RegExp(r),a=i.exec(t);return null===a||a&&"string"!=typeof a[1]&&a[1].length?"":O.decodeURIComponent(a[1])},O.indexOf=function(t,e){var r=t.indexOf;if(r)return r.call(t,e);for(var i=0;i<t.length;i++)if(e===t[i])return i;return-1},O.isFunction=function(t){if(!t)return!1;var e=Object.prototype.toString.call(t);return"[object Function]"==e||"[object AsyncFunction]"==e},O.isEmptyObject=function(t){if(O.isObject(t)){for(var e in t)if(B.call(t,e))return!1;return!0}return!1},O.map=function(t,e){var r=[];return null==t?r:Array.prototype.map&&t.map===Array.prototype.map?t.map(e):(O.each(t,function(t,i,a){r.push(e(t,i,a))}),r)},O.base64Decode=function(t){var e=O.map(atob(t).split(""),function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)});return decodeURIComponent(e.join(""))},O.getURLSearchParams=function(t){t=t||"";for(var e=function(t){return decodeURIComponent(t)},r={},i=t.substring(1),a=i.split("&"),n=0;n<a.length;n++){var s=a[n].indexOf("=");if(s!==-1){var o=a[n].substring(0,s),l=a[n].substring(s+1);o=e(o),l=e(l),r[o]=l}}return r},O.urlParse=function(t){var e=function(t){this._fields={Username:4,Password:5,Port:7,Protocol:2,Host:6,Path:8,URL:0,QueryString:9,Fragment:10},this._values={},this._regex=null,this._regex=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/,"undefined"!=typeof t&&this._parse(t)};return e.prototype.setUrl=function(t){this._parse(t)},e.prototype._initValues=function(){for(var t in this._fields)this._values[t]=""},e.prototype.addQueryString=function(t){if("object"!=typeof t)return!1;var e=this._values.QueryString||"";for(var r in t)e=new RegExp(r+"[^&]+").test(e)?e.replace(new RegExp(r+"[^&]+"),r+"="+t[r]):"&"===e.slice(-1)?e+r+"="+t[r]:""===e?r+"="+t[r]:e+"&"+r+"="+t[r];this._values.QueryString=e},e.prototype.getUrl=function(){var t="";return t+=this._values.Origin,t+=this._values.Port?":"+this._values.Port:"",t+=this._values.Path,t+=this._values.QueryString?"?"+this._values.QueryString:"",t+=this._values.Fragment?"#"+this._values.Fragment:""},e.prototype.getUrl=function(){var t="";return t+=this._values.Origin,t+=this._values.Port?":"+this._values.Port:"",t+=this._values.Path,t+=this._values.QueryString?"?"+this._values.QueryString:""},e.prototype._parse=function(t){this._initValues();var e=this._regex.exec(t);e||O.log("DPURLParser::_parse -> Invalid URL");for(var r in this._fields)"undefined"!=typeof e[this._fields[r]]&&(this._values[r]=e[this._fields[r]]);this._values.Hostname=this._values.Host.replace(/:\d+$/,""),this._values.Origin=this._values.Protocol+"://"+this._values.Hostname},new e(t)},O.URL=function(t){var e={},r=function(){var t;try{return t=new URL("http://modernizr.com/"),"http://modernizr.com/"===t.href}catch(e){return!1}};if("function"==typeof window.URL&&r())e=new URL(t),e.searchParams||(e.searchParams=function(){var t=O.getURLSearchParams(e.search);return{get:function(e){return t[e]}}}());else{var i=/^https?:\/\/.+/;i.test(t)===!1&&O.log("Invalid URL");var a=O.urlParse(t);e.hash="",e.host=a._values.Host?a._values.Host+(a._values.Port?":"+a._values.Port:""):"",e.href=a._values.URL,e.password=a._values.Password,e.pathname=a._values.Path,e.port=a._values.Port,e.search=a._values.QueryString?"?"+a._values.QueryString:"",e.username=a._values.Username,e.hostname=a._values.Hostname,e.protocol=a._values.Protocol?a._values.Protocol+":":"",e.origin=a._values.Origin?a._values.Origin+(a._values.Port?":"+a._values.Port:""):"",e.searchParams=function(){var t=O.getURLSearchParams("?"+a._values.QueryString);return{get:function(e){return t[e]}}}()}return e},O.getQueryParam=function(t,e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),t=O.decodeURIComponent(t);var r="[\\?&]"+e+"=([^&#]*)",i=new RegExp(r),a=i.exec(t);return null===a||a&&"string"!=typeof a[1]&&a[1].length?"":O.decodeURIComponent(a[1])},O.isEmptyObject=function(t){if(O.isObject(t)){for(var e in t)if(B.call(t,e))return!1;return!0}return!1},O.contentLoaded=function(t,e){var r=!1,i=!0,a=t.document,n=a.documentElement,s=a.addEventListener,o=s?"addEventListener":"attachEvent",l=s?"removeEventListener":"detachEvent",c=s?"":"on",u=function(i){"readystatechange"==i.type&&"complete"!=a.readyState||(("load"==i.type?t:a)[l](c+i.type,u,!1),!r&&(r=!0)&&e.call(t,i.type||i))},h=function(){try{n.doScroll("left")}catch(t){return void setTimeout(h,50)}u("poll")};if("complete"==a.readyState)e.call(t,"lazy");else{if(!s&&n.doScroll){try{i=!t.frameElement}catch(p){}i&&h()}a[o](c+"DOMContentLoaded",u,!1),a[o](c+"readystatechange",u,!1),t[o](c+"load",u,!1)}},O.secCheck={isHttpUrl:function(t){if("string"!=typeof t)return!1;var e=/^https?:\/\/.+/;return e.test(t)!==!1||(O.log("Invalid URL"),!1)},removeScriptProtocol:function(t){if("string"!=typeof t)return"";for(var e=/^\s*javascript/i;e.test(t);)t=t.replace(e,"");return t}},O.addEvent=function(){function t(e){return e&&(e.preventDefault=t.preventDefault,e.stopPropagation=t.stopPropagation,e._getPath=t._getPath),e}function e(e,r,i){var a=function(a){if(a=a||t(window.event)){a.target=a.srcElement;var n,s,o=!0;return"function"==typeof i&&(n=i(a)),s=r.call(e,a),!1!==n&&!1!==s||(o=!1),o}};return a}t._getPath=function(){var t=this,e=function(){try{var e=t.target,r=[e];if(null===e||null===e.parentElement)return[];for(;null!==e.parentElement;)e=e.parentElement,r.unshift(e);return r}catch(i){return[]}};return this.path||this.composedPath&&this.composedPath()||e()},t.preventDefault=function(){this.returnValue=!1},t.stopPropagation=function(){this.cancelBubble=!0};var r=function(r,i,a){var n=!0;if(r&&r.addEventListener)r.addEventListener(i,function(e){e._getPath=t._getPath,a.call(this,e)},n);else{var s="on"+i,o=r[s];r[s]=e(r,a,o)}};r.apply(null,arguments)},O.addSinglePageEvent=function(t){var e=location.href,r=window.history.pushState,i=window.history.replaceState;window.history.pushState=function(){r.apply(window.history,arguments),t(e),e=location.href},window.history.replaceState=function(){i.apply(window.history,arguments),t(e),e=location.href};var a=r?"popstate":"hashchange";O.addEvent(window,a,function(){t(e),e=location.href})},O.trim=function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},O.checkUrlIsMatch=function(t,e){var r,i,a=O.URL(t);if("STRICT"===e)return location.href===a.href;if("FUZZY"===e){try{r=O.URL(location.href)}catch(n){return O.log("url \u89e3\u6790\u5931\u8d25",n),!1}try{i=O.URL(t)}catch(n){return O.log("control_url \u89e3\u6790\u5931\u8d25",n),!1}return r.host===i.host&&r.pathname===i.pathname}return O.log("link_match_type\u5b57\u6bb5\u5f02\u5e38",e),!1},O.checkUrlIsRegexp=function(t,e){var r;try{r=O.URL(location.href)}catch(i){return O.log("url \u89e3\u6790\u5931\u8d25",i),!1}try{var a=e?new RegExp(t,e):new RegExp(t),n=a.exec(r.href),s=!0;return!!n&&(O.each(n,function(t){t||(s=!1)}),s)}catch(i){return O.log("control_link\u5b57\u6bb5\u5f02\u5e38",i),!1}};var U="dfm-enc-";D.verifyStore={valueType:function(t,e){switch(e){case"Number":if(O.isNumber(t))return!0;break;case"String":if(O.isString(t))return!0;break;case"Object":if(O.isObject(t))return!0;break;case"Boolean":if(t===!0||t===!1)return!0;break;default:return!1}return!1},para:function(t,e,r){var i={verify_success:!0,para:null};return O.each(r,function(r,a){if("essential"===r)switch(a){case"param_name":O.isString(e.param_name)&&e.param_name.length>0||(D.error(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cparam_name\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e\uff01param_name:",e.param_name),i.verify_success=!1);break;case"value_type":O.isString(e.value_type)&&O.indexOf(D.value_type_list,e.value_type)!==-1||(D.error(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cvalue_type\u914d\u7f6e\u9519\u8bef",e.value_type),i.verify_success=!1);break;case"default_value":"undefined"==typeof e.default_value?(D.error(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u53c2\u6570\u672a\u914d\u7f6e"),i.verify_success=!1):D.verifyStore.valueType(e.default_value,e.value_type)||(D.error(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u7c7b\u578b\u5fc5\u987b\u4e0evalue_type\u4e00\u81f4\uff01",e.default_value,e.value_type),i.verify_success=!1);break;case"callback":O.isFunction(e.callback)||(D.error(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0ccallback\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),i.verify_success=!1);break;default:i.verify_success=!1}else if("not_essential"===r)switch(a){case"timeout_milliseconds":e.timeout_milliseconds=e.timeout_milliseconds||D.para.timeout_milliseconds||D.default_para.timeout_milliseconds,(!O.isNumber(e.timeout_milliseconds)||O.isNumber(e.timeout_milliseconds)&&e.timeout_milliseconds<=0)&&(O.log("timeout_milliseconds \u53c2\u6570\u9519\u8bef",e.timeout_milliseconds),e.timeout_milliseconds=D.para.timeout_milliseconds),e.timeout_milliseconds<200&&(e.timeout_milliseconds=200);break;case"properties":e.properties=O.isObject(e.properties)?e.properties:{}}}),i.para=e,i}},D.getSA=function(t){return!!(O.isObject(t)&&O.isObject(t.readyState)&&t.readyState.state>=3)&&(this.sd=t,!0)},D.log=function(){if("object"==typeof console&&console.log){O.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]);try{return console.log.apply(console,arguments)}catch(t){console.log(arguments[0])}}},D.error=function(){if("object"==typeof console&&console.error)try{return console.error.apply(console,arguments)}catch(t){console.error(arguments[0])}},D.listenPageState=function(t){var e={visibleHandle:O.isFunction(t.visible)?t.visible:function(){},hiddenHandler:O.isFunction(t.hidden)?t.hidden:function(){},visibilityChange:null,hidden:null,isSupport:function(){return"undefined"!=typeof document[this.hidden]},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var t=this;document.addEventListener(t.visibilityChange,function(){document[t.hidden]?t.hiddenHandler():t.visibleHandle()},1)}else document.addEventListener?(window.addEventListener("focus",this.visibleHandle,1),window.addEventListener("blur",this.hiddenHandler,1)):(document.attachEvent("onfocusin",this.visibleHandle),document.attachEvent("onfocusout",this.hiddenHandler))}};e.init()},D.storage={set:function(t,e){D.state.storage.isSupport&&window.localStorage.setItem(e,t)},get:function(t){var e=null;return D.state.storage.isSupport&&(e=window.localStorage.getItem(t)),e}},D.getStorageData=function(){var t=this.storage.get(D.state.storage.name);O.isString(t)&&(t=e(t));try{t=JSON.parse(t)}catch(r){O.log(r)}return t},D.setStorageData=function(t){t=JSON.stringify(t),D.para.encrypt_cookie&&(t=r(t)),this.storage.set(t,D.state.storage.name)},D.Mask=function(t){this.attr_name="sa-abtest-"+t,this.remove_timer=null,this.is_added=!1,this.is_abort=!1,this.is_timeout=!1,this.createMaskStyle()},D.Mask.prototype={createMaskStyle:function(){var t="["+this.attr_name+"],["+this.attr_name+"] body{opacity:0 !important;-khtml-opacity:0 !important;-moz-opacity:0;filter:alpha(opacity=0);}",e=document.createElement("style");e.type="text/css";try{e.appendChild(document.createTextNode(t))}catch(r){e.styleSheet.cssText=t}try{document.getElementsByTagName("head")[0].appendChild(e)}catch(r){D.log("error when create calls")}},show:function(t){try{var e=this;if(this.is_abort)return!1;var r=null;if(r=document.getElementsByTagName("html")[0],!O.isElement(r))return;r.setAttribute(this.attr_name,"1"),this.is_added=!0,O.isNumber(t)&&(this.remove_timer=setTimeout(function(){e.is_timeout=!0,e.remove()},t))}catch(i){D.log("error when show calls")}},remove:function(){try{if(this.is_abort||(this.is_abort=!0),this.is_added){this.is_added=!1;var t=null;if(t=document.getElementsByTagName("html")[0],!O.isElement(t))return;t.removeAttribute(this.attr_name)}this.remove_timer&&(clearTimeout(this.remove_timer),this.remove_timer=null)}catch(e){D.log("error when remove calls")}}},D.asyncFetchABTest=function(){D.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},D.fastFetchABTest=function(){D.error("fastFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},D.fetchCacheABTest=function(){D.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},D.searchLocalExp=function(t){return D.localdata[t]?D.localdata[t]:null},D.getExpResult=function(t,e){var r=t.default_value,i=e?e:D.searchLocalExp(t.param_name);return O.isObject(i)?O.isObject(i.js_config)&&(i.js_config.type===t.value_type?(r=i.js_config.value,this.triggerHandle(i,t)):O.log("\u8bd5\u9a8c\u7ed3\u679c\u7c7b\u578b\u4e0e\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e0d\u4e00\u81f4\uff0cparam_name\uff1a"+t.param_name+"\uff0c\u5f53\u524d\u8fd4\u56de\u7c7b\u578b\u4e3a\uff1a"+i.js_config.type+"\uff0c\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e3a\uff1a"+t.value_type)):O.log("localdata\u672a\u67e5\u8be2\u5230\u8bd5\u9a8c\u6570\u636e\uff0c\u8bd5\u9a8c\u53c2\u6570\u540d\u79f0\uff1a"+t.param_name),r},D.resolveVariables=function(t){this.localdata={};var e=this;O.each(t,function(t){if(O.isObject(t)&&t.variables&&O.isArray(t.variables)){if(t.experiment_type&&"CODE"!==t.experiment_type)return!1;O.each(t.variables,function(r){O.isObject(r)&&!e.localdata[r.name]&&(e.localdata[r.name]={abtest_experiment_id:t.abtest_experiment_id,abtest_experiment_group_id:t.abtest_experiment_group_id,is_control_group:t.is_control_group,is_white_list:t.is_white_list,value:r.value,type:r.type,js_config:D.getRelativeValue(r.value,r.type),experiment_type:t.experiment_type})})}})},D.getRelativeValue=function(t,e){var r={},i={INTEGER:function(t){var e=parseFloat(t);isNaN(e)?O.log("\u539f\u59cb\u6570\u636e INTEGER \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t):(r.value=e,r.type="Number")},STRING:function(t){O.isString(t)?(r.value=t,r.type="String"):O.log("\u539f\u59cb\u6570\u636e STRING \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)},JSON:function(t){var e=JSON.parse(t);O.isObject(e)?(r.value=e,r.type="Object"):O.log("\u539f\u59cb\u6570\u636e JSON \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)},BOOLEAN:function(t){"true"===t?(r.value=!0,r.type="Boolean"):"false"===t?(r.value=!1,r.type="Boolean"):O.log("\u539f\u59cb\u6570\u636e BOOLEAN \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)}};try{i[e]?i[e](t):O.log("\u8bd5\u9a8c\u6570\u636e\u7c7b\u578b\u89e3\u6790\u5931\u8d25",e,t)}catch(a){O.log(a,t,e)}return r},D.link={isFirst:!0,start_time:null,mask_instance:null,is_filtered_out:!1,para:{timeout:500,use_mask:!0,pass_params:!0,control_link_search:"default",experiment_link_search:"default"},init:function(t){return this.initPara(t),this.para?O.getQueryParam(location.href,"saSDKMultilink")?(this.is_filtered_out=!0,!1):(this.start_time=(new Date).getTime(),this.para.use_mask&&this.initMask(),void this.addSinglePageListener()):(O.log("multilink is closed"),!1)},addSinglePageListener:function(){var t=this;O.addSinglePageEvent(function(e){return e!==location.href&&(t.is_filtered_out=!1,t.isFirst=!0,t.mask_instance&&t.mask_instance.remove(),O.getQueryParam(location.href,"saSDKMultilink")?(t.is_filtered_out=!0,!1):(t.start_time=(new Date).getTime(),t.para.use_mask&&t.initMask(),void t.resolve(D.originalData)))})},initMask:function(){this.mask_instance=new D.Mask("link"),this.mask_instance.show(this.para.timeout)},initPara:function(t){if(O.isFunction(t))try{t=t()}catch(e){return O.log("link para error!"),void(this.para=!1)}t===!1?this.para=!1:O.isObject(t)&&(this.para.timeout=O.isNumber(t.timeout)&&t.timeout>=0?t.timeout:500,this.para.use_mask=O.isBoolean(t.use_mask)?t.use_mask:this.para.use_mask,this.para.control_link_search=O.isString(t.control_link_search)?t.control_link_search:"default",this.para.experiment_link_search=O.isString(t.experiment_link_search)?t.experiment_link_search:"default",this.para.pass_params=!O.isBoolean(t.pass_params)||t.pass_params)},resolve:function(t){var e=this;if(!this.para)return!1;if(!O.isArray(t))return!1;if(this.is_filtered_out)return!1;if(!this.isFirst)return!1;if(this.isFirst=!1,0===this.para.timeout)return!1;if((new Date).getTime()-this.start_time>this.para.timeout)return O.log("The multilink was stopped because the request timeout"),!1;var r=!1;O.each(t,function(t){return!!O.isObject(t)&&(!r&&("LINK"===t.experiment_type&&void(e.isTriggerLinkExp(t)&&(r=!0,e.redirectUrl(t)))))}),!r&&this.para.use_mask&&this.mask_instance&&this.mask_instance.remove()},stopTrigger:function(){this.isFirst=!1,O.log("The multilink was stopped because the request failed"),this.para.use_mask&&this.mask_instance&&this.mask_instance.remove()},isTriggerLinkExp:function(t){return O.isString(t.control_link)&&O.isString(t.link_match_type)?"REGEXP"===t.link_match_type?!!O.checkUrlIsRegexp(t.control_link,t.regexp_flags)||(O.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",t.abtest_experiment_id),!1):!!O.checkUrlIsMatch(t.control_link,t.link_match_type)||(O.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",t.abtest_experiment_id),!1):(O.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u6570\u636e\u5f02\u5e38",t.abtest_experiment_id),!1)},redirectUrl:function(t){function e(t){return O.secCheck.isHttpUrl(t)?O.secCheck.removeScriptProtocol(t):(O.log("\u975e\u6cd5URL"),!1)}if(!t.experiment_link||!O.isString(t.experiment_link))return void O.log("\u9875\u9762\u8df3\u8f6c\u5931\u8d25\uff0cexperiment_link\u5b57\u6bb5\u5f02\u5e38",t.abtest_experiment_id);if(t.is_control_group===!0&&("STRICT"===t.link_match_type||"REGEXP"===t.link_match_type))return void D.triggerHandle(t);var r=location.href,i=t.experiment_link,a=/\$\d+/;if("REGEXP"===t.link_match_type&&a.test(i)){var n=t.regexp_flags?new RegExp(t.control_link,t.regexp_flags):new RegExp(t.control_link);i=r.replace(n,i)}var s,o;if(this.para.pass_params?(o=this.getMergedUrl(t.is_control_group,i,r),s=e(o)):(o=this.getMergedUrl(t.is_control_group,i),s=e(o)),s){var l=D.triggerHandle(t);l?setTimeout(function(){location.href=s},80):setTimeout(function(){location.href=s},0),this.mask_instance&&this.mask_instance.remove_timer&&clearTimeout(this.mask_instance.remove_timer)}},getMergedUrl:function(t,e,r){function i(t){var e=/([^?#]+)(\?[^#]*)?(#.*)?/,r=e.exec(t);if(r){var i=r[1]||"",a=r[2]||"",n=r[3]||"";return{host:i,search:a,hash:n}}}function a(t){var e={hash:"",search:""};if(!O.isString(t))return e;var r=t.indexOf("?");return r>-1?(e.search=t.slice(r),e.hash=t.slice(0,r)):e.hash=t,e}var n="",s="",o="",l={parse_url:null,search:""},c={parse_url:null,search:"",hash:""};return r&&(l.parse_url=i(r),!l.parse_url)?void O.log("url \u89e3\u6790\u5931\u8d25",r):(c.parse_url=i(e),c.parse_url?(r&&("after_hash"===this.para.control_link_search?l.search=a(l.parse_url.hash).search:l.search=l.parse_url.search),t?"after_hash"===this.para.control_link_search?(c.search=a(c.parse_url.hash).search,c.hash=a(c.parse_url.hash).hash):c.search=c.parse_url.search:"after_hash"===this.para.experiment_link_search?(c.search=a(c.parse_url.hash).search,c.hash=a(c.parse_url.hash).hash):c.search=c.parse_url.search,s=r?this.getSearchStr(l.search,c.search):this.getSearchStr(c.search),t&&"after_hash"===this.para.control_link_search||!t&&"after_hash"===this.para.experiment_link_search?n=c.hash.length>0?c.parse_url.host+c.parse_url.search+c.hash+s:c.parse_url.search.length>0?c.parse_url.host+c.parse_url.search+"&"+s.substring(1):c.parse_url.host+s:(o="after_hash"===this.para.control_link_search?c.parse_url.hash:r?c.parse_url.hash||l.parse_url.hash:c.parse_url.hash,n=c.parse_url.host+s+o),n):void O.log("url \u89e3\u6790\u5931\u8d25",e))},getSearchStr:function(t,e){function r(t){var e={};if(!t||!t.length||0!==t.indexOf("?"))return e;if(t=t.slice(1),!t.length)return e;for(var r=t.split("&"),i=0;i<r.length;i++)if(r[i].indexOf("=")<0)e[r[i]]=null;else{var a=r[i].split("=");e[a[0]]=a[1]}return e}var i=r(t),a=r(e),n=O.extend(i,a),s="";if(O.isEmptyObject(n))return"?saSDKMultilink=true";var o=!0;for(var l in n)o?(s+="?",o=!1):s+="&",null!==n[l]?s=s+l+"="+n[l]:s+=l;return s+="&saSDKMultilink=true"}},D.bridgeStore={init:function(t){return!!this.setPara(t)&&(O.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f"),D.state.storage.name="sawebjssdkabtest_bridge",D.abBridge=new D.sd.JSBridge({type:"abtest",app_call_js:function(t){try{t=O.base64Decode(t)}catch(e){O.log("App\u6570\u636ebase64\u89e3\u7801\u5f02\u5e38",t)}try{t=JSON.parse(t),t.message_id&&this["double"](t)}catch(e){O.log("App\u6570\u636e\u89e3\u6790\u5f02\u5e38",t)}}}),O.isObject(window.SensorsData_iOS_JS_Bridge)&&window.SensorsData_iOS_JS_Bridge.sensorsdata_abtest_module&&D.abBridge.hasAppBridge()?D.bridgeState="ab_bridge_ok":O.isObject(window.SensorsData_APP_New_H5_Bridge)&&O.isFunction(window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module)&&window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module()&&D.abBridge.hasAppBridge()?D.bridgeState="ab_bridge_ok":D.bridgeState="ab_no_abtest_bridge",void D.store.init(this.getResultFromApp,this))},setPara:function(t){var e=D.verifyStore.para("\u6253\u901a\u521d\u59cb\u5316",t,{timeout_milliseconds:"not_essential"});return D.para=O.extend({},D.default_para,e.para),O.isBoolean(D.para.collect_bridge_status)||(D.para.collect_bridge_status=!0),O.isNumber(D.para.update_interval)||(D.para.update_interval=6e5),D.sd.para.encrypt_cookie===!0&&(D.para.encrypt_cookie=!0),!0},getResultFromApp:function(t){function e(){"ab_bridge_ok"===D.bridgeState?D.abBridge.requestToApp({data:{properties:r.properties,timeout:n,request_body:{origin_platform:"H5"}},callback:function(t){O.isObject(t)&&O.isObject(t.data)?(O.log("\u6210\u529f\u83b7\u53d6\u5230 App \u7aef\u8fd4\u56de\u7684\u8bd5\u9a8c\u6570\u636e","data:",t),D.dealResponseData(t.data),i&&i(t)):(O.log("App \u7aef\u8bf7\u6c42\u5931\u8d25"),a&&a()),D.fetchData.setNextFetch()},timeout:{time:n,callback:function(){O.log("\u83b7\u53d6App\u7aef\u6570\u636e\u5931\u8d25"),a&&a(),D.fetchData.setNextFetch()}}}):a&&(O.log("A/B Testing \u6253\u901a\u5931\u8d25\uff0c",D.bridgeState),a())}t=O.isObject(t)?t:{};var r=t.para||{},i=t.suc,a=t.err,n=r.timeout_milliseconds||D.para.timeout_milliseconds;O.log("\u5411App\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),e()},asyncFetch:function(t){D.bridgeStore.getResultFromApp({para:t,suc:function(e){if(O.isObject(e.properties)&&(t.properties=O.extend(e.properties,t.properties)),"SUCCESS"===e.data.status){var r=D.getExpResult(t);t.callback(r)}else t.callback(t.default_value)},err:function(){t.callback(t.default_value)}})}},D.bridgeStore.methods={asyncFetchABTest:function(t){if(!O.isObject(t))return D.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=D.verifyStore.para("asyncFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});e.verify_success&&(t=e.para,"ab_bridge_ok"===D.bridgeState?D.bridgeStore.asyncFetch(t):t.callback(t.default_value))},fastFetchABTest:function(t){if(!O.isObject(t))return D.error("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=D.verifyStore.para("fastFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(e.verify_success){t=e.para;var r=D.searchLocalExp(t.param_name);if(O.isObject(r)){var i=D.getExpResult(t,r);t.callback(i)}else O.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),"ab_bridge_ok"===D.bridgeState?D.bridgeStore.asyncFetch(t):t.callback(t.default_value)}},fetchCacheABTest:function(t){if(!O.isObject(t))return void D.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e");var e=D.verifyStore.para("fetchCacheABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential"});if(e.verify_success)return D.getExpResult(e.para)}},D.normalStore={init:function(t){return!!this.setPara(t)&&(D.bridgeState="ab_no_host_bridge",/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?D.state.platform="H5":D.state.platform="Web",O.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f\uff0c\u8bd5\u9a8c URL\uff1a",t.url),D.checkSADebug(),void D.store.init(this.getResultFromServer,this))},setPara:function(t){if(!O.isString(t.url)||"http"!==t.url.slice(0,4))return O.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1;if("https"===location.protocol.slice(0,5)&&"http:"===t.url.slice(0,5))return O.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0chttps \u9875\u9762\u5fc5\u987b\u4f7f\u7528 https \u7684 URL"),!1;var e=O.getQueryParam(t.url,"project-key");if(!e)return O.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff08\u5fc5\u987b\u5305\u542b project-key\uff09\uff01"),!1;t.project_key=e;var r=D.verifyStore.para("A/B Testing SDK \u521d\u59cb\u5316",t,{timeout_milliseconds:"not_essential"});return D.para=O.extend({},D.default_para,r.para),O.isBoolean(D.para.collect_bridge_status)||(D.para.collect_bridge_status=!0),
O.isNumber(D.para.update_interval)||(D.para.update_interval=6e5),D.sd.para.encrypt_cookie===!0&&(D.para.encrypt_cookie=!0),!0},asyncFetch:function(t){D.normalStore.getResultFromServer({para:t,suc:function(e){if(O.isObject(e)&&"SUCCESS"===e.status){var r=D.getExpResult(t);t.callback(r)}else t.callback(t.default_value)},err:function(){t.callback(t.default_value)}})},creatRequestData:function(t){var e="";O.isEmptyObject(D.sd.store._state)||(e=D.sd.store._state._first_id||D.sd.store._state.first_id||D.sd.store._state._distinct_id||D.sd.store._state.distinct_id);var r={anonymous_id:e,platform:D.state.platform,abtest_lib_version:D.lib_version,properties:{$is_first_day:D.sd._.cookie.getNewUser()}};return O.isObject(t.properties)&&(r.properties=O.extend({},r.properties,t.properties)),D.sd.store._state.first_id&&(r.login_id=D.sd.store.getDistinctId()),r},getResultFromServer:function(t){function e(){var t=D.sd.store.getDistinctId();D.sd._.ajax({url:D.para.url,type:"POST",data:JSON.stringify(n),credentials:!1,contentType:"application/json",timeout:r.timeout_milliseconds||D.para.timeout_milliseconds,cors:!0,success:function(e){D.dealResponseData(e,t),i&&i(e),D.fetchData.setNextFetch()},error:function(t){O.log("\u670d\u52a1\u7aef\u8bf7\u6c42\u53d1\u9001\u5931\u8d25",t),a&&a(),D.fetchData.setNextFetch()}})}t=O.isObject(t)?t:{};var r=t.para||{},i=t.suc,a=t.err,n=this.creatRequestData(r);O.log("\u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),e()}},D.normalStore.methods={asyncFetchABTest:function(t){if(!O.isObject(t))return D.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=D.verifyStore.para("asyncFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});e.verify_success&&(t=e.para,D.normalStore.asyncFetch(t))},fastFetchABTest:function(t){if(!O.isObject(t))return D.error("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=D.verifyStore.para("fastFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(e.verify_success){t=e.para;var r=D.searchLocalExp(t.param_name);if(O.isObject(r)){var i=D.getExpResult(t,r);t.callback(i)}else O.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),D.normalStore.asyncFetch(t)}},fetchCacheABTest:function(t){if(!O.isObject(t))return void D.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e");var e=D.verifyStore.para("fetchCacheABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential"});if(e.verify_success)return D.getExpResult(e.para)}},window.MutationObserver||(window.MutationObserver=function(t){function e(t){this._watched=[],this._listener=t}function r(t){!function r(){var i=t.takeRecords();i.length&&t._listener(i,t),t._timeout=setTimeout(r,e._period)}()}function i(e){var r={type:null,target:null,addedNodes:[],removedNodes:[],previousSibling:null,nextSibling:null,attributeName:null,attributeNamespace:null,oldValue:null};for(var i in e)g(r,i)&&e[i]!==t&&(r[i]=e[i]);return r}function a(t,e){var r=c(t,e);return function(a){var n,s=a.length;e.charData&&3===t.nodeType&&t.nodeValue!==r.charData&&a.push(new i({type:"characterData",target:t,oldValue:r.charData})),e.attr&&r.attr&&o(a,t,r.attr,e.afilter),(e.kids||e.descendents)&&(n=l(a,t,r,e)),(n||a.length!==s)&&(r=c(t,e))}}function n(t,e){return e.value}function s(t,e){return"style"!==e.name?e.value:t.style.cssText}function o(t,e,r,a){for(var n,s,o={},l=e.attributes,c=l.length;c--;)n=l[c],s=n.name,a&&!g(a,s)||(v(e,n)!==r[s]&&t.push(i({type:"attributes",target:e,attributeName:s,oldValue:r[s],attributeNamespace:n.namespaceURI})),o[s]=!0);for(s in r)o[s]||t.push(i({target:e,type:"attributes",attributeName:s,oldValue:r[s]}))}function l(e,r,a,n){function s(t,r,a,s,c){for(var u,h,p,d=t.length-1,f=-~((d-c)/2);p=t.pop();)u=a[p.i],h=s[p.j],n.kids&&f&&Math.abs(p.i-p.j)>=d&&(e.push(i({type:"childList",target:r,addedNodes:[u],removedNodes:[u],nextSibling:u.nextSibling,previousSibling:u.previousSibling})),f--),n.attr&&h.attr&&o(e,u,h.attr,n.afilter),n.charData&&3===u.nodeType&&u.nodeValue!==h.charData&&e.push(i({type:"characterData",target:u,oldValue:h.charData})),n.descendents&&l(u,h)}function l(r,a){for(var p,d,g,_,m,v,b,y=r.childNodes,S=a.kids,k=y.length,w=S?S.length:0,x=0,T=0,A=0;T<k||A<w;)v=y[T],m=S[A],b=m&&m.node,v===b?(n.attr&&m.attr&&o(e,v,m.attr,n.afilter),n.charData&&m.charData!==t&&v.nodeValue!==m.charData&&e.push(i({type:"characterData",target:v,oldValue:m.charData})),d&&s(d,r,y,S,x),n.descendents&&(v.childNodes.length||m.kids&&m.kids.length)&&l(v,m),T++,A++):(c=!0,p||(p={},d=[]),v&&(p[g=h(v)]||(p[g]=!0,(_=u(S,v,A))===-1?n.kids&&(e.push(i({type:"childList",target:r,addedNodes:[v],nextSibling:v.nextSibling,previousSibling:v.previousSibling})),x++):d.push({i:T,j:_})),T++),b&&b!==y[T]&&(p[g=h(b)]||(p[g]=!0,(_=f(y,b,T))===-1?n.kids&&(e.push(i({type:"childList",target:a.node,removedNodes:[b],nextSibling:S[A+1],previousSibling:S[A-1]})),x--):d.push({i:_,j:A})),A++));d&&s(d,r,y,S,x)}var c;return l(r,a),c}function c(t,e){var r=!0;return function i(t){var a={node:t};return!e.charData||3!==t.nodeType&&8!==t.nodeType?(e.attr&&r&&1===t.nodeType&&(a.attr=d(t.attributes,function(r,i){return e.afilter&&!e.afilter[i.name]||(r[i.name]=v(t,i)),r},{})),r&&(e.kids||e.charData||e.attr&&e.descendents)&&(a.kids=p(t.childNodes,i)),r=e.descendents):a.charData=t.nodeValue,a}(t)}function u(t,e,r){return f(t,e,r,_("node"))}function h(t){try{return t.id||(t[y]=t[y]||b++)}catch(e){try{return t.nodeValue}catch(r){return b++}}}function p(t,e){for(var r=[],i=0;i<t.length;i++)r[i]=e(t[i],i,t);return r}function d(t,e,r){for(var i=0;i<t.length;i++)r=e(r,t[i],i,t);return r}function f(t,e,r,i){for(;r<t.length;r++)if((i?t[r][i]:t[r])===e)return r;return-1}function g(e,r){return e[r]!==t}function _(t){return t}e._period=30,e.prototype={observe:function(t,e){for(var i={attr:!!(e.attributes||e.attributeFilter||e.attributeOldValue),kids:!!e.childList,descendents:!!e.subtree,charData:!(!e.characterData&&!e.characterDataOldValue)},n=this._watched,s=0;s<n.length;s++)n[s].tar===t&&n.splice(s,1);e.attributeFilter&&(i.afilter=d(e.attributeFilter,function(t,e){return t[e]=!0,t},{})),n.push({tar:t,fn:a(t,i)}),this._timeout||r(this)},takeRecords:function(){for(var t=[],e=this._watched,r=0;r<e.length;r++)e[r].fn(t);return t},disconnect:function(){this._watched=[],clearTimeout(this._timeout),this._timeout=null}};var m=document.createElement("i");m.style.top=0,m="null"!=m.attributes.style.value;var v=m?n:s,b=1,y="mo_id";return e}(void 0)),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),r=this,i=function(){},a=function(){return r.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,a.prototype=new i,a}),A.prototype.init=function(t){this.initPara(t),this.enable_visualize!==!1&&(window.self!==window.top&&a()?(this.is_editor=!0,k(this.vabtest_url)):(this.start_time=(new Date).getTime(),this.use_mask&&this.initMask(),this.addSinglePageListener()))},A.prototype.initPara=function(t){if(O.isFunction(t))try{t=t()}catch(e){return O.log("ABTesting SDK  !"),void(this.para=!1)}if(!O.isObject(t))return void(this.para=!1);Object.prototype.hasOwnProperty.call(t,"enable_visualize")&&O.isBoolean(t.enable_visualize)?this.enable_visualize=t.enable_visualize:O.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 enable_visualize \u683c\u5f0f\u4e0d\u6b63\u786e\u3002 \u7c7b\u578b\u5e94\u4e3a Boolean"),this.use_mask=O.isBoolean(t.use_mask)?t.use_mask:this.use_mask,this.timeout=O.isNumber(t.timeout)&&t.timeout>=0?t.timeout:this.timeout;var r=O.isString(t.vabtest_url)?t.vabtest_url:"";r&&("https:"===location.protocol?"https:"===r.slice(0,6)?this.vabtest_url=r:O.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 vabtest_url \u534f\u8bae\u5934\u5e94\u8bbe\u7f6e\u4e3a https"):"http:"===r.slice(0,5)||"https:"===r.slice(0,6)?this.vabtest_url=r:O.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 vabtest_url \u5e94\u8bbe\u7f6e\u4e3a\u6709\u6548 URL"))},A.prototype.resolve=function(t){if(this.enable_visualize!==!1&&this.is_editor!==!0&&this.isFirst!==!1){if((new Date).getTime()-this.start_time>this.timeout)return O.log("\u8bf7\u6c42\u5b9e\u9a8c\u7ed3\u679c\u8d85\u65f6\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01"),!1;var e=this;this.isFirst=!1;var r=!1;O.each(t,function(t){if(!O.isObject(t)||"VISUAL"!==t.experiment_type)return!1;if(r)return!1;var i=t.experiment_value;if(!O.isArray(i))try{i=JSON.parse(t.experiment_value),t.experiment_value=i}catch(a){return!1}e.isTriggerVisualExp(t)&&(r=!0,e.prepareResource(t,e.render.bind(e)),e.visualExp=t)}),!r&&this.use_mask&&this.destroyMask(),n(window,function(){w(e.observerCallback.bind(e))})}},A.prototype.initMask=function(){this.mask_instance=new D.Mask("vabtest"),this.mask_instance.show(this.timeout)},A.prototype.destroyMask=function(){this.mask_instance&&this.mask_instance.remove()},A.prototype.prepareResource=function(t,e){var r=this,i=t.experiment_value;O.isArray(i)&&(O.each(i,function(i){function a(){var i=r.imgLoadingList.indexOf(o);i>-1&&r.imgLoadingList.splice(i,1),0===r.imgLoadingList.length&&e(t)}var n=i.tagName,s=i.props;if("img"===n&&s&&s.attributes&&O.isString(s.attributes.src)){var o=s.attributes.src;r.imgLoadingList.push(o);var l=document.createElement("img");l.width=1,l.height=1,l.onload=a,l.onerror=a,l.onabort=a,l.src=s.attributes.src}}),0===this.imgLoadingList.length&&e(t))},A.prototype.render=function(t){var e=this;n(window,function(){if(e.use_mask&&e.mask_instance&&e.mask_instance.is_timeout===!0)return void O.log("\u6e32\u67d3\u5b9e\u9a8c\u7ed3\u679c\u8d85\u65f6\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01");D.triggerHandle(t);var r=t.experiment_value;O.isArray(r)&&O.each(r,function(t){var r=t.selector,i=p(r);if(i)try{var a=x(i,[]),n=a.eleInfo;b(i,t,n),e.originData.push(a)}catch(s){}}),e.use_mask&&e.destroyMask()})},A.prototype.restoreElements=function(){O.each(this.originData,function(t){T(t)}),this.visualExp=null,this.isFirst=!0,this.start_time=(new Date).getTime(),this.originData=[]},A.prototype.addSinglePageListener=function(){var t=this;O.addSinglePageEvent(function(e){return e!==location.href&&(t.isFirst=!0,t.mask_instance&&t.destroyMask(),t.start_time=(new Date).getTime(),t.use_mask&&t.initMask(),t.restoreElements(),void t.resolve(D.originalData))})},A.prototype.observerCallback=function(){this.visualExp&&(O.each(this.originData,function(t){T(t)}),this.originData=[],this.render(this.visualExp))},A.prototype.stopTrigger=function(){this.isFirst=!1,O.log("\u8bf7\u6c42\u5b9e\u9a8c\u7ed3\u679c\u5931\u8d25\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01"),this.use_mask&&this.destroyMask()},A.prototype.isTriggerVisualExp=function(t){return O.isString(t.control_link)&&O.isString(t.link_match_type)?!!O.checkUrlIsMatch(t.control_link,t.link_match_type)||(O.log("\u53ef\u89c6\u5316\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",t.abtest_experiment_id),!1):(O.log("\u53ef\u89c6\u5316\u8bd5\u9a8c\u6570\u636e\u5f02\u5e38",t.abtest_experiment_id),!1)};var C=new A;return D.dealResponseData=function(t,e){O.isObject(t)?"SUCCESS"===t.status?O.isArray(t.results)&&(this.originalData=t.results,this.updateLocalData(t.results,e)):"FAILED"===t.status&&O.log("\u83b7\u53d6\u8bd5\u9a8c\u5931\u8d25\uff1aerror_type\uff1a"+t.error_type+",error\uff1a"+t.error):O.log("\u8bd5\u9a8c\u6570\u636e\u89e3\u6790\u5931\u8d25\uff0cresponse \uff1a",t)},D.updateLocalData=function(t,e){this.analyzeData(t),this.updateStorage(e),O.log("\u66f4\u65b0\u8bd5\u9a8c\u6570\u636e\u6210\u529f")},D.updateStorage=function(t){var e=(new Date).getTime(),r={data:this.originalData,updateTime:e,triggerList:this.triggerList,distinct_id:t||D.sd.store.getDistinctId()};this.setStorageData(r),this.updateTime=e},D.analyzeData=function(t){return O.isArray(t)?(D.link.resolve(t),C.resolve(t),void D.resolveVariables(t)):(O.log("\u89e3\u6790——\u6570\u636e\u683c\u5f0f\u9519\u8bef",t),!1)},D.triggerHandle=function(t,e){var r=O.isObject(e)&&O.isObject(e.properties)?e.properties:{},i=D.trackTestTrigger(t,r),a=t.abtest_experiment_id;if(O.isString(a)){var n=D.sd.store.getDistinctId();this.triggerList[n]&&O.isArray(this.triggerList[n])?(this.triggerList[n].push(a),this.triggerList[n]=O.unique(this.triggerList[n])):this.triggerList[n]=[a],this.updateStorage()}return i},D.trackTestTrigger=function(t,e){var r=D.sd.store.getDistinctId(),i=!0,a=!0;if(e=O.isObject(e)?e:{},!t.is_white_list){this.triggerList&&O.isObject(this.triggerList)&&("{}"!==JSON.stringify(this.triggerList)&&(a=!1),this.triggerList[r]&&O.isArray(this.triggerList[r])&&O.each(this.triggerList[r],function(e){e===t.abtest_experiment_id&&(i=!1)}));var n={$abtest_experiment_id:t.abtest_experiment_id,$abtest_experiment_group_id:t.abtest_experiment_group_id};if(D.para.collect_bridge_status&&(n.$sdk_bridge_status=D.bridgeState),a){var s="web_abtesting:"+this.lib_version;n.$lib_plugin_version=[s]}var o=O.extend(n,e);return i&&this.sd.track("$ABTestTrigger",o),this.sd.track("WebABTestTrigger",o),i}},D.checkSADebug=function(){var t=O.getQueryParam(location.href,"sensors_abtest_url"),e=O.getQueryParam(location.href,"feature_code"),r=+O.getQueryParam(location.href,"account_id");if(t.length&&e.length&&O.isNumber(r)&&0!==r){var i={distinct_id:D.sd.store.getDistinctId(),feature_code:e,account_id:r};D.sd._.ajax({url:t,type:"POST",data:JSON.stringify(i),credentials:!1,contentType:"application/json",timeout:D.para.timeout_milliseconds,cors:!0,success:function(){},error:function(t){O.log("distinct_id\u53d1\u9001\u5931\u8d25,err:",t)}})}},D.initMethods=function(t){var e=["asyncFetchABTest","fastFetchABTest","fetchCacheABTest"];O.each(e,function(e){D[e]=t.methods[e]})},D.fetchData={timer:null,method:null,context:null,init:function(t,e){this.method=t,this.context=e,this.start(!0)},getServerData:function(t){t?this.method.call(this.context,{suc:function(e){t&&("ab_bridge_ok"===D.bridgeState&&(e=e.data),O.isObject(e)&&"SUCCESS"===e.status&&O.isArray(e.results)||(D.link.stopTrigger(),C.stopTrigger()))},err:function(){t&&(D.link.stopTrigger(),C.stopTrigger())}}):this.method.call(this.context)},setNextFetch:function(t){var e=this,r=t||D.para.update_interval;this.clearFetchTimer(this.timer),this.timer=setTimeout(function(){e.getServerData()},r)},start:function(t){var e=null,r=(new Date).getTime(),i=D.getStorageData(),a=D.sd.store.getDistinctId();if(i&&O.isObject(i)&&i.distinct_id===a)if(e=i.updateTime,t&&(D.originalData=i.data,e&&O.isNumber(e)&&r-e>0&&r-e<D.para.session_limit&&O.isObject(i.triggerList)&&(D.triggerList=i.triggerList),D.analyzeData(i.data)),e&&O.isNumber(e)&&r-e>0&&r-e<D.para.update_interval){O.log("\u6570\u636e\u4e0d\u66f4\u65b0",e,r);var n=r-e,s=D.para.update_interval-n;this.setNextFetch(s)}else O.log("\u7f13\u5b58\u6570\u636e\u8d85\u65f6",e,r),this.getServerData(t);else e=D.updateTime,e&&O.isNumber(e)&&r-e>0&&r-e<D.para.update_interval?O.log("\u6570\u636e\u4e0d\u66f4\u65b0",e,r):this.getServerData(t)},stop:function(){O.log("\u6e05\u7a7a\u62c9\u53d6\u5b9a\u65f6\u5668"),this.clearFetchTimer()},clearFetchTimer:function(){clearTimeout(this.timer),this.timer=null}},D.store={init:function(t,e){D.fetchData.init(t,e),D.initMethods(e),D.listenPageState({visible:function(){O.log("\u9875\u9762\u663e\u793a"),D.fetchData.start()},hidden:function(){D.fetchData.stop()}}),D.sd.events.on("changeDistinctId",function(t){D.localdata={},D.originalData=[],C.restoreElements(),D.updateStorage(),D.fetchData.getServerData()}),D.sd.events.isReady()}},D.init=function(t,e){return this.sd?(this.log("A/B Testing SDK \u91cd\u590d\u521d\u59cb\u5316\uff01\u53ea\u6709\u7b2c\u4e00\u6b21\u521d\u59cb\u5316\u6709\u6548\uff01"),!1):(O.log=function(){return O.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]),t.log.apply(this,arguments)},this.getSA(t)?O.isObject(e)?("object"==typeof localStorage&&this.sd._.localStorage.isSupport()||(O.log("localstorage\u5f02\u5e38"),this.state.storage.isSupport=!1),this.abtestingPara=e,void this.initTest()):(O.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f20\u5165\u6b63\u786e\u7684\u521d\u59cb\u5316\u53c2\u6570!para:",e),!1):(this.log("A/B Testing \u521d\u59cb\u5316\u5931\u8d25,Web JS SDK \u6ca1\u6709\u521d\u59cb\u5316\u5b8c\u6210"),!1))},D.initTest=function(){this.link.init(this.abtestingPara.multilink),C.init(this.abtestingPara.visualize),this.sd.bridge.is_verify_success?this.bridgeStore.init(this.abtestingPara):this.normalStore.init(this.abtestingPara)},window.SensorsDataWebJSSDKPlugin&&"[object Object]"==Object.prototype.toString.call(window.SensorsDataWebJSSDKPlugin)?window.SensorsDataWebJSSDKPlugin.SensorsABTest=window.SensorsDataWebJSSDKPlugin.SensorsABTest||D:window.SensorsDataWebJSSDKPlugin={SensorsABTest:D},D});