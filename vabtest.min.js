!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var t,n,r=function(){function e(){var e=this;this.eventPool=new Map,this.on=function(t,n){var r=e.eventPool,i=r.get(t);i?r.set(t,[].concat(i,[n])):r.set(t,[n])},this.remove=function(t,n){var r=e.eventPool,i=r.get(t);if(i)return n?r.set(t,i.filter(function(e){return n!==e})):r["delete"](t)}}var t=e.prototype;return t.emit=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=this.eventPool.get(e);i&&i.forEach(function(e){e.apply(void 0,n)})},t.get=function(){var e;return(e=this.eventPool).get.apply(e,arguments)},t.has=function(){var e;return(e=this.eventPool).has.apply(e,arguments)},t["delete"]=function(){var e;return(e=this.eventPool)["delete"].apply(e,arguments)},t.forEach=function(){var e;return(e=this.eventPool).forEach.apply(e,arguments)},t.keys=function(){return this.eventPool.keys()},t.set=function(){var e;return(e=this.eventPool).set.apply(e,arguments)},e}();!function(e){e[e.connect=0]="connect",e[e.dispose=1]="dispose"}(t||(t={})),function(e){e.SUCCESS="SUCCESS",e.PENDING="PENDING",e.ERROR="ERROR",e.TIMEOUT="TIMEOUT"}(n||(n={}));var i=function(){var e=(new Date).getTime();return function(t){return Math.ceil((e=(9301*e+49297)%233280)/233280*t)}}();function o(){if("function"==typeof Uint32Array){var e="";if("undefined"!=typeof crypto?e=crypto:"undefined"!=typeof msCrypto&&(e=msCrypto),null!=(n=e)&&"[object Object]"==toString.call(n)&&e.getRandomValues){var t=new Uint32Array(1);return e.getRandomValues(t)[0]/Math.pow(2,32)}}var n;return i(1e19)/1e19}var a,s,l,c,u=function(e){return void 0===e&&(e=""),e+"@"+Date.now()+"@"+(t=0,n=10,o()*(n-t)+t);var t,n},d=function(){function t(i){var o=this;this.iframe=void 0,this.ENV="IFRAME",this.config={source:"",frameSource:""},this.context=void 0,this.messagePool=new r,this.receiveMessageHandle=function(r){var i=t.MessageDecode(null==r?void 0:r.data);if(o.config.debug&&console.log("[@FrameBridge:"+o.ENV+" receiveMessage type:"+(null==i?void 0:i.type)+" id:"+(null==i?void 0:i.$id)+" ]=>",i),null!=i&&i.$id){var a=i.$id,s=void 0===a?"":a,l=i.type,c=void 0===l?"":l;if(i.source===o.config.frameSource){var u=o.messagePool.has(s),d=o.messagePool.has(c);u&&o.messagePool.emit(s,{status:n.SUCCESS,payload:i}),d&&o.messagePool.emit(c,e({},i,{status:n.SUCCESS}))}}},this.iframeLoadHandle=function(){var e;(null==(e=o.iframe)?void 0:e.contentWindow)&&console.log("load success")},this.config=i,this.init()}t.MessageEncode=function(e,t){void 0===e&&(e={}),void 0===t&&(t=JSON.stringify({}));var n=t;try{n=encodeURIComponent(JSON.stringify(e))}catch(r){console.error("[@FrameBridge:error] MessageDecode error",r)}return n},t.MessageDecode=function(e,t){void 0===t&&(t=null);var n=t;try{n=JSON.parse(decodeURIComponent(e||""))}catch(r){n=t,console.warn("@FrameBridge MessageDecode error",r)}return n};var i=t.prototype;return i.emit=function(e,r,i){var o,a,s=this,l=(i||{}).timeout,c=void 0===l?51e3:l,d=this.config.source,h=u(this.ENV),m={$id:h,type:e,status:n.PENDING,payload:r,source:d};"IFRAME"===this.ENV?this.context=null==(o=window)?void 0:o.parent:this.context=null==(a=this.iframe)?void 0:a.contentWindow;return this.context?new Promise(function(e){var r,i;s.messagePool.on(h,function(t){e(t),s.messagePool.remove(h)}),c&&setTimeout(function(){s.messagePool.has(h)&&s.messagePool.emit(h,{status:n.TIMEOUT})},c),s.config.debug&&console.log("[@FrameBridge:"+s.ENV+" emit] => ",m),null==(r=s.context)||r.postMessage(t.MessageEncode(m),(null==(i=s.config)?void 0:i.origin)||"*")}):Promise.resolve({status:n.ERROR,message:"No communication environment,Please check config!"})},i.on=function(e,t){var n=this;this.messagePool.on(e,function(e){var r=e.$id;return t({reply:function(e){n.emit(r,e)}},e,n.config)})},i.destroy=function(){var e;window.removeEventListener("message",this.receiveMessageHandle),null==this||null==(e=this.iframe)||null==e.removeEventListener||e.removeEventListener("load",this.iframeLoadHandle)},i.init=function(){var e,t=this.config.container;if(t){this.ENV="CONTAINER";var n="string"===((e=t)===undefined?"undefined":null===e?"null":e.constructor.name.toLowerCase())?document.querySelector(t):t;if(this.iframe=n,!(n&&n instanceof HTMLIFrameElement))return console.error("[@FrameBridge:error]container is not IFRAME element!"),this;n.addEventListener("load",this.iframeLoadHandle)}else this.ENV="IFRAME";window.addEventListener("message",this.receiveMessageHandle,!1)},t}();!function(e){e.address="address",e.article="article",e.aside="aside",e.footer="footer",e.header="header",e.h1="h1",e.h2="h2",e.h3="h3",e.h4="h4",e.h5="h5",e.h6="h6",e.main="main",e.nav="nav",e.section="section",e.blockquote="blockquote",e.dd="dd",e.div="div",e.dl="dl",e.dt="dt",e.figcaption="figcaption",e.figure="figure",e.hr="hr",e.li="li",e.ol="ol",e.p="p",e.pre="pre",e.ul="ul",e.a="a",e.abbr="abbr",e.b="b",e.bdi="bdi",e.bdo="bdo",e.br="br",e.cite="cite",e.code="code",e.data="data",e.dfn="dfn",e.em="em",e.i="i",e.kbd="kbd",e.mark="mark",e.q="q",e.rp="rp",e.rt="rt",e.ruby="ruby",e.s="s",e.samp="samp",e.small="small",e.span="span",e.strong="strong",e.sub="sub",e.sup="sup",e.time="time",e.u="u",e["var"]="var",e.wbr="wbr",e.img="img",e.area="area",e.audio="audio",e.base="base",e.body="body",e.button="button",e.canvas="canvas",e.caption="caption",e.col="col",e.colgroup="colgroup",e.datalist="datalist",e.del="del",e.details="details",e.dialog="dialog",e.embed="embed",e.fieldset="fieldset",e.form="form",e.head="head",e.hgroup="hgroup",e.html="html",e.iframe="iframe",e.input="input",e.ins="ins",e.label="label",e.legend="legend",e.link="link",e.map="map",e.math="math",e.menu="menu",e.menuitem="menuitem",e.meta="meta",e.meter="meter",e.noscript="noscript",e.object="object",e.optgroup="optgroup",e.option="option",e.output="output",e.param="param",e.picture="picture",e.progress="progress",e.rb="rb",e.rtc="rtc",e.script="script",e.select="select",e.slot="slot",e.source="source",e.style="style",e.summary="summary",e.svg="svg",e.table="table",e.tbody="tbody",e.td="td",e.template="template",e.textarea="textarea",e.tfoot="tfoot",e.th="th",e.thead="thead",e.title="title",e.tr="tr",e.track="track",e.video="video"}(s||(s={})),function(e){e.connect="CONNECT",e.dispose="DISPOSE",e.setDevice="SET_DEVICE",e.setMode="SET_MODE",e.markElement="MARK_ELEMENT",e.cancelMarkElement="CANCEL_MARK_ELEMENT",e.selectElement="SELECT_ELEMENT",e.cancelSelectElement="CANCEL_SELECT_ELEMENT",e.addElementSnapshot="ADD_ELEMENT_SNAPSHOT",e.resetElementSnapshot="RESET_ELEMENT_SNAPSHOT",e.deleteElementSnapshot="DELETE_ELEMENT_SNAPSHOT",e.updateElementSnapshot="UPDATE_ELEMENT_SNAPSHOT",e.getElementSnapshot="GET_ELEMENT_SNAPSHOT",e.keydownEvent="KEY_DOWN",e.mouseupEvent="MOUSE_UP",e.mousemoveEvent="MOUSE_MOVE",e.wheelEvent="WHEEL_EVENT",e.getHtml="GET_HTML",e.checkUrl="CHECK_URL"}(l||(l={})),function(e){e.VIEW="VIEW",e.EDIT="EDIT"}(c||(c={}));var h=[s.img,s.a,s.h1,s.h2,s.h3,s.h4,s.h5,s.h6,s.span,s.div,s.li,s.ol,s.p,s.pre,s.ul,s.dd,s.i,s.dt,s.dl,s.b,s.dl,s.cite,s.em,s.mark,s.small,s.strong,s.sub,s.sup,s.u,s.button,s.td,s.title,s.label];(a={})[l.keydownEvent]={eventValues:["key","keyCode","ctrlKey","metaKey"],preventDefault:!0},a[l.mouseupEvent]={eventValues:[]},a[l.wheelEvent]={eventValues:["ctrlKey","metaKey","deltaY"],preventDefault:!0},a[l.mousemoveEvent]={eventValues:["clientX","clientY"]};var m={},f=Array.prototype,p=Object.prototype,v=f.slice,g=p.toString,E=p.hasOwnProperty,y=f.forEach,b=Array.isArray,S={};function P(){if(!window.name)return!1;try{var e=JSON.parse(decodeURIComponent(window.name||"")),t=e.is_vabtesting,n=e.source_url,r=e.link_match_type;return!(!0!==t||!m.checkUrlIsMatch(n,r))||(m.log("A/B Testing SDK \u9875\u9762\u5730\u5740\uff0c\u4e0e\u5f53\u524d\u5b9e\u9a8c URL \u4e0d\u5339\u914d\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1)}catch(i){return!1}}function D(e,t){if(!e||!e.parentNode||!e.parentNode.children)return!1;t=t&&t.join?t:[];var n=e.nodeName.toLowerCase();return e&&"body"!==n&&1==e.nodeType?(t.unshift(function(e){var t=e.parentNode&&9==e.parentNode.nodeType?-1:function(e){if(!e.parentNode)return-1;for(var t=0,n=e.tagName,r=e.parentNode.children,i=0;i<r.length;i++)if(r[i].tagName===n){if(e===r[i])return t;t++}return-1}(e);return e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))?"#"+e.getAttribute("id"):e.tagName.toLowerCase()+(~t?":nth-of-type("+(t+1)+")":"")}(e)),e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))?t.join(" > "):D(e.parentNode,t)):(t.unshift("body"),t.join(" > "))}function _(e,t){return e.currentStyle?e.currentStyle[t]:e.ownerDocument.defaultView.getComputedStyle(e,null).getPropertyValue(t)}function w(e){var t=e.getBoundingClientRect(),n=t.top+(document.body.scrollTop||document.documentElement.scrollTop),r=t.left+(document.body.scrollLeft||document.documentElement.scrollLeft);return{width:t.width,height:t.height,top:n,left:r,x:t.top,y:t.left}}function O(e){var t=e.childNodes,n="",r=!1;return m.each(t,function(e){!1===r&&3===e.nodeType&&(m.isString(e.textContent)||m.isString(e.innerText)||m.isString(e.nodeValue))&&(n=m.trim(e.textContent||e.innerText||e.nodeValue||""),r=!0)}),n}function N(e){if(!m.isString(e))return null;var t,n=e.split(">");return(t=function r(e){var t,i=n.shift();if(!i)return e;try{t=function(e,t){var n;if("body"===(e=m.trim(e)))return document.getElementsByTagName("body")[0];if(0===e.indexOf("#"))e=e.slice(1),n=document.getElementById(e);else if(e.indexOf(":nth-of-type")>-1){var r=e.split(":nth-of-type");if(!r[0]||!r[1])return null;var i=r[0],o=r[1].match(/\(([0-9]+)\)/);if(!o||!o[1])return null;var a=Number(o[1]);if(!(m.isElement(t)&&t.children&&t.children.length>0))return null;for(var s=t.children,l=0;l<s.length;l++)if(m.isElement(s[l])&&s[l].tagName.toLowerCase()===i&&0==--a){n=s[l];break}if(a>0)return null}return n||null}(i,e)}catch(o){t=null}return t&&m.isElement(t)?r(t):null}())&&m.isElement(t)?t:null}function C(e,t){var n=function(){var e,t={},n=navigator.userAgent.toLowerCase();return(e=n.match(/opera.([\d.]+)/))?t.opera=Number(e[1].split(".")[0]):(e=n.match(/msie ([\d.]+)/))?t.ie=Number(e[1].split(".")[0]):(e=n.match(/edge.([\d.]+)/))?t.edge=Number(e[1].split(".")[0]):(e=n.match(/firefox\/([\d.]+)/))?t.firefox=Number(e[1].split(".")[0]):(e=n.match(/chrome\/([\d.]+)/))?t.chrome=Number(e[1].split(".")[0]):(e=n.match(/version\/([\d.]+).*safari/))?t.safari=Number(e[1].match(/^\d*.\d*/)):(e=n.match(/trident\/([\d.]+)/))&&(t.ie=11),t}(),r=n.ie&&n.ie<9,i="";if(m.each(t,function(e,t){var n;r&&e.indexOf("rgba")>-1&&(e=(n=e.match(/[\d.]+/g)).length>=3?"rgb("+n[0]+","+n[1]+","+n[2]+")":"");var o=t.replace(/[A-Z]+/g,function(e){return"-"+e.toLowerCase()});i+=";"+o+": "+e}),""!==i){var o,a,s,l=e.style,c=l.cssText||"";!c||(a=";",(s=(o=c).length-a.length)>=0&&o.indexOf(a,s)==s)||(c+=";"),l.cssText=c+i}}function U(e,t,n){if(n||(n=function(e,t){var n=t.originProps,r={attributes:{}},i=n.attributes;return m.each(i.style||{},function(t,n){r.attributes.style[n]=_(e,n)}),Object.hasOwnProperty.call(n,"text")&&(r.attributes.text=O(e)),m.each(["src","href"],function(t){Object.hasOwnProperty.call(i,t)&&(r.attributes[t]=e[t])}),Object.hasOwnProperty.call(i,"target")&&(r.attributes.target=e.getAttribute("target")),r}(e,t)),function(e,t){var n=e.originProps,r=t.originProps,i=n.attributes,o=r.attributes,a=!0;return n.text&&n.text!==r.text&&(a=!1),i&&m.each(["src","href","target"],function(e){i[e]&&i[e]!==o[e]&&(a=!1)}),a}(t,n)){var r=t.props;m.isObject(r)&&T(e,r)}}function T(e,t){if(Object.hasOwnProperty.call(t,"attributes")){var n=t.attributes;Object.hasOwnProperty.call(n,"style")&&C(e,n.style),m.each(["href","target","src"],function(t){Object.hasOwnProperty.call(n,t)&&function(e,t,n){e.setAttribute(t,n)}(e,t,n[t])})}Object.hasOwnProperty.call(t,"text")&&function(e,t){var n=e.childNodes,r=!1;m.each(n,function(e){3===e.nodeType&&(r||(e.textContent?e.textContent=t:e.innerText?e.innerText=t:e.nodeValue=t,r=!0))})}(e,t.text)}function M(e){var t=e.getBoundingClientRect(),n=window.innerWidth?{w:window.innerWidth,h:window.innerHeight}:(document.compatMode="BackCompat")?{w:document.body.clientWidth,h:document.body.clientHeigth}:{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight},r=document.documentElement.scrollTop||document.body.scrollTop,i=document.documentElement.scrollLeft||document.body.scrollLeft,o=t.width,a=t.height,s=t.left+n.w/2-o/2+i,l=t.top-n.h/2+a/2+r;window.scrollTo(s,l)}function L(e,t){var n=e.tagName.toLowerCase(),r=function(e,t){var n={};return m.each(t||[],function(t){var r=t.replace(/[A-Z]+/g,function(e){return"-"+e.toLowerCase()});n[t]=_(e,r)}),n}(e,t),i={selector:D(e),originProps:{attributes:{style:r},text:O(e)},type:"text",tagName:n};return"a"===n&&(i.originProps.attributes.href=e.href,e.getAttribute("target")&&(i.originProps.attributes.target=e.getAttribute("target")),i.type="link"),"img"===n&&(i.originProps.attributes.src=e.src,i.type="img"),{originStyle:e.getAttribute("style"),eleInfo:i,ele:e}}function R(e){var t=e.eleInfo,n=e.ele;if(n){var r=e.originStyle;T(n,t.originProps),n.style.cssText=r||""}}m.each=function(e,t,n){if(null==e)return!1;if(y&&e.forEach===y)e.forEach(t,n);else if(m.isArray(e)&&e.length===+e.length){for(var r=0,i=e.length;r<i;r++)if(r in e&&t.call(n,e[r],r,e)===S)return!1}else for(var o in e)if(E.call(e,o)&&t.call(n,e[o],o,e)===S)return!1},m.extend=function(e){return m.each(v.call(arguments,1),function(t){for(var n in t)E.call(t,n)&&void 0!==t[n]&&(e[n]=t[n])}),e},m.isArray=b||function(e){return"[object Array]"===g.call(e)},m.isObject=function(e){return null!=e&&"[object Object]"==g.call(e)},m.isElement=function(e){return!(!e||1!==e.nodeType)},m.isString=function(e){return"[object String]"==g.call(e)},m.isBoolean=function(e){return"[object Boolean]"==g.call(e)},m.isNumber=function(e){return"[object Number]"==g.call(e)&&/[\d\.]+/.test(String(e))},m.unique=function(e){for(var t,n=[],r={},i=0;i<e.length;i++)(t=e[i])in r||(r[t]=!0,n.push(t));return n},m.decodeURIComponent=function(e){var t=e;try{t=decodeURIComponent(e)}catch(n){t=e}return t},m.getQueryParam=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=m.decodeURIComponent(e);var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===n||n&&"string"!=typeof n[1]&&n[1].length?"":m.decodeURIComponent(n[1])},m.indexOf=function(e,t){var n=e.indexOf;if(n)return n.call(e,t);for(var r=0;r<e.length;r++)if(t===e[r])return r;return-1},m.isFunction=function(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object Function]"==t||"[object AsyncFunction]"==t},m.isEmptyObject=function(e){if(m.isObject(e)){for(var t in e)if(E.call(e,t))return!1;return!0}return!1},m.map=function(e,t){var n=[];return null==e?n:Array.prototype.map&&e.map===Array.prototype.map?e.map(t):(m.each(e,function(e,r,i){n.push(t(e,r,i))}),n)},m.base64Decode=function(e){var t=m.map(atob(e).split(""),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)});return decodeURIComponent(t.join(""))},m.getURLSearchParams=function(e){for(var t=function(e){return decodeURIComponent(e)},n={},r=(e=e||"").substring(1).split("&"),i=0;i<r.length;i++){var o=r[i].indexOf("=");if(-1!==o){var a=r[i].substring(0,o),s=r[i].substring(o+1);a=t(a),s=t(s),n[a]=s}}return n},m.urlParse=function(e){var t=function(e){this._fields={Username:4,Password:5,Port:7,Protocol:2,Host:6,Path:8,URL:0,QueryString:9,Fragment:10},this._values={},this._regex=null,this._regex=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/,void 0!==e&&this._parse(e)};return t.prototype.setUrl=function(e){this._parse(e)},t.prototype._initValues=function(){for(var e in this._fields)this._values[e]=""},t.prototype.addQueryString=function(e){if("object"!=typeof e)return!1;var t=this._values.QueryString||"";for(var n in e)t=new RegExp(n+"[^&]+").test(t)?t.replace(new RegExp(n+"[^&]+"),n+"="+e[n]):"&"===t.slice(-1)?t+n+"="+e[n]:""===t?n+"="+e[n]:t+"&"+n+"="+e[n];this._values.QueryString=t},t.prototype.getUrl=function(){var e="";return e+=this._values.Origin,e+=this._values.Port?":"+this._values.Port:"",e+=this._values.Path,e+=this._values.QueryString?"?"+this._values.QueryString:"",e+=this._values.Fragment?"#"+this._values.Fragment:""},t.prototype.getUrl=function(){var e="";return e+=this._values.Origin,e+=this._values.Port?":"+this._values.Port:"",e+=this._values.Path,e+=this._values.QueryString?"?"+this._values.QueryString:""},t.prototype._parse=function(e){this._initValues();var t=this._regex.exec(e);for(var n in t||m.log("DPURLParser::_parse -> Invalid URL"),this._fields)"undefined"!=typeof t[this._fields[n]]&&(this._values[n]=t[this._fields[n]]);this._values.Hostname=this._values.Host.replace(/:\d+$/,""),this._values.Origin=this._values.Protocol+"://"+this._values.Hostname},new t(e)},m.URL=function(e){var t,n={};if("function"==typeof window.URL&&function(){try{return"http://modernizr.com/"===new URL("http://modernizr.com/").href}catch(e){return!1}}())(n=new URL(e)).searchParams||(n.searchParams=(t=m.getURLSearchParams(n.search),{get:function(e){return t[e]}}));else{!1===/^https?:\/\/.+/.test(e)&&m.log("Invalid URL");var r=m.urlParse(e);n.hash="",n.host=r._values.Host?r._values.Host+(r._values.Port?":"+r._values.Port:""):"",n.href=r._values.URL,n.password=r._values.Password,n.pathname=r._values.Path,n.port=r._values.Port,n.search=r._values.QueryString?"?"+r._values.QueryString:"",n.username=r._values.Username,n.hostname=r._values.Hostname,n.protocol=r._values.Protocol?r._values.Protocol+":":"",n.origin=r._values.Origin?r._values.Origin+(r._values.Port?":"+r._values.Port:""):"",n.searchParams=function(){var e=m.getURLSearchParams("?"+r._values.QueryString);return{get:function(t){return e[t]}}}()}return n},m.getQueryParam=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=m.decodeURIComponent(e);var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===n||n&&"string"!=typeof n[1]&&n[1].length?"":m.decodeURIComponent(n[1])},m.isEmptyObject=function(e){if(m.isObject(e)){for(var t in e)if(E.call(e,t))return!1;return!0}return!1},m.contentLoaded=function(e,t){var n=!1,r=!0,i=e.document,o=i.documentElement,a=i.addEventListener,s=a?"addEventListener":"attachEvent",l=a?"removeEventListener":"detachEvent",c=a?"":"on",u=function(r){"readystatechange"==r.type&&"complete"!=i.readyState||(("load"==r.type?e:i)[l](c+r.type,u,!1),!n&&(n=!0)&&t.call(e,r.type||r))},d=function(){try{o.doScroll("left")}catch(e){return void setTimeout(d,50)}u("poll")};if("complete"==i.readyState)t.call(e,"lazy");else{if(!a&&o.doScroll){try{r=!e.frameElement}catch(h){}r&&d()}i[s](c+"DOMContentLoaded",u,!1),i[s](c+"readystatechange",u,!1),e[s](c+"load",u,!1)}},m.secCheck={isHttpUrl:function(e){if("string"!=typeof e)return!1;return!1!==/^https?:\/\/.+/.test(e)||(m.log("Invalid URL"),!1)},removeScriptProtocol:function(e){if("string"!=typeof e)return"";for(var t=/^\s*javascript/i;t.test(e);)e=e.replace(t,"");return e}},m.addEvent=function(){function e(t){return t&&(t.preventDefault=e.preventDefault,t.stopPropagation=e.stopPropagation,t._getPath=e._getPath),t}e._getPath=function(){var e=this;return this.path||this.composedPath&&this.composedPath()||function(){try{var t=e.target,n=[t];if(null===t||null===t.parentElement)return[];for(;null!==t.parentElement;)t=t.parentElement,n.unshift(t);return n}catch(r){return[]}}()},e.preventDefault=function(){this.returnValue=!1},e.stopPropagation=function(){this.cancelBubble=!0};(function(t,n,r){if(t&&t.addEventListener)t.addEventListener(n,function(t){t._getPath=e._getPath,r.call(this,t)},!0);else{var i="on"+n,o=t[i];t[i]=function(t,n,r){return function(i){if(!(i=i||e(window.event)))return undefined;i.target=i.srcElement;var o,a,s=!0;return"function"==typeof r&&(o=r(i)),a=n.call(t,i),!1!==o&&!1!==a||(s=!1),s}}(t,r,o)}}).apply(null,arguments)},m.addSinglePageEvent=function(e){var t=location.href,n=window.history.pushState,r=window.history.replaceState;window.history.pushState=function(){n.apply(window.history,arguments),e(t),t=location.href},window.history.replaceState=function(){r.apply(window.history,arguments),e(t),t=location.href};var i=n?"popstate":"hashchange";m.addEvent(window,i,function(){e(t),t=location.href})},m.trim=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},m.checkUrlIsMatch=function(e,t){var n,r,i=m.URL(e);if("STRICT"===t)return location.href===i.href;if("FUZZY"===t){try{n=m.URL(location.href)}catch(o){return m.log("url \u89e3\u6790\u5931\u8d25",o),!1}try{r=m.URL(e)}catch(o){return m.log("control_url \u89e3\u6790\u5931\u8d25",o),!1}return n.host===r.host&&n.pathname===r.pathname}return m.log("link_match_type\u5b57\u6bb5\u5f02\u5e38",t),!1},m.checkUrlIsRegexp=function(e,t){var n;try{n=m.URL(location.href)}catch(o){return m.log("url \u89e3\u6790\u5931\u8d25",o),!1}try{var r=(t?new RegExp(e,t):new RegExp(e)).exec(n.href),i=!0;return!!r&&(m.each(r,function(e){e||(i=!1)}),i)}catch(o){return m.log("control_link\u5b57\u6bb5\u5f02\u5e38",o),!1}};class x{constructor(e){this.bridge=e.bridge,this.domEditor=e.domEditor;for(let e in l)m.isFunction(this[e])&&this.bridge.on(l[e],this[e].bind(this))}updateElementSnapshot(e,t){let n=t.payload,r=this.domEditor.getOriginDataBySelector(n.selector),i=r.ele;if(this.domEditor.updataServerData(n.selector,n),i){R(r),this.domEditor.editEleProps(n,r);let t=w(i);this.domEditor.setSelectElePostion(t),e.reply({status:"SUCCESS"})}else e.reply({status:"ERROR",message:"\u8be5\u5143\u7d20\u672a\u5728\u5f53\u524d\u9875\u9762\u51fa\u73b0\uff01",code:"4001"})}setMode(e,t){let n=t.payload.type,r=!0;this.domEditor.setMode(n),P()||(r=!1,this.domEditor.mode_type="VIEW"),e.reply({status:"SUCCESS",check_url:r})}resetElementSnapshot(e,t){let n=this,r=t.payload,i=[];this.domEditor.saveServerData(r),this.domEditor.restoreElements(),m.each(r,function(e){let t=n.domEditor.getOriginDataBySelector(e.selector);t.ele?n.domEditor.editEleProps(e,t):i.push(e)}),this.domEditor.resetSelectDivPostion(),this.domEditor.resetHoverDivPostion(),e.reply({status:"SUCCESS",no_found_list:i})}markElement(e,t){let n=t.payload,r=this.domEditor.getOriginDataBySelector(n.selector).ele;if(r){let t=w(r);this.domEditor.setHoverElePostion(t),e.reply({status:"SUCCESS"})}else e.reply({status:"ERROR",message:"\u8be5\u5143\u7d20\u672a\u5728\u5f53\u524d\u9875\u9762\u51fa\u73b0\uff01",code:"4001"})}selectElement(e,t){let n=t.payload,r=this.domEditor.getOriginDataBySelector(n.selector).ele;if(r){let t=w(r);this.domEditor.setSelectElePostion(t),M(r),e.reply({status:"SUCCESS"})}else e.reply({status:"ERROR",message:"\u8be5\u5143\u7d20\u672a\u5728\u5f53\u524d\u9875\u9762\u51fa\u73b0\uff01",code:"4001"})}addElementSnapshot(e,t){this.updateElementSnapshot(e,t)}deleteElementSnapshot(e,t){this.updateElementSnapshot(e,t)}getHtml(e){let t=document.getElementsByTagName("html")[0].outerHTML;t=t.replace(/class="sa-vabtest-mark"/g,'class="sa-vabtest-mark-hidden"'),e.reply({status:"SUCCESS",visual_dom:t,origin_url:location.href,dom_width:Math.max(document.body.scrollWidth,document.body.offsetWidth,document.documentElement.clientWidth,document.documentElement.scrollWidth,document.documentElement.offsetWidth),dom_height:Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)})}cancelSelectElement(e){this.domEditor.resetSelectDivPostion(),e.reply({status:"SUCCESS"})}cancelMarkElement(e){this.domEditor.resetHoverDivPostion(),e.reply({status:"SUCCESS"})}checkUrl(e){let t=!0;P()||(t=!1,this.domEditor.mode_type="VIEW"),e.reply({status:t?"SUCCESS":"ERROR"})}}class k{constructor(e){this.bridge=e.bridge,this.domEditor=e.domEditor,this.tagNames=h}init(e){this.config=e,this.addLisenter()}addLisenter(){let e=this.config.action;var t;e.KEY_DOWN&&m.addEvent(document.body,"keydown",this.keydownHandler.bind(this)),e.MOUSE_UP&&m.addEvent(document.body,"mouseup",this.mouseupHandler.bind(this)),e.WHEEL_EVENT&&m.addEvent(document.body,"wheel",this.wheelHandler.bind(this)),m.addEvent(document,"mousemove",this.moveHandler.bind(this)),m.addEvent(document,"click",this.clickHandler.bind(this),!0),m.addSinglePageEvent(this.singlePage.bind(this)),t=this.mutationObserver.bind(this),new(0,window.MutationObserver)(t).observe(document.body,{childList:!0,subtree:!0})}elementFilter(e){if(e){let t=e.tagName.toLowerCase();if(this.tagNames.indexOf(t)>-1){if("a"===t||"img"===t)return e;return this.domEditor.getOriginDataByElement(e).eleInfo.originProps.text?e:null}}return null}getMouseElement(e){let t=null;return m.each(e,function(e){!t&&m.isString(e.className)&&-1===e.className.indexOf("sa-vabtest-mark")&&(t=e)}),t}moveHandler(e){let t=this.config.action;if(t.MOUSE_MOVE&&t.MOUSE_MOVE&&t.MOUSE_MOVE.eventValues&&m.isArray(t.MOUSE_MOVE.eventValues)){let n={};m.each(t.MOUSE_MOVE.eventValues,function(t){n[t]=e[t]}),this.bridge.emit(l.mousemoveEvent,n)}if("EDIT"!==this.domEditor.mode_type)return;let n=document.elementsFromPoint(e.clientX,e.clientY),r=this.getMouseElement(n),i=this.elementFilter(r);if(i){let e=w(i);this.domEditor.setHoverElePostion(e)}else this.domEditor.resetHoverDivPostion()}clickHandler(e){if("EDIT"!==this.domEditor.mode_type)return;e.stopPropagation(),e.preventDefault();let t=document.elementsFromPoint(e.clientX,e.clientY),n=this.getMouseElement(t),r=this.elementFilter(n);if(r){let e=this.domEditor.getOriginDataByElement(r).eleInfo,t=e.selector,n=this.domEditor.getServerDataBySelector(t),i=m.extend(n||{isModify:!1},e),o=w(r);this.domEditor.setSelectElePostion(o),this.bridge.emit(l.selectElement,i)}else this.domEditor.resetSelectDivPostion(),this.bridge.emit(l.cancelSelectElement,{status:!0})}keydownHandler(e){let t={},n=this.config.action,r=(e.ctrlKey||e.metaKey?"cmd+":"")+e.key;"cmd+-"!==r&&"cmd+="!==r&&"Escape"!==r||(!0===n.KEY_DOWN.preventDefault&&e.preventDefault(),n.KEY_DOWN.eventValues&&m.isArray(n.KEY_DOWN.eventValues)&&m.each(n.KEY_DOWN.eventValues,function(n){t[n]=e[n]}),this.bridge.emit(l.keydownEvent,t))}mouseupHandler(e){let t={},n=this.config.action;n.MOUSE_UP&&(!0===n.MOUSE_UP.preventDefault&&e.preventDefault(),n.MOUSE_UP.eventValues&&m.isArray(n.MOUSE_UP.eventValues)&&m.each(n.MOUSE_UP.eventValues,function(n){t[n]=e[n]}),this.bridge.emit(l.mouseupEvent,t))}wheelHandler(e){let t={},n=this.config.action;n.WHEEL_EVENT&&(!0===n.WHEEL_EVENT.preventDefault&&e.preventDefault(),n.WHEEL_EVENT.eventValues&&m.isArray(n.WHEEL_EVENT.eventValues)&&m.each(n.WHEEL_EVENT.eventValues,function(n){t[n]=e[n]}),this.bridge.emit(l.wheelEvent,t))}singlePage(e){if(e===location.href)return!1;let t=!0;P()||(t=!1,this.domEditor.mode_type="VIEW"),this.bridge.emit(l.checkUrl,{status:t?"SUCCESS":"ERROR"})}mutationObserver(){let e=this;m.each(e.domEditor.serverData,function(t){let n=e.domEditor.getOriginDataBySelector(t.selector);n.ele&&e.domEditor.editEleProps(t,n)})}}class A{constructor(e){this.config=e.config,this.hoverDiv=null,this.selectDiv=null,this.maskDiv=null,this.mode_type="EDIT",this.serverData=[],this.originData=[],this.buildMarkDom()}setDomPostion(e,t){m.each(["width","height","left","top"],function(n){e.style[n]=t[n]+"px"})}setHoverElePostion(e){this.selectDiv&&this.hoverDiv||this.buildMarkDom(),this.setDomPostion(this.hoverDiv,e)}setSelectElePostion(e){this.selectDiv&&this.hoverDiv||this.buildMarkDom(),this.setDomPostion(this.selectDiv,e)}restoreElements(){m.each(this.originData,function(e){R(e)}),this.originData=[]}editEleProps(e,t){let n=t.eleInfo;U(t.ele,e,n)}setMode(e){var t;this.mode_type=e,"VIEW"===e&&((t=this.maskDiv)&&t.parentNode.removeChild(t),this.hoverDiv=null,this.selectDiv=null,this.maskDiv=null)}resetMarkDom(e){e&&this.setDomPostion(e,{width:0,height:0,top:0,left:0})}resetSelectDivPostion(){this.selectDiv&&this.hoverDiv||this.buildMarkDom(),this.setDomPostion(this.selectDiv,{width:0,height:0,top:0,left:0})}resetHoverDivPostion(){this.selectDiv&&this.hoverDiv||this.buildMarkDom(),this.setDomPostion(this.hoverDiv,{width:0,height:0,top:0,left:0})}buildMarkDom(){var e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("style");e.className="sa-vabtest-mark",t.className="sa-vabtest-hover",n.className="sa-vabtest-clickable";var i=e.attachShadow({mode:"open"});r.innerText=".sa-vabtest-clickable { background: rgba(44, 123, 242, 0.2) !important; outline: 2px solid #2C7BF2 !important; outline-offset: -2px !important; width: 0;height: 0;position: absolute; top: 0; left: 0;}.sa-vabtest-hover { outline: 2px solid #2C7BF2 !important; outline-offset: -2px !important;  width: 0;height: 0;position: absolute; top: 0; left: 0;}",i.appendChild(r),i.appendChild(t),i.appendChild(n),document.body.appendChild(e),function(e){var t=document.createElement("style");t.type="text/css";try{t.appendChild(document.createTextNode(e))}catch(n){t.styleSheet.cssText=e}document.getElementsByTagName("head")[0].appendChild(t)}(".sa-vabtest-mark { pointer-events: none;}.sa-vabtest-mark-hidden { display: none;}"),this.hoverDiv=t,this.selectDiv=n,this.maskDiv=e}saveServerData(e){this.serverData=e}updataServerData(e,t){let n=!1,r=this;m.each(this.serverData,function(i,o){i.selector===e&&(r.serverData[o]=t,n=!0)}),n||this.serverData.push(t)}getServerDataBySelector(e){let t=null;return m.each(this.serverData,function(n){n.selector===e&&(t=n)}),t}setOriginData(e,t){let n=!1,r=this;m.each(this.originData,function(t,i){e===t.selector&&(r.originData[i]=t,n=!0)}),n||this.originData.push(t)}getOriginDataBySelector(e){let t=null;if(m.each(this.originData,function(n){e===n.eleInfo.selector&&(t=n)}),!t){let n=N(e);n?(t=L(n,this.config.styles),this.setOriginData(t.eleInfo.selector,t)):t={}}return t}getOriginDataByElement(e){let t=null;return m.each(this.originData,function(n){e===n.ele&&(t=n)}),t||(t=L(e,this.config.styles),this.setOriginData(t.eleInfo.selector,t)),t}}let H=new class{constructor(){this.abTestingSDK=null,this.bridge=new d({source:"sa-web-abtesting-sdk",frameSource:"sa-fe-abtesting-mode",version:"0.0.8"})}init(){let e=this;this.abTestingSDK=window.SensorsDataWebJSSDKPlugin&&"[object Object]"==Object.prototype.toString.call(window.SensorsDataWebJSSDKPlugin)&&window.SensorsDataWebJSSDKPlugin.SensorsABTest||!1,this.abTestingSDK?(m.log=this.abTestingSDK.sd.log,this.bridge.emit(l.connect,{status:!0}).then(function(t){if("SUCCESS"===t.status){let n=t.payload.support;e.domEditor=new A({config:n}),e.sender=new k({bridge:e.bridge,domEditor:e.domEditor}),new x({bridge:e.bridge,domEditor:e.domEditor}),e.sender.init(n)}else m.log("ABTesting SDK \u53ef\u89c6\u5316\u7f16\u8f91\u72b6\u6001\u521d\u59cb\u5316\u5931\u8d25")})):m.log("ABTesting SDK \u53ef\u89c6\u5316\u7f16\u8f91\u72b6\u6001\u521d\u59cb\u5316\u5931\u8d25")}};!function(e,t){e=e||window;var n=!1,r=!0,i=e.document,o=i.documentElement,a=i.addEventListener,s=a?"addEventListener":"attachEvent",l=a?"removeEventListener":"detachEvent",c=a?"":"on",u=function(r){"readystatechange"==r.type&&"complete"!=i.readyState||(("load"==r.type?e:i)[l](c+r.type,u,!1),!n&&(n=!0)&&t.call(e,r.type||r))},d=function(){try{o.doScroll("left")}catch(e){return void setTimeout(d,50)}u("poll")};if("complete"==i.readyState)t.call(e,"lazy");else{if(!a&&o.doScroll){try{r=!e.frameElement}catch(h){}r&&d()}i[s](c+"DOMContentLoaded",u,!1),i[s](c+"readystatechange",u,!1),e[s](c+"load",u,!1)}}(window,H.init.bind(H))});