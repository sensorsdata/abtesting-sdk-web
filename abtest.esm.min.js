var SensorsABTest={sd:null,lib_version:"0.0.10",para:{},default_para:{url:"",path:"",project_key:"",timeout_milliseconds:3e3,update_interval:6e5,collect_bridge_status:!0,session_limit:6e5,encrypt_cookie:!1},value_type_list:["Number","String","Object","Boolean"],state:{platform:"",storage:{isSupport:!0,name:"sawebjssdkabtest"}},bridgeState:"",localdata:{},originalData:[],triggerList:{},updateTime:null},_={},ArrayProto=Array.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeIsArray=Array.isArray,breaker={};_.each=function(e,t,s){if(null==e)return!1;if(nativeForEach&&e.forEach===nativeForEach)e.forEach(t,s);else if(_.isArray(e)&&e.length===+e.length){for(var r=0,i=e.length;r<i;r++)if(r in e&&t.call(s,e[r],r,e)===breaker)return!1}else for(var n in e)if(hasOwnProperty.call(e,n)&&t.call(s,e[n],n,e)===breaker)return!1},_.extend=function(e){return _.each(slice.call(arguments,1),function(t){for(var s in t)hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s])}),e},_.isArray=nativeIsArray||function(e){return"[object Array]"===toString.call(e)},_.isObject=function(e){return null!=e&&"[object Object]"==toString.call(e)},_.isElement=function(e){return!(!e||1!==e.nodeType)},_.isString=function(e){return"[object String]"==toString.call(e)},_.isBoolean=function(e){return"[object Boolean]"==toString.call(e)},_.isNumber=function(e){return"[object Number]"==toString.call(e)&&/[\d\.]+/.test(String(e))},_.unique=function(e){for(var t,s=[],r={},i=0;i<e.length;i++)(t=e[i])in r||(r[t]=!0,s.push(t));return s},_.decodeURIComponent=function(e){var t=e;try{t=decodeURIComponent(e)}catch(s){t=e}return t},_.getQueryParam=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=_.decodeURIComponent(e);var s=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===s||s&&"string"!=typeof s[1]&&s[1].length?"":_.decodeURIComponent(s[1])},_.indexOf=function(e,t){var s=e.indexOf;if(s)return s.call(e,t);for(var r=0;r<e.length;r++)if(t===e[r])return r;return-1},_.isFunction=function(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object Function]"==t||"[object AsyncFunction]"==t},_.isEmptyObject=function(e){if(_.isObject(e)){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0}return!1},_.map=function(e,t){var s=[];return null==e?s:Array.prototype.map&&e.map===Array.prototype.map?e.map(t):(_.each(e,function(e,r,i){s.push(t(e,r,i))}),s)},_.base64Decode=function(e){var t=_.map(atob(e).split(""),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)});return decodeURIComponent(t.join(""))},_.getURLSearchParams=function(e){for(var t=function(e){return decodeURIComponent(e)},s={},r=(e=e||"").substring(1).split("&"),i=0;i<r.length;i++){var n=r[i].indexOf("=");if(-1!==n){var a=r[i].substring(0,n),o=r[i].substring(n+1);a=t(a),o=t(o),s[a]=o}}return s},_.urlParse=function(e){var t=function(e){this._fields={Username:4,Password:5,Port:7,Protocol:2,Host:6,Path:8,URL:0,QueryString:9,Fragment:10},this._values={},this._regex=null,this._regex=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/,void 0!==e&&this._parse(e)};return t.prototype.setUrl=function(e){this._parse(e)},t.prototype._initValues=function(){for(var e in this._fields)this._values[e]=""},t.prototype.addQueryString=function(e){if("object"!=typeof e)return!1;var t=this._values.QueryString||"";for(var s in e)t=new RegExp(s+"[^&]+").test(t)?t.replace(new RegExp(s+"[^&]+"),s+"="+e[s]):"&"===t.slice(-1)?t+s+"="+e[s]:""===t?s+"="+e[s]:t+"&"+s+"="+e[s];this._values.QueryString=t},t.prototype.getUrl=function(){var e="";return e+=this._values.Origin,e+=this._values.Port?":"+this._values.Port:"",e+=this._values.Path,e+=this._values.QueryString?"?"+this._values.QueryString:"",e+=this._values.Fragment?"#"+this._values.Fragment:""},t.prototype.getUrl=function(){var e="";return e+=this._values.Origin,e+=this._values.Port?":"+this._values.Port:"",e+=this._values.Path,e+=this._values.QueryString?"?"+this._values.QueryString:""},t.prototype._parse=function(e){this._initValues();var t=this._regex.exec(e);for(var s in t||_.log("DPURLParser::_parse -> Invalid URL"),this._fields)"undefined"!=typeof t[this._fields[s]]&&(this._values[s]=t[this._fields[s]]);this._values.Hostname=this._values.Host.replace(/:\d+$/,""),this._values.Origin=this._values.Protocol+"://"+this._values.Hostname},new t(e)},_.URL=function(e){var t,s={};if("function"==typeof window.URL&&function(){try{return"http://modernizr.com/"===new URL("http://modernizr.com/").href}catch(e){return!1}}())(s=new URL(e)).searchParams||(s.searchParams=(t=_.getURLSearchParams(s.search),{get:function(e){return t[e]}}));else{!1===/^https?:\/\/.+/.test(e)&&_.log("Invalid URL");var r=_.urlParse(e);s.hash="",s.host=r._values.Host?r._values.Host+(r._values.Port?":"+r._values.Port:""):"",s.href=r._values.URL,s.password=r._values.Password,s.pathname=r._values.Path,s.port=r._values.Port,s.search=r._values.QueryString?"?"+r._values.QueryString:"",s.username=r._values.Username,s.hostname=r._values.Hostname,s.protocol=r._values.Protocol?r._values.Protocol+":":"",s.origin=r._values.Origin?r._values.Origin+(r._values.Port?":"+r._values.Port:""):"",s.searchParams=function(){var e=_.getURLSearchParams("?"+r._values.QueryString);return{get:function(t){return e[t]}}}()}return s},_.getQueryParam=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=_.decodeURIComponent(e);var s=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===s||s&&"string"!=typeof s[1]&&s[1].length?"":_.decodeURIComponent(s[1])},_.isEmptyObject=function(e){if(_.isObject(e)){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0}return!1},_.contentLoaded=function(e,t){var s=!1,r=!0,i=e.document,n=i.documentElement,a=i.addEventListener,o=a?"addEventListener":"attachEvent",l=a?"removeEventListener":"detachEvent",c=a?"":"on",u=function(r){"readystatechange"==r.type&&"complete"!=i.readyState||(("load"==r.type?e:i)[l](c+r.type,u,!1),!s&&(s=!0)&&t.call(e,r.type||r))},_=function(){try{n.doScroll("left")}catch(e){return void setTimeout(_,50)}u("poll")};if("complete"==i.readyState)t.call(e,"lazy");else{if(!a&&n.doScroll){try{r=!e.frameElement}catch(h){}r&&_()}i[o](c+"DOMContentLoaded",u,!1),i[o](c+"readystatechange",u,!1),e[o](c+"load",u,!1)}},_.secCheck={isHttpUrl:function(e){if("string"!=typeof e)return!1;return!1!==/^https?:\/\/.+/.test(e)||(_.log("Invalid URL"),!1)},removeScriptProtocol:function(e){if("string"!=typeof e)return"";for(var t=/^\s*javascript/i;t.test(e);)e=e.replace(t,"");return e}},_.addEvent=function(){function e(t){return t&&(t.preventDefault=e.preventDefault,t.stopPropagation=e.stopPropagation,t._getPath=e._getPath),t}e._getPath=function(){var e=this;return this.path||this.composedPath&&this.composedPath()||function(){try{var t=e.target,s=[t];if(null===t||null===t.parentElement)return[];for(;null!==t.parentElement;)t=t.parentElement,s.unshift(t);return s}catch(r){return[]}}()},e.preventDefault=function(){this.returnValue=!1},e.stopPropagation=function(){this.cancelBubble=!0};(function(t,s,r){if(t&&t.addEventListener)t.addEventListener(s,function(t){t._getPath=e._getPath,r.call(this,t)},!0);else{var i="on"+s,n=t[i];t[i]=function(t,s,r){return function(i){if(!(i=i||e(window.event)))return undefined;i.target=i.srcElement;var n,a,o=!0;return"function"==typeof r&&(n=r(i)),a=s.call(t,i),!1!==n&&!1!==a||(o=!1),o}}(t,r,n)}}).apply(null,arguments)},_.addSinglePageEvent=function(e){var t=location.href,s=window.history.pushState,r=window.history.replaceState;window.history.pushState=function(){s.apply(window.history,arguments),e(t),t=location.href},window.history.replaceState=function(){r.apply(window.history,arguments),e(t),t=location.href};var i=s?"popstate":"hashchange";_.addEvent(window,i,function(){e(t),t=location.href})},_.trim=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},_.checkUrlIsMatch=function(e,t){var s,r,i=_.URL(e);if("STRICT"===t)return location.href===i.href;if("FUZZY"===t){try{s=_.URL(location.href)}catch(n){return _.log("url \u89e3\u6790\u5931\u8d25",n),!1}try{r=_.URL(e)}catch(n){return _.log("control_url \u89e3\u6790\u5931\u8d25",n),!1}return s.host===r.host&&s.pathname===r.pathname}return _.log("link_match_type\u5b57\u6bb5\u5f02\u5e38",t),!1},_.checkUrlIsRegexp=function(e,t){var s;try{s=_.URL(location.href)}catch(n){return _.log("url \u89e3\u6790\u5931\u8d25",n),!1}try{var r=(t?new RegExp(e,t):new RegExp(e)).exec(s.href),i=!0;return!!r&&(_.each(r,function(e){e||(i=!1)}),i)}catch(n){return _.log("control_link\u5b57\u6bb5\u5f02\u5e38",n),!1}};var flag_dfm="dfm-enc-";function dfmapping(e){var t="t6KJCZa5pDdQ9khoEM3Tj70fbP2eLSyc4BrsYugARqFIw1mzlGNVXOHiWvxUn8",s=t.length-1,r={},i=0;for(i=0;i<t.length;i++)r[t.charAt(i)]=t.charAt(s-i);var n="";for(i=0;i<e.length;i++)e.charAt(i)in r?n+=r[e.charAt(i)]:n+=e.charAt(i);return n}function decrypt(e){return 0===e.indexOf(flag_dfm)&&(e=dfmapping(e=e.substring(flag_dfm.length))),e}function encrypt(e){return flag_dfm+dfmapping(e)}function getUA(){var e,t={},s=navigator.userAgent.toLowerCase();return(e=s.match(/opera.([\d.]+)/))?t.opera=Number(e[1].split(".")[0]):(e=s.match(/msie ([\d.]+)/))?t.ie=Number(e[1].split(".")[0]):(e=s.match(/edge.([\d.]+)/))?t.edge=Number(e[1].split(".")[0]):(e=s.match(/firefox\/([\d.]+)/))?t.firefox=Number(e[1].split(".")[0]):(e=s.match(/chrome\/([\d.]+)/))?t.chrome=Number(e[1].split(".")[0]):(e=s.match(/version\/([\d.]+).*safari/))?t.safari=Number(e[1].match(/^\d*.\d*/)):(e=s.match(/trident\/([\d.]+)/))&&(t.ie=11),t}function validateProject(){if(!window.name)return!1;try{var e=JSON.parse(decodeURIComponent(window.name||"")),t=e.is_vabtesting,s=e.source_url,r=e.link_match_type;return!(!0!==t||!_.checkUrlIsMatch(s,r))||(_.log("A/B Testing SDK \u9875\u9762\u5730\u5740\uff0c\u4e0e\u5f53\u524d\u5b9e\u9a8c URL \u4e0d\u5339\u914d\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1)}catch(i){return!1}}function bindReady(e,t){e=e||window;var s=!1,r=!0,i=e.document,n=i.documentElement,a=i.addEventListener,o=a?"addEventListener":"attachEvent",l=a?"removeEventListener":"detachEvent",c=a?"":"on",u=function(r){"readystatechange"==r.type&&"complete"!=i.readyState||(("load"==r.type?e:i)[l](c+r.type,u,!1),!s&&(s=!0)&&t.call(e,r.type||r))},_=function(){try{n.doScroll("left")}catch(e){return void setTimeout(_,50)}u("poll")};if("complete"==i.readyState)t.call(e,"lazy");else{if(!a&&n.doScroll){try{r=!e.frameElement}catch(h){}r&&_()}i[o](c+"DOMContentLoaded",u,!1),i[o](c+"readystatechange",u,!1),e[o](c+"load",u,!1)}}function getDomIndex(e){if(!e.parentNode)return-1;for(var t=0,s=e.tagName,r=e.parentNode.children,i=0;i<r.length;i++)if(r[i].tagName===s){if(e===r[i])return t;t++}return-1}function selector(e){var t=e.parentNode&&9==e.parentNode.nodeType?-1:getDomIndex(e);return e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))?"#"+e.getAttribute("id"):e.tagName.toLowerCase()+(~t?":nth-of-type("+(t+1)+")":"")}function getDomSelector(e,t){if(!e||!e.parentNode||!e.parentNode.children)return!1;t=t&&t.join?t:[];var s=e.nodeName.toLowerCase();return e&&"body"!==s&&1==e.nodeType?(t.unshift(selector(e)),e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))?t.join(" > "):getDomSelector(e.parentNode,t)):(t.unshift("body"),t.join(" > "))}function getStyle(e,t){return e.currentStyle?e.currentStyle[t]:e.ownerDocument.defaultView.getComputedStyle(e,null).getPropertyValue(t)}function getElementStyles(e,t){var s={};return _.each(t||[],function(t){var r=t.replace(/[A-Z]+/g,function(e){return"-"+e.toLowerCase()});s[t]=getStyle(e,r)}),s}function getElementText(e){var t=e.childNodes,s="",r=!1;return _.each(t,function(e){!1===r&&3===e.nodeType&&(_.isString(e.textContent)||_.isString(e.innerText)||_.isString(e.nodeValue))&&(s=_.trim(e.textContent||e.innerText||e.nodeValue||""),r=!0)}),s}function getDomBySelector(e){if(!_.isString(e))return null;var t,s=e.split(">");return(t=function r(e){var t,i=s.shift();if(!i)return e;try{t=function(e,t){var s;if("body"===(e=_.trim(e)))return document.getElementsByTagName("body")[0];if(0===e.indexOf("#"))e=e.slice(1),s=document.getElementById(e);else if(e.indexOf(":nth-of-type")>-1){var r=e.split(":nth-of-type");if(!r[0]||!r[1])return null;var i=r[0],n=r[1].match(/\(([0-9]+)\)/);if(!n||!n[1])return null;var a=Number(n[1]);if(!(_.isElement(t)&&t.children&&t.children.length>0))return null;for(var o=t.children,l=0;l<o.length;l++)if(_.isElement(o[l])&&o[l].tagName.toLowerCase()===i&&0==--a){s=o[l];break}if(a>0)return null}return s||null}(i,e)}catch(n){t=null}return t&&_.isElement(t)?r(t):null}())&&_.isElement(t)?t:null}function rgbaToRgb(e){var t=e.match(/[\d.]+/g);return t.length>=3?"rgb("+t[0]+","+t[1]+","+t[2]+")":""}function changeStyle(e,t){var s=getUA(),r=s.ie&&s.ie<9,i="";if(_.each(t,function(e,t){r&&e.indexOf("rgba")>-1&&(e=rgbaToRgb(e));var s=t.replace(/[A-Z]+/g,function(e){return"-"+e.toLowerCase()});i+=";"+s+": "+e}),""!==i){var n,a,o,l=e.style,c=l.cssText||"";!c||(a=";",(o=(n=c).length-a.length)>=0&&n.indexOf(a,o)==o)||(c+=";"),l.cssText=c+i}}function changeText(e,t){var s=e.childNodes,r=!1;_.each(s,function(e){3===e.nodeType&&(r||(e.textContent?e.textContent=t:e.innerText?e.innerText=t:e.nodeValue=t,r=!0))})}function propsFilter(e,t){var s=e.originProps,r=t.originProps,i=s.attributes,n=r.attributes,a=!0;return s.text&&s.text!==r.text&&(a=!1),i&&_.each(["src","href","target"],function(e){i[e]&&i[e]!==n[e]&&(a=!1)}),a}function changeAttribute(e,t,s){e.setAttribute(t,s)}function getElementPropsByAttr(e,t){var s=t.originProps,r={attributes:{}},i=s.attributes;return _.each(i.style||{},function(t,s){r.attributes.style[s]=getStyle(e,s)}),Object.hasOwnProperty.call(s,"text")&&(r.attributes.text=getElementText(e)),_.each(["src","href"],function(t){Object.hasOwnProperty.call(i,t)&&(r.attributes[t]=e[t])}),Object.hasOwnProperty.call(i,"target")&&(r.attributes.target=e.getAttribute("target")),r}function changeAttributes(e,t,s){if(s||(s=getElementPropsByAttr(e,t)),propsFilter(t,s)){var r=t.props;_.isObject(r)&&setAttributes(e,r)}}function setAttributes(e,t){if(Object.hasOwnProperty.call(t,"attributes")){var s=t.attributes;Object.hasOwnProperty.call(s,"style")&&changeStyle(e,s.style),_.each(["href","target","src"],function(t){Object.hasOwnProperty.call(s,t)&&changeAttribute(e,t,s[t])})}Object.hasOwnProperty.call(t,"text")&&changeText(e,t.text)}function loadScript(e){e=_.extend({success:function(){},error:function(){},appendCall:function(e){document.getElementsByTagName("head")[0].appendChild(e)}},e);var t=null;"css"===e.type&&((t=document.createElement("link")).rel="stylesheet",t.href=e.url),"js"===e.type&&((t=document.createElement("script")).async="async",t.setAttribute("charset","UTF-8"),t.src=e.url,t.type="text/javascript"),t.onload=t.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(e.success(),t.onload=t.onreadystatechange=null)},t.onerror=function(){e.error(),t.onerror=null},e.appendCall(t)}function loadVtesting(e){loadScript({success:function(){},error:function(){},type:"js",url:e})}function addMutationObserver(e){new(0,window.MutationObserver)(e).observe(document.body,{childList:!0,subtree:!0})}function getInfoByElement(e,t){var s=e.tagName.toLowerCase(),r=getElementStyles(e,t),i={selector:getDomSelector(e),originProps:{attributes:{style:r},text:getElementText(e)},type:"text",tagName:s};return"a"===s&&(i.originProps.attributes.href=e.href,e.getAttribute("target")&&(i.originProps.attributes.target=e.getAttribute("target")),i.type="link"),"img"===s&&(i.originProps.attributes.src=e.src,i.type="img"),{originStyle:e.getAttribute("style"),eleInfo:i,ele:e}}function restoreElement(e){var t=e.eleInfo,s=e.ele;if(s){var r=e.originStyle;setAttributes(s,t.originProps),s.style.cssText=r||""}}function Vabtesting(){this.enable_visualize=!1,this.vabtest_url=location.protocol+"//static.sensorsdata.cn/sdk/plugin/vabtest/"+SensorsABTest.lib_version+"/vabtest.min.js",this.timeout=500,this.is_editor=!1,this.use_mask=!0,this.originData=[],this.visualExp=null,this.isFirst=!0,this.start_time=null,this.is_have_observer=!1,this.imgLoadingList=[]}SensorsABTest.verifyStore={valueType:function(e,t){switch(t){case"Number":if(_.isNumber(e))return!0;break;case"String":if(_.isString(e))return!0;break;case"Object":if(_.isObject(e))return!0;break;case"Boolean":if(!0===e||!1===e)return!0;break;default:return!1}return!1},para:function(e,t,s){var r={verify_success:!0,para:null};return _.each(s,function(s,i){if("essential"===s)switch(i){case"param_name":_.isString(t.param_name)&&t.param_name.length>0||(SensorsABTest.error(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cparam_name\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e\uff01param_name:",t.param_name),r.verify_success=!1);break;case"value_type":_.isString(t.value_type)&&-1!==_.indexOf(SensorsABTest.value_type_list,t.value_type)||(SensorsABTest.error(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cvalue_type\u914d\u7f6e\u9519\u8bef",t.value_type),r.verify_success=!1);break;case"default_value":"undefined"==typeof t.default_value?(SensorsABTest.error(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u53c2\u6570\u672a\u914d\u7f6e"),r.verify_success=!1):SensorsABTest.verifyStore.valueType(t.default_value,t.value_type)||(SensorsABTest.error(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u7c7b\u578b\u5fc5\u987b\u4e0evalue_type\u4e00\u81f4\uff01",t.default_value,t.value_type),r.verify_success=!1);break;case"callback":_.isFunction(t.callback)||(SensorsABTest.error(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0ccallback\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),r.verify_success=!1);break;default:r.verify_success=!1}else if("not_essential"===s)switch(i){case"timeout_milliseconds":t.timeout_milliseconds=t.timeout_milliseconds||SensorsABTest.para.timeout_milliseconds||SensorsABTest.default_para.timeout_milliseconds,(!_.isNumber(t.timeout_milliseconds)||_.isNumber(t.timeout_milliseconds)&&t.timeout_milliseconds<=0)&&(_.log("timeout_milliseconds \u53c2\u6570\u9519\u8bef",t.timeout_milliseconds),t.timeout_milliseconds=SensorsABTest.para.timeout_milliseconds),t.timeout_milliseconds<200&&(t.timeout_milliseconds=200);break;case"properties":t.properties=_.isObject(t.properties)?t.properties:{}}}),r.para=t,r}},SensorsABTest.getSA=function(e){return!!(_.isObject(e)&&_.isObject(e.readyState)&&e.readyState.state>=3)&&(this.sd=e,!0)},SensorsABTest.log=function(){if("object"==typeof console&&console.log){_.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]);try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}}},SensorsABTest.error=function(){if("object"==typeof console&&console.error)try{return console.error.apply(console,arguments)}catch(e){console.error(arguments[0])}},SensorsABTest.listenPageState=function(e){({visibleHandle:_.isFunction(e.visible)?e.visible:function(){},hiddenHandler:_.isFunction(e.hidden)?e.hidden:function(){},visibilityChange:null,hidden:null,isSupport:function(){return"undefined"!=typeof document[this.hidden]},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var e=this;document.addEventListener(e.visibilityChange,function(){document[e.hidden]?e.hiddenHandler():e.visibleHandle()},1)}else document.addEventListener?(window.addEventListener("focus",this.visibleHandle,1),window.addEventListener("blur",this.hiddenHandler,1)):(document.attachEvent("onfocusin",this.visibleHandle),document.attachEvent("onfocusout",this.hiddenHandler))}}).init()},SensorsABTest.storage={set:function(e,t){SensorsABTest.state.storage.isSupport&&window.localStorage.setItem(t,e)},get:function(e){var t=null;return SensorsABTest.state.storage.isSupport&&(t=window.localStorage.getItem(e)),t}},SensorsABTest.getStorageData=function(){var e=this.storage.get(SensorsABTest.state.storage.name);_.isString(e)&&(e=decrypt(e));try{e=JSON.parse(e)}catch(t){_.log(t)}return e},SensorsABTest.setStorageData=function(e){e=JSON.stringify(e),SensorsABTest.para.encrypt_cookie&&(e=encrypt(e)),this.storage.set(e,SensorsABTest.state.storage.name)},SensorsABTest.Mask=function(e){this.attr_name="sa-abtest-"+e,this.remove_timer=null,this.is_added=!1,this.is_abort=!1,this.is_timeout=!1,this.createMaskStyle()},SensorsABTest.Mask.prototype={createMaskStyle:function(){var e="["+this.attr_name+"],["+this.attr_name+"] body{opacity:0 !important;-khtml-opacity:0 !important;-moz-opacity:0;filter:alpha(opacity=0);}",t=document.createElement("style");t.type="text/css";try{t.appendChild(document.createTextNode(e))}catch(s){t.styleSheet.cssText=e}try{document.getElementsByTagName("head")[0].appendChild(t)}catch(s){SensorsABTest.log("error when create calls")}},show:function(e){try{var t=this;if(this.is_abort)return!1;var s=null;if(s=document.getElementsByTagName("html")[0],!_.isElement(s))return;s.setAttribute(this.attr_name,"1"),this.is_added=!0,_.isNumber(e)&&(this.remove_timer=setTimeout(function(){t.is_timeout=!0,t.remove()},e))}catch(r){SensorsABTest.log("error when show calls")}},remove:function(){try{if(this.is_abort||(this.is_abort=!0),this.is_added){this.is_added=!1;var e=null;if(e=document.getElementsByTagName("html")[0],!_.isElement(e))return;e.removeAttribute(this.attr_name)}this.remove_timer&&(clearTimeout(this.remove_timer),this.remove_timer=null)}catch(t){SensorsABTest.log("error when remove calls")}}},SensorsABTest.asyncFetchABTest=function(){SensorsABTest.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},SensorsABTest.fastFetchABTest=function(){SensorsABTest.error("fastFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},SensorsABTest.fetchCacheABTest=function(){SensorsABTest.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},SensorsABTest.searchLocalExp=function(e){return SensorsABTest.localdata[e]?SensorsABTest.localdata[e]:null},SensorsABTest.getExpResult=function(e,t){var s=e.default_value,r=t||SensorsABTest.searchLocalExp(e.param_name);return _.isObject(r)?_.isObject(r.js_config)&&(r.js_config.type===e.value_type?(s=r.js_config.value,this.triggerHandle(r,e)):_.log("\u8bd5\u9a8c\u7ed3\u679c\u7c7b\u578b\u4e0e\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e0d\u4e00\u81f4\uff0cparam_name\uff1a"+e.param_name+"\uff0c\u5f53\u524d\u8fd4\u56de\u7c7b\u578b\u4e3a\uff1a"+r.js_config.type+"\uff0c\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e3a\uff1a"+e.value_type)):_.log("localdata\u672a\u67e5\u8be2\u5230\u8bd5\u9a8c\u6570\u636e\uff0c\u8bd5\u9a8c\u53c2\u6570\u540d\u79f0\uff1a"+e.param_name),s},SensorsABTest.resolveVariables=function(e){this.localdata={};var t=this;_.each(e,function(e){if(_.isObject(e)&&e.variables&&_.isArray(e.variables)){if(e.experiment_type&&"CODE"!==e.experiment_type)return!1;_.each(e.variables,function(s){_.isObject(s)&&!t.localdata[s.name]&&(t.localdata[s.name]={abtest_experiment_id:e.abtest_experiment_id,abtest_experiment_group_id:e.abtest_experiment_group_id,is_control_group:e.is_control_group,is_white_list:e.is_white_list,value:s.value,type:s.type,js_config:SensorsABTest.getRelativeValue(s.value,s.type),experiment_type:e.experiment_type})})}})},SensorsABTest.getRelativeValue=function(e,t){var s={},r={INTEGER:function(e){var t=parseFloat(e);isNaN(t)?_.log("\u539f\u59cb\u6570\u636e INTEGER \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e):(s.value=t,s.type="Number")},STRING:function(e){_.isString(e)?(s.value=e,s.type="String"):_.log("\u539f\u59cb\u6570\u636e STRING \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e)},JSON:function(e){var t=JSON.parse(e);_.isObject(t)?(s.value=t,s.type="Object"):_.log("\u539f\u59cb\u6570\u636e JSON \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e)},BOOLEAN:function(e){"true"===e?(s.value=!0,s.type="Boolean"):"false"===e?(s.value=!1,s.type="Boolean"):_.log("\u539f\u59cb\u6570\u636e BOOLEAN \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e)}};try{r[t]?r[t](e):_.log("\u8bd5\u9a8c\u6570\u636e\u7c7b\u578b\u89e3\u6790\u5931\u8d25",t,e)}catch(i){_.log(i,e,t)}return s},SensorsABTest.link={isFirst:!0,start_time:null,mask_instance:null,is_filtered_out:!1,para:{timeout:500,use_mask:!0,pass_params:!0,control_link_search:"default",experiment_link_search:"default"},init:function(e){return this.initPara(e),this.para?_.getQueryParam(location.href,"saSDKMultilink")?(this.is_filtered_out=!0,!1):(this.start_time=(new Date).getTime(),this.para.use_mask&&this.initMask(),void this.addSinglePageListener()):(_.log("multilink is closed"),!1)},addSinglePageListener:function(){var e=this;_.addSinglePageEvent(function(t){return t!==location.href&&(e.is_filtered_out=!1,e.isFirst=!0,e.mask_instance&&e.mask_instance.remove(),_.getQueryParam(location.href,"saSDKMultilink")?(e.is_filtered_out=!0,!1):(e.start_time=(new Date).getTime(),e.para.use_mask&&e.initMask(),void e.resolve(SensorsABTest.originalData)))})},initMask:function(){this.mask_instance=new SensorsABTest.Mask("link"),this.mask_instance.show(this.para.timeout)},initPara:function(e){if(_.isFunction(e))try{e=e()}catch(t){return _.log("link para error!"),void(this.para=!1)}!1===e?this.para=!1:_.isObject(e)&&(this.para.timeout=_.isNumber(e.timeout)&&e.timeout>=0?e.timeout:500,this.para.use_mask=_.isBoolean(e.use_mask)?e.use_mask:this.para.use_mask,this.para.control_link_search=_.isString(e.control_link_search)?e.control_link_search:"default",this.para.experiment_link_search=_.isString(e.experiment_link_search)?e.experiment_link_search:"default",this.para.pass_params=!_.isBoolean(e.pass_params)||e.pass_params)},resolve:function(e){var t=this;if(!this.para)return!1;if(!_.isArray(e))return!1;if(this.is_filtered_out)return!1;if(!this.isFirst)return!1;if(this.isFirst=!1,0===this.para.timeout)return!1;if((new Date).getTime()-this.start_time>this.para.timeout)return _.log("The multilink was stopped because the request timeout"),!1;var s=!1;_.each(e,function(e){return!!_.isObject(e)&&(!s&&("LINK"===e.experiment_type&&void(t.isTriggerLinkExp(e)&&(s=!0,t.redirectUrl(e)))))}),!s&&this.para.use_mask&&this.mask_instance&&this.mask_instance.remove()},stopTrigger:function(){this.isFirst=!1,_.log("The multilink was stopped because the request failed"),this.para.use_mask&&this.mask_instance&&this.mask_instance.remove()},isTriggerLinkExp:function(e){return _.isString(e.control_link)&&_.isString(e.link_match_type)?"REGEXP"===e.link_match_type?!!_.checkUrlIsRegexp(e.control_link,e.regexp_flags)||(_.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",e.abtest_experiment_id),!1):!!_.checkUrlIsMatch(e.control_link,e.link_match_type)||(_.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",e.abtest_experiment_id),!1):(_.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u6570\u636e\u5f02\u5e38",e.abtest_experiment_id),!1)},redirectUrl:function(e){if(e.experiment_link&&_.isString(e.experiment_link))if(!0!==e.is_control_group||"STRICT"!==e.link_match_type&&"REGEXP"!==e.link_match_type){var t,s,r=location.href,i=e.experiment_link;if("REGEXP"===e.link_match_type&&/\$\d+/.test(i)){var n=e.regexp_flags?new RegExp(e.control_link,e.regexp_flags):new RegExp(e.control_link);i=r.replace(n,i)}if(this.para.pass_params?(s=this.getMergedUrl(e.is_control_group,i,r),t=a(s)):(s=this.getMergedUrl(e.is_control_group,i),t=a(s)),t)SensorsABTest.triggerHandle(e)?setTimeout(function(){location.href=t},80):setTimeout(function(){location.href=t},0),this.mask_instance&&this.mask_instance.remove_timer&&clearTimeout(this.mask_instance.remove_timer)}else SensorsABTest.triggerHandle(e);else _.log("\u9875\u9762\u8df3\u8f6c\u5931\u8d25\uff0cexperiment_link\u5b57\u6bb5\u5f02\u5e38",e.abtest_experiment_id);function a(e){return _.secCheck.isHttpUrl(e)?_.secCheck.removeScriptProtocol(e):(_.log("\u975e\u6cd5URL"),!1)}},getMergedUrl:function(e,t,s){var r="",i="",n="",a={parse_url:null,search:""},o={parse_url:null,search:"",hash:""};function l(e){var t=/([^?#]+)(\?[^#]*)?(#.*)?/.exec(e);if(t)return{host:t[1]||"",search:t[2]||"",hash:t[3]||""}}if(!s||(a.parse_url=l(s),a.parse_url)){if(o.parse_url=l(t),o.parse_url)return s&&("after_hash"===this.para.control_link_search?a.search=c(a.parse_url.hash).search:a.search=a.parse_url.search),e?"after_hash"===this.para.control_link_search?(o.search=c(o.parse_url.hash).search,o.hash=c(o.parse_url.hash).hash):o.search=o.parse_url.search:"after_hash"===this.para.experiment_link_search?(o.search=c(o.parse_url.hash).search,o.hash=c(o.parse_url.hash).hash):o.search=o.parse_url.search,i=s?this.getSearchStr(a.search,o.search):this.getSearchStr(o.search),e&&"after_hash"===this.para.control_link_search||!e&&"after_hash"===this.para.experiment_link_search?r=o.hash.length>0?o.parse_url.host+o.parse_url.search+o.hash+i:o.parse_url.search.length>0?o.parse_url.host+o.parse_url.search+"&"+i.substring(1):o.parse_url.host+i:(n="after_hash"===this.para.control_link_search?o.parse_url.hash:s?o.parse_url.hash||a.parse_url.hash:o.parse_url.hash,r=o.parse_url.host+i+n),r;_.log("url \u89e3\u6790\u5931\u8d25",t)}else _.log("url \u89e3\u6790\u5931\u8d25",s);function c(e){var t={hash:"",search:""};if(!_.isString(e))return t;var s=e.indexOf("?");return s>-1?(t.search=e.slice(s),t.hash=e.slice(0,s)):t.hash=e,t}},getSearchStr:function(e,t){function s(e){var t={};if(!e||!e.length||0!==e.indexOf("?"))return t;if(!(e=e.slice(1)).length)return t;for(var s=e.split("&"),r=0;r<s.length;r++)if(s[r].indexOf("=")<0)t[s[r]]=null;else{var i=s[r].split("=");t[i[0]]=i[1]}return t}var r=s(e),i=s(t),n=_.extend(r,i),a="";if(_.isEmptyObject(n))return"?saSDKMultilink=true";var o=!0;for(var l in n)o?(a+="?",o=!1):a+="&",null!==n[l]?a=a+l+"="+n[l]:a+=l;return a+"&saSDKMultilink=true"}},SensorsABTest.bridgeStore={init:function(e){if(!this.setPara(e))return!1;_.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f"),SensorsABTest.state.storage.name="sawebjssdkabtest_bridge",SensorsABTest.abBridge=new SensorsABTest.sd.JSBridge({type:"abtest",app_call_js:function(e){try{e=_.base64Decode(e)}catch(t){_.log("App\u6570\u636ebase64\u89e3\u7801\u5f02\u5e38",e)}try{(e=JSON.parse(e)).message_id&&this.double(e)}catch(t){_.log("App\u6570\u636e\u89e3\u6790\u5f02\u5e38",e)}}}),_.isObject(window.SensorsData_iOS_JS_Bridge)&&window.SensorsData_iOS_JS_Bridge.sensorsdata_abtest_module&&SensorsABTest.abBridge.hasAppBridge()?SensorsABTest.bridgeState="ab_bridge_ok":_.isObject(window.SensorsData_APP_New_H5_Bridge)&&_.isFunction(window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module)&&window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module()&&SensorsABTest.abBridge.hasAppBridge()?SensorsABTest.bridgeState="ab_bridge_ok":SensorsABTest.bridgeState="ab_no_abtest_bridge",SensorsABTest.store.init(this.getResultFromApp,this)},setPara:function(e){var t=SensorsABTest.verifyStore.para("\u6253\u901a\u521d\u59cb\u5316",e,{timeout_milliseconds:"not_essential"});return SensorsABTest.para=_.extend({},SensorsABTest.default_para,t.para),_.isBoolean(SensorsABTest.para.collect_bridge_status)||(SensorsABTest.para.collect_bridge_status=!0),_.isNumber(SensorsABTest.para.update_interval)||(SensorsABTest.para.update_interval=6e5),!0===SensorsABTest.sd.para.encrypt_cookie&&(SensorsABTest.para.encrypt_cookie=!0),!0},getResultFromApp:function(e){var t=(e=_.isObject(e)?e:{}).para||{},s=e.suc,r=e.err,i=t.timeout_milliseconds||SensorsABTest.para.timeout_milliseconds;_.log("\u5411App\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),"ab_bridge_ok"===SensorsABTest.bridgeState?SensorsABTest.abBridge.requestToApp({data:{properties:t.properties,timeout:i,request_body:{origin_platform:"H5"}},callback:function(e){_.isObject(e)&&_.isObject(e.data)?(_.log("\u6210\u529f\u83b7\u53d6\u5230 App \u7aef\u8fd4\u56de\u7684\u8bd5\u9a8c\u6570\u636e","data:",e),SensorsABTest.dealResponseData(e.data),s&&s(e)):(_.log("App \u7aef\u8bf7\u6c42\u5931\u8d25"),r&&r()),SensorsABTest.fetchData.setNextFetch()},timeout:{time:i,callback:function(){_.log("\u83b7\u53d6App\u7aef\u6570\u636e\u5931\u8d25"),r&&r(),SensorsABTest.fetchData.setNextFetch()}}}):r&&(_.log("A/B Testing \u6253\u901a\u5931\u8d25\uff0c",SensorsABTest.bridgeState),r())},asyncFetch:function(e){SensorsABTest.bridgeStore.getResultFromApp({para:e,suc:function(t){if(_.isObject(t.properties)&&(e.properties=_.extend(t.properties,e.properties)),"SUCCESS"===t.data.status){var s=SensorsABTest.getExpResult(e);e.callback(s)}else e.callback(e.default_value)},err:function(){e.callback(e.default_value)}})}},SensorsABTest.bridgeStore.methods={asyncFetchABTest:function(e){if(!_.isObject(e))return SensorsABTest.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var t=SensorsABTest.verifyStore.para("asyncFetchABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});t.verify_success&&(e=t.para,"ab_bridge_ok"===SensorsABTest.bridgeState?SensorsABTest.bridgeStore.asyncFetch(e):e.callback(e.default_value))},fastFetchABTest:function(e){if(!_.isObject(e))return SensorsABTest.error("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var t=SensorsABTest.verifyStore.para("fastFetchABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(t.verify_success){e=t.para;var s=SensorsABTest.searchLocalExp(e.param_name);if(_.isObject(s)){var r=SensorsABTest.getExpResult(e,s);e.callback(r)}else _.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),"ab_bridge_ok"===SensorsABTest.bridgeState?SensorsABTest.bridgeStore.asyncFetch(e):e.callback(e.default_value)}},fetchCacheABTest:function(e){if(_.isObject(e)){var t=SensorsABTest.verifyStore.para("fetchCacheABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential"});if(t.verify_success)return SensorsABTest.getExpResult(t.para)}else SensorsABTest.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e")}},SensorsABTest.normalStore={init:function(e){if(!this.setPara(e))return!1;SensorsABTest.bridgeState="ab_no_host_bridge",/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?SensorsABTest.state.platform="H5":SensorsABTest.state.platform="Web",_.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f\uff0c\u8bd5\u9a8c URL\uff1a",e.url),SensorsABTest.checkSADebug(),SensorsABTest.store.init(this.getResultFromServer,this)},setPara:function(e){if(!_.isString(e.url)||"http"!==e.url.slice(0,4))return _.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1;if("https"===location.protocol.slice(0,5)&&"http:"===e.url.slice(0,5))return _.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0chttps \u9875\u9762\u5fc5\u987b\u4f7f\u7528 https \u7684 URL"),!1;var t=_.getQueryParam(e.url,"project-key");if(!t)return _.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff08\u5fc5\u987b\u5305\u542b project-key\uff09\uff01"),!1;e.project_key=t;var s=SensorsABTest.verifyStore.para("A/B Testing SDK \u521d\u59cb\u5316",e,{timeout_milliseconds:"not_essential"});return SensorsABTest.para=_.extend({},SensorsABTest.default_para,s.para),_.isBoolean(SensorsABTest.para.collect_bridge_status)||(SensorsABTest.para.collect_bridge_status=!0),_.isNumber(SensorsABTest.para.update_interval)||(SensorsABTest.para.update_interval=6e5),!0===SensorsABTest.sd.para.encrypt_cookie&&(SensorsABTest.para.encrypt_cookie=!0),!0},asyncFetch:function(e){SensorsABTest.normalStore.getResultFromServer({para:e,suc:function(t){if(_.isObject(t)&&"SUCCESS"===t.status){var s=SensorsABTest.getExpResult(e);e.callback(s)}else e.callback(e.default_value)},err:function(){e.callback(e.default_value)}})},creatRequestData:function(e){var t="";_.isEmptyObject(SensorsABTest.sd.store._state)||(t=SensorsABTest.sd.store._state._first_id||SensorsABTest.sd.store._state.first_id||SensorsABTest.sd.store._state._distinct_id||SensorsABTest.sd.store._state.distinct_id);var s={anonymous_id:t,platform:SensorsABTest.state.platform,abtest_lib_version:SensorsABTest.lib_version,properties:{$is_first_day:SensorsABTest.sd._.cookie.getNewUser()}};return _.isObject(e.properties)&&(s.properties=_.extend({},s.properties,e.properties)),SensorsABTest.sd.store._state.first_id&&(s.login_id=SensorsABTest.sd.store.getDistinctId()),s},getResultFromServer:function(e){var t,s=(e=_.isObject(e)?e:{}).para||{},r=e.suc,i=e.err,n=this.creatRequestData(s);_.log("\u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),t=SensorsABTest.sd.store.getDistinctId(),SensorsABTest.sd._.ajax({url:SensorsABTest.para.url,type:"POST",data:JSON.stringify(n),credentials:!1,contentType:"application/json",timeout:s.timeout_milliseconds||SensorsABTest.para.timeout_milliseconds,cors:!0,success:function(e){SensorsABTest.dealResponseData(e,t),r&&r(e),SensorsABTest.fetchData.setNextFetch()},error:function(e){_.log("\u670d\u52a1\u7aef\u8bf7\u6c42\u53d1\u9001\u5931\u8d25",e),i&&i(),SensorsABTest.fetchData.setNextFetch()}})}},SensorsABTest.normalStore.methods={asyncFetchABTest:function(e){if(!_.isObject(e))return SensorsABTest.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var t=SensorsABTest.verifyStore.para("asyncFetchABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});t.verify_success&&(e=t.para,SensorsABTest.normalStore.asyncFetch(e))},fastFetchABTest:function(e){if(!_.isObject(e))return SensorsABTest.error("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var t=SensorsABTest.verifyStore.para("fastFetchABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(t.verify_success){e=t.para;var s=SensorsABTest.searchLocalExp(e.param_name);if(_.isObject(s)){var r=SensorsABTest.getExpResult(e,s);e.callback(r)}else _.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),SensorsABTest.normalStore.asyncFetch(e)}},fetchCacheABTest:function(e){if(_.isObject(e)){var t=SensorsABTest.verifyStore.para("fetchCacheABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential"});if(t.verify_success)return SensorsABTest.getExpResult(t.para)}else SensorsABTest.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e")}},window.MutationObserver||(window.MutationObserver=function(e){function t(e){this._watched=[],this._listener=e}function s(t){var s={type:null,target:null,addedNodes:[],removedNodes:[],previousSibling:null,nextSibling:null,attributeName:null,attributeNamespace:null,oldValue:null};for(var r in t)d(s,r)&&t[r]!==e&&(s[r]=t[r]);return s}function r(t,r){var i=o(t,r);return function(n){var c,u=n.length;r.charData&&3===t.nodeType&&t.nodeValue!==i.charData&&n.push(new s({type:"characterData",target:t,oldValue:i.charData})),r.attr&&i.attr&&a(n,t,i.attr,r.afilter),(r.kids||r.descendents)&&(c=function(t,r,i,n){var o;function c(e,r,i,o,l){for(var c,_,h,p=e.length-1,d=-~((p-l)/2);h=e.pop();)c=i[h.i],_=o[h.j],n.kids&&d&&Math.abs(h.i-h.j)>=p&&(t.push(s({type:"childList",target:r,addedNodes:[c],removedNodes:[c],nextSibling:c.nextSibling,previousSibling:c.previousSibling})),d--),n.attr&&_.attr&&a(t,c,_.attr,n.afilter),n.charData&&3===c.nodeType&&c.nodeValue!==_.charData&&t.push(s({type:"characterData",target:c,oldValue:_.charData})),n.descendents&&u(c,_)}function u(r,i){for(var h,d,g,f,m,v,S,b=r.childNodes,y=i.kids,T=b.length,A=y?y.length:0,B=0,k=0,w=0;k<T||w<A;)v=b[k],m=y[w],S=m&&m.node,v===S?(n.attr&&m.attr&&a(t,v,m.attr,n.afilter),n.charData&&m.charData!==e&&v.nodeValue!==m.charData&&t.push(s({type:"characterData",target:v,oldValue:m.charData})),d&&c(d,r,b,y,B),n.descendents&&(v.childNodes.length||m.kids&&m.kids.length)&&u(v,m),k++,w++):(o=!0,h||(h={},d=[]),v&&(h[g=_(v)]||(h[g]=!0,-1===(f=l(y,v,w))?n.kids&&(t.push(s({type:"childList",target:r,addedNodes:[v],nextSibling:v.nextSibling,previousSibling:v.previousSibling})),B++):d.push({i:k,j:f})),k++),S&&S!==b[k]&&(h[g=_(S)]||(h[g]=!0,-1===(f=p(b,S,k))?n.kids&&(t.push(s({type:"childList",target:i.node,removedNodes:[S],nextSibling:y[w+1],previousSibling:y[w-1]})),B--):d.push({i:f,j:w})),w++));d&&c(d,r,b,y,B)}return u(r,i),o}(n,t,i,r)),(c||n.length!==u)&&(i=o(t,r))}}t._period=30,t.prototype={observe:function(e,s){for(var i,n={attr:!!(s.attributes||s.attributeFilter||s.attributeOldValue),kids:!!s.childList,descendents:!!s.subtree,charData:!(!s.characterData&&!s.characterDataOldValue)},a=this._watched,o=0;o<a.length;o++)a[o].tar===e&&a.splice(o,1);s.attributeFilter&&(n.afilter=h(s.attributeFilter,function(e,t){return e[t]=!0,e},{})),a.push({tar:e,fn:r(e,n)}),this._timeout||(i=this,function l(){var e=i.takeRecords();e.length&&i._listener(e,i),i._timeout=setTimeout(l,t._period)}())},takeRecords:function(){for(var e=[],t=this._watched,s=0;s<t.length;s++)t[s].fn(e);return e},disconnect:function(){this._watched=[],clearTimeout(this._timeout),this._timeout=null}};var i=document.createElement("i");i.style.top=0;var n=(i="null"!=i.attributes.style.value)?function(e,t){return t.value}:function(e,t){return"style"!==t.name?t.value:e.style.cssText};function a(e,t,r,i){for(var a,o,l={},c=t.attributes,u=c.length;u--;)o=(a=c[u]).name,i&&!d(i,o)||(n(t,a)!==r[o]&&e.push(s({type:"attributes",target:t,attributeName:o,oldValue:r[o],attributeNamespace:a.namespaceURI})),l[o]=!0);for(o in r)l[o]||e.push(s({target:t,type:"attributes",attributeName:o,oldValue:r[o]}))}function o(e,t){var s=!0;return function r(e){var i={node:e};return!t.charData||3!==e.nodeType&&8!==e.nodeType?(t.attr&&s&&1===e.nodeType&&(i.attr=h(e.attributes,function(s,r){return t.afilter&&!t.afilter[r.name]||(s[r.name]=n(e,r)),s},{})),s&&(t.kids||t.charData||t.attr&&t.descendents)&&(i.kids=function(e,t){for(var s=[],r=0;r<e.length;r++)s[r]=t(e[r],r,e);return s}(e.childNodes,r)),s=t.descendents):i.charData=e.nodeValue,i}(e)}function l(e,t,s){return p(e,t,s,"node")}var c=1,u="mo_id";function _(e){try{return e.id||(e[u]=e[u]||c++)}catch(t){try{return e.nodeValue}catch(s){return c++}}}function h(e,t,s){for(var r=0;r<e.length;r++)s=t(s,e[r],r,e);return s}function p(e,t,s,r){for(;s<e.length;s++)if((r?e[s][r]:e[s])===t)return s;return-1}function d(t,s){return t[s]!==e}return t}(void 0)),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),s=this,r=function(){},i=function(){return s.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),Vabtesting.prototype.init=function(e){this.initPara(e),!1!==this.enable_visualize&&(window.self!==window.top&&validateProject()?(this.is_editor=!0,loadVtesting(this.vabtest_url)):(this.start_time=(new Date).getTime(),this.use_mask&&this.initMask(),this.addSinglePageListener()))},Vabtesting.prototype.initPara=function(e){if(_.isFunction(e))try{e=e()}catch(s){return _.log("ABTesting SDK  !"),void(this.para=!1)}if(_.isObject(e)){Object.prototype.hasOwnProperty.call(e,"enable_visualize")&&_.isBoolean(e.enable_visualize)?this.enable_visualize=e.enable_visualize:_.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 enable_visualize \u683c\u5f0f\u4e0d\u6b63\u786e\u3002 \u7c7b\u578b\u5e94\u4e3a Boolean"),this.use_mask=_.isBoolean(e.use_mask)?e.use_mask:this.use_mask,this.timeout=_.isNumber(e.timeout)&&e.timeout>=0?e.timeout:this.timeout;var t=_.isString(e.vabtest_url)?e.vabtest_url:"";t&&("https:"===location.protocol?"https:"===t.slice(0,6)?this.vabtest_url=t:_.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 vabtest_url \u534f\u8bae\u5934\u5e94\u8bbe\u7f6e\u4e3a https"):"http:"===t.slice(0,5)||"https:"===t.slice(0,6)?this.vabtest_url=t:_.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 vabtest_url \u5e94\u8bbe\u7f6e\u4e3a\u6709\u6548 URL"))}else this.para=!1},Vabtesting.prototype.resolve=function(e){if(!1!==this.enable_visualize&&!0!==this.is_editor&&!1!==this.isFirst){if((new Date).getTime()-this.start_time>this.timeout)return _.log("\u8bf7\u6c42\u5b9e\u9a8c\u7ed3\u679c\u8d85\u65f6\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01"),!1;var t=this;this.isFirst=!1;var s=!1;_.each(e,function(e){if(!_.isObject(e)||"VISUAL"!==e.experiment_type)return!1;if(s)return!1;var r=e.experiment_value;if(!_.isArray(r))try{r=JSON.parse(e.experiment_value),e.experiment_value=r}catch(i){return!1}t.isTriggerVisualExp(e)&&(s=!0,t.prepareResource(e,t.render.bind(t)),t.visualExp=e)}),!s&&this.use_mask&&this.destroyMask(),bindReady(window,function(){addMutationObserver(t.observerCallback.bind(t))})}},Vabtesting.prototype.initMask=function(){this.mask_instance=new SensorsABTest.Mask("vabtest"),this.mask_instance.show(this.timeout)},Vabtesting.prototype.destroyMask=function(){this.mask_instance&&this.mask_instance.remove()},Vabtesting.prototype.prepareResource=function(e,t){var s=this,r=e.experiment_value;_.isArray(r)&&(_.each(r,function(r){var i=r.tagName,n=r.props;if("img"===i&&n&&n.attributes&&_.isString(n.attributes.src)){var a=n.attributes.src;s.imgLoadingList.push(a);var o=document.createElement("img");o.width=1,o.height=1,o.onload=l,o.onerror=l,o.onabort=l,o.src=n.attributes.src}function l(){var r=s.imgLoadingList.indexOf(a);r>-1&&s.imgLoadingList.splice(r,1),0===s.imgLoadingList.length&&t(e)}}),0===this.imgLoadingList.length&&t(e))},Vabtesting.prototype.render=function(e){var t=this;bindReady(window,function(){if(t.use_mask&&t.mask_instance&&!0===t.mask_instance.is_timeout)_.log("\u6e32\u67d3\u5b9e\u9a8c\u7ed3\u679c\u8d85\u65f6\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01");else{SensorsABTest.triggerHandle(e);var s=e.experiment_value;_.isArray(s)&&_.each(s,function(e){var s=getDomBySelector(e.selector);if(s)try{var r=getInfoByElement(s,[]);changeAttributes(s,e,r.eleInfo),t.originData.push(r)}catch(i){}}),t.use_mask&&t.destroyMask()}})},Vabtesting.prototype.restoreElements=function(){_.each(this.originData,function(e){restoreElement(e)}),this.visualExp=null,this.isFirst=!0,this.start_time=(new Date).getTime(),this.originData=[]},Vabtesting.prototype.addSinglePageListener=function(){var e=this;_.addSinglePageEvent(function(t){if(t===location.href)return!1;e.isFirst=!0,e.mask_instance&&e.destroyMask(),e.start_time=(new Date).getTime(),e.use_mask&&e.initMask(),e.restoreElements(),e.resolve(SensorsABTest.originalData)})},Vabtesting.prototype.observerCallback=function(){this.visualExp&&(_.each(this.originData,function(e){restoreElement(e)}),this.originData=[],this.render(this.visualExp))},Vabtesting.prototype.stopTrigger=function(){this.isFirst=!1,_.log("\u8bf7\u6c42\u5b9e\u9a8c\u7ed3\u679c\u5931\u8d25\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01"),this.use_mask&&this.destroyMask()},Vabtesting.prototype.isTriggerVisualExp=function(e){return _.isString(e.control_link)&&_.isString(e.link_match_type)?!!_.checkUrlIsMatch(e.control_link,e.link_match_type)||(_.log("\u53ef\u89c6\u5316\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",e.abtest_experiment_id),!1):(_.log("\u53ef\u89c6\u5316\u8bd5\u9a8c\u6570\u636e\u5f02\u5e38",e.abtest_experiment_id),!1)};var vabtest=new Vabtesting;SensorsABTest.dealResponseData=function(e,t){_.isObject(e)?"SUCCESS"===e.status?_.isArray(e.results)&&(this.originalData=e.results,this.updateLocalData(e.results,t)):"FAILED"===e.status&&_.log("\u83b7\u53d6\u8bd5\u9a8c\u5931\u8d25\uff1aerror_type\uff1a"+e.error_type+",error\uff1a"+e.error):_.log("\u8bd5\u9a8c\u6570\u636e\u89e3\u6790\u5931\u8d25\uff0cresponse \uff1a",e)},SensorsABTest.updateLocalData=function(e,t){this.analyzeData(e),this.updateStorage(t),_.log("\u66f4\u65b0\u8bd5\u9a8c\u6570\u636e\u6210\u529f")},SensorsABTest.updateStorage=function(e){var t=(new Date).getTime(),s={data:this.originalData,updateTime:t,triggerList:this.triggerList,distinct_id:e||SensorsABTest.sd.store.getDistinctId()};this.setStorageData(s),this.updateTime=t},SensorsABTest.analyzeData=function(e){if(!_.isArray(e))return _.log("\u89e3\u6790——\u6570\u636e\u683c\u5f0f\u9519\u8bef",e),!1;SensorsABTest.link.resolve(e),vabtest.resolve(e),SensorsABTest.resolveVariables(e)},SensorsABTest.triggerHandle=function(e,t){var s=_.isObject(t)&&_.isObject(t.properties)?t.properties:{},r=SensorsABTest.trackTestTrigger(e,s),i=e.abtest_experiment_id;if(_.isString(i)){var n=SensorsABTest.sd.store.getDistinctId();this.triggerList[n]&&_.isArray(this.triggerList[n])?(this.triggerList[n].push(i),this.triggerList[n]=_.unique(this.triggerList[n])):this.triggerList[n]=[i],this.updateStorage()}return r},SensorsABTest.trackTestTrigger=function(e,t){var s=SensorsABTest.sd.store.getDistinctId(),r=!0,i=!0;if(t=_.isObject(t)?t:{},!e.is_white_list){this.triggerList&&_.isObject(this.triggerList)&&("{}"!==JSON.stringify(this.triggerList)&&(i=!1),this.triggerList[s]&&_.isArray(this.triggerList[s])&&_.each(this.triggerList[s],function(t){t===e.abtest_experiment_id&&(r=!1)}));var n={$abtest_experiment_id:e.abtest_experiment_id,$abtest_experiment_group_id:e.abtest_experiment_group_id};if(SensorsABTest.para.collect_bridge_status&&(n.$sdk_bridge_status=SensorsABTest.bridgeState),i){var a="web_abtesting:"+this.lib_version;n.$lib_plugin_version=[a]}var o=_.extend(n,t);return r&&this.sd.track("$ABTestTrigger",o),this.sd.track("WebABTestTrigger",o),r}},SensorsABTest.checkSADebug=function(){var e=_.getQueryParam(location.href,"sensors_abtest_url"),t=_.getQueryParam(location.href,"feature_code"),s=+_.getQueryParam(location.href,"account_id");if(e.length&&t.length&&_.isNumber(s)&&0!==s){var r={distinct_id:SensorsABTest.sd.store.getDistinctId(),feature_code:t,account_id:s};SensorsABTest.sd._.ajax({url:e,type:"POST",data:JSON.stringify(r),credentials:!1,contentType:"application/json",timeout:SensorsABTest.para.timeout_milliseconds,cors:!0,success:function(){},error:function(e){_.log("distinct_id\u53d1\u9001\u5931\u8d25,err:",e)}})}},SensorsABTest.initMethods=function(e){_.each(["asyncFetchABTest","fastFetchABTest","fetchCacheABTest"],function(t){SensorsABTest[t]=e.methods[t]})},SensorsABTest.fetchData={timer:null,method:null,context:null,init:function(e,t){this.method=e,this.context=t,this.start(!0)},getServerData:function(e){e?this.method.call(this.context,{suc:function(t){e&&("ab_bridge_ok"===SensorsABTest.bridgeState&&(t=t.data),_.isObject(t)&&"SUCCESS"===t.status&&_.isArray(t.results)||(SensorsABTest.link.stopTrigger(),vabtest.stopTrigger()))},err:function(){e&&(SensorsABTest.link.stopTrigger(),vabtest.stopTrigger())}}):this.method.call(this.context)},setNextFetch:function(e){var t=this,s=e||SensorsABTest.para.update_interval;this.clearFetchTimer(this.timer),this.timer=setTimeout(function(){t.getServerData()},s)},start:function(e){var t=null,s=(new Date).getTime(),r=SensorsABTest.getStorageData(),i=SensorsABTest.sd.store.getDistinctId();if(r&&_.isObject(r)&&r.distinct_id===i)if(t=r.updateTime,e&&(SensorsABTest.originalData=r.data,t&&_.isNumber(t)&&s-t>0&&s-t<SensorsABTest.para.session_limit&&_.isObject(r.triggerList)&&(SensorsABTest.triggerList=r.triggerList),SensorsABTest.analyzeData(r.data)),t&&_.isNumber(t)&&s-t>0&&s-t<SensorsABTest.para.update_interval){_.log("\u6570\u636e\u4e0d\u66f4\u65b0",t,s);var n=s-t,a=SensorsABTest.para.update_interval-n;this.setNextFetch(a)}else _.log("\u7f13\u5b58\u6570\u636e\u8d85\u65f6",t,s),this.getServerData(e);else(t=SensorsABTest.updateTime)&&_.isNumber(t)&&s-t>0&&s-t<SensorsABTest.para.update_interval?_.log("\u6570\u636e\u4e0d\u66f4\u65b0",t,s):this.getServerData(e)},stop:function(){_.log("\u6e05\u7a7a\u62c9\u53d6\u5b9a\u65f6\u5668"),this.clearFetchTimer()},clearFetchTimer:function(){clearTimeout(this.timer),this.timer=null}},SensorsABTest.store={init:function(e,t){SensorsABTest.fetchData.init(e,t),SensorsABTest.initMethods(t),SensorsABTest.listenPageState({visible:function(){_.log("\u9875\u9762\u663e\u793a"),SensorsABTest.fetchData.start()},hidden:function(){SensorsABTest.fetchData.stop()}}),SensorsABTest.sd.events.on("changeDistinctId",function(e){SensorsABTest.localdata={},SensorsABTest.originalData=[],vabtest.restoreElements(),SensorsABTest.updateStorage(),SensorsABTest.fetchData.getServerData()}),SensorsABTest.sd.events.isReady()}},SensorsABTest.init=function(e,t){return this.sd?(this.log("A/B Testing SDK \u91cd\u590d\u521d\u59cb\u5316\uff01\u53ea\u6709\u7b2c\u4e00\u6b21\u521d\u59cb\u5316\u6709\u6548\uff01"),!1):(_.log=function(){return _.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]),e.log.apply(this,arguments)},this.getSA(e)?_.isObject(t)?("object"==typeof localStorage&&this.sd._.localStorage.isSupport()||(_.log("localstorage\u5f02\u5e38"),this.state.storage.isSupport=!1),this.abtestingPara=t,void this.initTest()):(_.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f20\u5165\u6b63\u786e\u7684\u521d\u59cb\u5316\u53c2\u6570!para:",t),!1):(this.log("A/B Testing \u521d\u59cb\u5316\u5931\u8d25,Web JS SDK \u6ca1\u6709\u521d\u59cb\u5316\u5b8c\u6210"),!1))},SensorsABTest.initTest=function(){this.link.init(this.abtestingPara.multilink),vabtest.init(this.abtestingPara.visualize),this.sd.bridge.is_verify_success?this.bridgeStore.init(this.abtestingPara):this.normalStore.init(this.abtestingPara)},window.SensorsDataWebJSSDKPlugin&&"[object Object]"==Object.prototype.toString.call(window.SensorsDataWebJSSDKPlugin)?window.SensorsDataWebJSSDKPlugin.SensorsABTest=window.SensorsDataWebJSSDKPlugin.SensorsABTest||SensorsABTest:window.SensorsDataWebJSSDKPlugin={SensorsABTest:SensorsABTest};export default SensorsABTest;