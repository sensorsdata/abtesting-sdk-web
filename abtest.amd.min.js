define(function(){"use strict";function t(){var t,e={},r=navigator.userAgent.toLowerCase();return(t=r.match(/opera.([\d.]+)/))?e.opera=Number(t[1].split(".")[0]):(t=r.match(/msie ([\d.]+)/))?e.ie=Number(t[1].split(".")[0]):(t=r.match(/edge.([\d.]+)/))?e.edge=Number(t[1].split(".")[0]):(t=r.match(/firefox\/([\d.]+)/))?e.firefox=Number(t[1].split(".")[0]):(t=r.match(/chrome\/([\d.]+)/))?e.chrome=Number(t[1].split(".")[0]):(t=r.match(/version\/([\d.]+).*safari/))?e.safari=Number(t[1].match(/^\d*.\d*/)):(t=r.match(/trident\/([\d.]+)/))&&(e.ie=11),e}function e(){if(!window.name)return!1;try{var t=JSON.parse(decodeURIComponent(window.name||"")),e=t.is_vabtesting,r=t.source_url,i=t.link_match_type;return!(e!==!0||!x.checkUrlIsMatch(r,i))||(x.log("A/B Testing SDK \u9875\u9762\u5730\u5740\uff0c\u4e0e\u5f53\u524d\u5b9e\u9a8c URL \u4e0d\u5339\u914d\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1)}catch(a){return!1}}function r(t,e){t=t||window;var r=!1,i=!0,a=t.document,n=a.documentElement,s=a.addEventListener,o=s?"addEventListener":"attachEvent",l=s?"removeEventListener":"detachEvent",u=s?"":"on",c=function(i){"readystatechange"==i.type&&"complete"!=a.readyState||(("load"==i.type?t:a)[l](u+i.type,c,!1),!r&&(r=!0)&&e.call(t,i.type||i))},h=function(){try{n.doScroll("left")}catch(t){return void setTimeout(h,50)}c("poll")};if("complete"==a.readyState)e.call(t,"lazy");else{if(!s&&n.doScroll){try{i=!t.frameElement}catch(d){}i&&h()}a[o](u+"DOMContentLoaded",c,!1),a[o](u+"readystatechange",c,!1),t[o](u+"load",c,!1)}}function i(t){if(!t.parentNode)return-1;for(var e=0,r=t.tagName,i=t.parentNode.children,a=0;a<i.length;a++)if(i[a].tagName===r){if(t===i[a])return e;e++}return-1}function a(t){var e=t.parentNode&&9==t.parentNode.nodeType?-1:i(t);return t.getAttribute&&t.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(t.getAttribute("id"))?"#"+t.getAttribute("id"):t.tagName.toLowerCase()+(~e?":nth-of-type("+(e+1)+")":"")}function n(t,e){if(!t||!t.parentNode||!t.parentNode.children)return!1;e=e&&e.join?e:[];var r=t.nodeName.toLowerCase();return t&&"body"!==r&&1==t.nodeType?(e.unshift(a(t)),t.getAttribute&&t.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(t.getAttribute("id"))?e.join(" > "):n(t.parentNode,e)):(e.unshift("body"),e.join(" > "))}function s(t,e){return t.currentStyle?t.currentStyle[e]:t.ownerDocument.defaultView.getComputedStyle(t,null).getPropertyValue(e)}function o(t,e){var r={};return x.each(e||[],function(e){var i=e.replace(/[A-Z]+/g,function(t){return"-"+t.toLowerCase()});r[e]=s(t,i)}),r}function l(t){var e=t.childNodes,r="";return x.each(e,function(e){""===r&&3===e.nodeType&&(x.isString(e.textContent)||x.isString(t.innerText))&&(r=x.trim(e.textContent||t.innerText))}),r}function u(t){function e(t,e){t=x.trim(t);var r;if("body"===t)return document.getElementsByTagName("body")[0];if(0===t.indexOf("#"))t=t.slice(1),r=document.getElementById(t);else if(t.indexOf(":nth-of-type")>-1){var i=t.split(":nth-of-type");if(!i[0]||!i[1])return null;var a=i[0],n=i[1].match(/\(([0-9]+)\)/);if(!n||!n[1])return null;var s=Number(n[1]);if(!(x.isElement(e)&&e.children&&e.children.length>0))return null;for(var o=e.children,l=0;l<o.length;l++)if(x.isElement(o[l])){var u=o[l].tagName.toLowerCase();if(u===a&&(s--,0===s)){r=o[l];break}}if(s>0)return null}return r?r:null}function r(t){var a,n=i.shift();if(!n)return t;try{a=e(n,t)}catch(s){a=null}return a&&x.isElement(a)?r(a):null}if(!x.isString(t))return null;var i=t.split(">"),a=null;return a=r(),a&&x.isElement(a)?a:null}function c(t){var e=t.match(/[\d.]+/g);if(e.length>=3){var r,i,a;return r=e[0],i=e[1],a=e[2],"rgb("+r+","+i+","+a+")"}return""}function h(e,r){function i(t,e){var r=t.length-e.length;return r>=0&&t.indexOf(e,r)==r}var a=t(),n=a.ie&&a.ie<9,s="";if(x.each(r,function(t,e){n&&t.indexOf("rgba")>-1&&(t=c(t)),s+=";"+e+": "+t}),""!==s){var o=e.style,l=o.cssText||"";l&&!i(l,";")&&(l+=";"),o.cssText=l+s}}function d(t,e){var r=t.childNodes,i=!1;x.each(r,function(t){3===t.nodeType&&(i||(t.textContent?t.textContent=e:t.innerText?t.innerText=e:t.nodeValue=e,i=!0))})}function p(t,e){var r=t.originProps,i=e.originProps,a=r.attributes,n=i.attributes,s=!0;return r.text&&r.text!==i.text&&(s=!1),a&&x.each(["src","href","target"],function(t){a[t]&&a[t]!==n[t]&&(s=!1)}),s}function f(t,e,r){t.setAttribute(e,r)}function g(t,e){var r=e.originProps,i={attributes:{}},a=r.attributes;return x.each(a.style||{},function(e,r){i.attributes.style[r]=s(t,r)}),Object.hasOwnProperty.call(r,"text")&&(i.attributes.text=l(t)),x.each(["src","href"],function(e){Object.hasOwnProperty.call(a,e)&&(i.attributes[e]=t[e])}),Object.hasOwnProperty.call(a,"target")&&(i.attributes.target=t.getAttribute("target")),i}function _(t,e,r){if(r||(r=g(t,e)),p(e,r)){var i=e.props;x.isObject(i)&&m(t,i)}}function m(t,e){if(Object.hasOwnProperty.call(e,"attributes")){var r=e.attributes;Object.hasOwnProperty.call(r,"style")&&h(t,r.style),x.each(["href","target","src"],function(e){Object.hasOwnProperty.call(r,e)&&f(t,e,r[e])})}Object.hasOwnProperty.call(e,"text")&&d(t,e.text)}function v(t){t=x.extend({success:function(){},error:function(){},appendCall:function(t){document.getElementsByTagName("head")[0].appendChild(t)}},t);var e=null;"css"===t.type&&(e=document.createElement("link"),e.rel="stylesheet",e.href=t.url),"js"===t.type&&(e=document.createElement("script"),e.async="async",e.setAttribute("charset","UTF-8"),e.src=t.url,e.type="text/javascript"),e.onload=e.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(t.success(),e.onload=e.onreadystatechange=null)},e.onerror=function(){t.error(),e.onerror=null},t.appendCall(e)}function b(t){v({success:function(){},error:function(){},type:"js",url:t})}function y(t){var e={childList:!0,subtree:!0},r=window.MutationObserver,i=new r(t);i.observe(document.body,e)}function S(t,e){var r=t.tagName.toLowerCase(),i=o(t,e),a={selector:n(t),originProps:{attributes:{style:i},text:l(t)},type:"text",tagName:r};"a"===r&&(a.originProps.attributes.href=t.href,t.getAttribute("target")&&(a.originProps.attributes.target=t.getAttribute("target")),a.type="link"),"img"===r&&(a.originProps.attributes.src=t.src,a.type="img");var s=t.getAttribute("style");return{originStyle:s,eleInfo:a,ele:t}}function k(t){var e=t.eleInfo,r=t.ele;if(r){var i=t.originStyle;m(r,e.originProps),i?r.style.cssText=i:r.style.cssText=""}}function w(){this.enable_visualize=!1,this.vabtest_url=location.protocol+"//static.sensorsdata.cn/plugin/vabtest/"+T.lib_version+"/vabtesting.min.js",this.timeout=500,this.is_editor=!1,this.use_mask=!0,this.originData=[],this.visualExp=null,this.isFirst=!0,this.start_time=null,this.is_have_observer=!1}var T={sd:null,lib_version:"0.0.7",para:{},default_para:{url:"",path:"",project_key:"",timeout_milliseconds:3e3,update_interval:6e5,collect_bridge_status:!0,session_limit:6e5},value_type_list:["Number","String","Object","Boolean"],state:{platform:"",storage:{isSupport:!0,name:"sawebjssdkabtest"}},bridgeState:"",localdata:{},originalData:[],triggerList:{},updateTime:null},x={},D=Array.prototype,A=Object.prototype,O=D.slice,P=A.toString,j=A.hasOwnProperty,E=D.forEach,B=Array.isArray,N={};x.each=function(t,e,r){if(null==t)return!1;if(E&&t.forEach===E)t.forEach(e,r);else if(x.isArray(t)&&t.length===+t.length){for(var i=0,a=t.length;i<a;i++)if(i in t&&e.call(r,t[i],i,t)===N)return!1}else for(var n in t)if(j.call(t,n)&&e.call(r,t[n],n,t)===N)return!1},x.extend=function(t){return x.each(O.call(arguments,1),function(e){for(var r in e)j.call(e,r)&&void 0!==e[r]&&(t[r]=e[r])}),t},x.isArray=B||function(t){return"[object Array]"===P.call(t)},x.isObject=function(t){return null!=t&&"[object Object]"==P.call(t)},x.isElement=function(t){return!(!t||1!==t.nodeType)},x.isString=function(t){return"[object String]"==P.call(t)},x.isBoolean=function(t){return"[object Boolean]"==P.call(t)},x.isNumber=function(t){return"[object Number]"==P.call(t)&&/[\d\.]+/.test(String(t))},x.unique=function(t){for(var e,r=[],i={},a=0;a<t.length;a++)e=t[a],e in i||(i[e]=!0,r.push(e));return r},x.decodeURIComponent=function(t){var e=t;try{e=decodeURIComponent(t)}catch(r){e=t}return e},x.getQueryParam=function(t,e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),t=x.decodeURIComponent(t);var r="[\\?&]"+e+"=([^&#]*)",i=new RegExp(r),a=i.exec(t);return null===a||a&&"string"!=typeof a[1]&&a[1].length?"":x.decodeURIComponent(a[1])},x.indexOf=function(t,e){var r=t.indexOf;if(r)return r.call(t,e);for(var i=0;i<t.length;i++)if(e===t[i])return i;return-1},x.isFunction=function(t){if(!t)return!1;var e=Object.prototype.toString.call(t);return"[object Function]"==e||"[object AsyncFunction]"==e},x.isEmptyObject=function(t){if(x.isObject(t)){for(var e in t)if(j.call(t,e))return!1;return!0}return!1},x.map=function(t,e){var r=[];return null==t?r:Array.prototype.map&&t.map===Array.prototype.map?t.map(e):(x.each(t,function(t,i,a){r.push(e(t,i,a))}),r)},x.base64Decode=function(t){var e=x.map(atob(t).split(""),function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)});return decodeURIComponent(e.join(""))},x.getURLSearchParams=function(t){t=t||"";for(var e=function(t){return decodeURIComponent(t)},r={},i=t.substring(1),a=i.split("&"),n=0;n<a.length;n++){var s=a[n].indexOf("=");if(s!==-1){var o=a[n].substring(0,s),l=a[n].substring(s+1);o=e(o),l=e(l),r[o]=l}}return r},x.urlParse=function(t){var e=function(t){this._fields={Username:4,Password:5,Port:7,Protocol:2,Host:6,Path:8,URL:0,QueryString:9,Fragment:10},this._values={},this._regex=null,this._regex=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/,"undefined"!=typeof t&&this._parse(t)};return e.prototype.setUrl=function(t){this._parse(t)},e.prototype._initValues=function(){for(var t in this._fields)this._values[t]=""},e.prototype.addQueryString=function(t){if("object"!=typeof t)return!1;var e=this._values.QueryString||"";for(var r in t)e=new RegExp(r+"[^&]+").test(e)?e.replace(new RegExp(r+"[^&]+"),r+"="+t[r]):"&"===e.slice(-1)?e+r+"="+t[r]:""===e?r+"="+t[r]:e+"&"+r+"="+t[r];this._values.QueryString=e},e.prototype.getUrl=function(){var t="";return t+=this._values.Origin,t+=this._values.Port?":"+this._values.Port:"",t+=this._values.Path,t+=this._values.QueryString?"?"+this._values.QueryString:"",t+=this._values.Fragment?"#"+this._values.Fragment:""},e.prototype.getUrl=function(){var t="";return t+=this._values.Origin,t+=this._values.Port?":"+this._values.Port:"",t+=this._values.Path,t+=this._values.QueryString?"?"+this._values.QueryString:""},e.prototype._parse=function(t){this._initValues();var e=this._regex.exec(t);e||x.log("DPURLParser::_parse -> Invalid URL");for(var r in this._fields)"undefined"!=typeof e[this._fields[r]]&&(this._values[r]=e[this._fields[r]]);this._values.Hostname=this._values.Host.replace(/:\d+$/,""),this._values.Origin=this._values.Protocol+"://"+this._values.Hostname},new e(t)},x.URL=function(t){var e={},r=function(){var t;try{return t=new URL("http://modernizr.com/"),"http://modernizr.com/"===t.href}catch(e){return!1}};if("function"==typeof window.URL&&r())e=new URL(t),e.searchParams||(e.searchParams=function(){var t=x.getURLSearchParams(e.search);return{get:function(e){return t[e]}}}());else{var i=/^https?:\/\/.+/;i.test(t)===!1&&x.log("Invalid URL");var a=x.urlParse(t);e.hash="",e.host=a._values.Host?a._values.Host+(a._values.Port?":"+a._values.Port:""):"",e.href=a._values.URL,e.password=a._values.Password,e.pathname=a._values.Path,e.port=a._values.Port,e.search=a._values.QueryString?"?"+a._values.QueryString:"",e.username=a._values.Username,e.hostname=a._values.Hostname,e.protocol=a._values.Protocol?a._values.Protocol+":":"",e.origin=a._values.Origin?a._values.Origin+(a._values.Port?":"+a._values.Port:""):"",e.searchParams=function(){var t=x.getURLSearchParams("?"+a._values.QueryString);return{get:function(e){return t[e]}}}()}return e},x.getQueryParam=function(t,e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),t=x.decodeURIComponent(t);var r="[\\?&]"+e+"=([^&#]*)",i=new RegExp(r),a=i.exec(t);return null===a||a&&"string"!=typeof a[1]&&a[1].length?"":x.decodeURIComponent(a[1])},x.isEmptyObject=function(t){if(x.isObject(t)){for(var e in t)if(j.call(t,e))return!1;return!0}return!1},x.contentLoaded=function(t,e){var r=!1,i=!0,a=t.document,n=a.documentElement,s=a.addEventListener,o=s?"addEventListener":"attachEvent",l=s?"removeEventListener":"detachEvent",u=s?"":"on",c=function(i){"readystatechange"==i.type&&"complete"!=a.readyState||(("load"==i.type?t:a)[l](u+i.type,c,!1),!r&&(r=!0)&&e.call(t,i.type||i))},h=function(){try{n.doScroll("left")}catch(t){return void setTimeout(h,50)}c("poll")};if("complete"==a.readyState)e.call(t,"lazy");else{if(!s&&n.doScroll){try{i=!t.frameElement}catch(d){}i&&h()}a[o](u+"DOMContentLoaded",c,!1),a[o](u+"readystatechange",c,!1),t[o](u+"load",c,!1)}},x.secCheck={isHttpUrl:function(t){if("string"!=typeof t)return!1;var e=/^https?:\/\/.+/;return e.test(t)!==!1||(x.log("Invalid URL"),!1)},removeScriptProtocol:function(t){if("string"!=typeof t)return"";for(var e=/^\s*javascript/i;e.test(t);)t=t.replace(e,"");return t}},x.addEvent=function(){function t(e){return e&&(e.preventDefault=t.preventDefault,e.stopPropagation=t.stopPropagation,e._getPath=t._getPath),e}function e(e,r,i){var a=function(a){if(a=a||t(window.event)){a.target=a.srcElement;var n,s,o=!0;return"function"==typeof i&&(n=i(a)),s=r.call(e,a),!1!==n&&!1!==s||(o=!1),o}};return a}t._getPath=function(){var t=this,e=function(){try{var e=t.target,r=[e];if(null===e||null===e.parentElement)return[];for(;null!==e.parentElement;)e=e.parentElement,r.unshift(e);return r}catch(i){return[]}};return this.path||this.composedPath&&this.composedPath()||e()},t.preventDefault=function(){this.returnValue=!1},t.stopPropagation=function(){this.cancelBubble=!0};var r=function(r,i,a){var n=!0;if(r&&r.addEventListener)r.addEventListener(i,function(e){e._getPath=t._getPath,a.call(this,e)},n);else{var s="on"+i,o=r[s];r[s]=e(r,a,o)}};r.apply(null,arguments)},x.addSinglePageEvent=function(t){var e=location.href,r=window.history.pushState,i=window.history.replaceState;window.history.pushState=function(){r.apply(window.history,arguments),t(e),e=location.href},window.history.replaceState=function(){i.apply(window.history,arguments),t(e),e=location.href};var a=r?"popstate":"hashchange";x.addEvent(window,a,function(){t(e),e=location.href})},x.trim=function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},x.checkUrlIsMatch=function(t,e){var r,i,a=x.URL(t);if("STRICT"===e)return location.href===a.href;if("FUZZY"===e){try{r=x.URL(location.href)}catch(n){return x.log("url \u89e3\u6790\u5931\u8d25",n),!1}try{i=x.URL(t)}catch(n){return x.log("control_url \u89e3\u6790\u5931\u8d25",n),!1}return r.host===i.host&&r.pathname===i.pathname}return x.log("link_match_type\u5b57\u6bb5\u5f02\u5e38",e),!1},T.verifyStore={valueType:function(t,e){switch(e){case"Number":if(x.isNumber(t))return!0;break;case"String":if(x.isString(t))return!0;break;case"Object":if(x.isObject(t))return!0;break;case"Boolean":if(t===!0||t===!1)return!0;break;default:return!1}return!1},para:function(t,e,r){var i={verify_success:!0,para:null};return x.each(r,function(r,a){if("essential"===r)switch(a){case"param_name":x.isString(e.param_name)&&e.param_name.length>0||(T.error(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cparam_name\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e\uff01param_name:",e.param_name),i.verify_success=!1);break;case"value_type":x.isString(e.value_type)&&x.indexOf(T.value_type_list,e.value_type)!==-1||(T.error(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cvalue_type\u914d\u7f6e\u9519\u8bef",e.value_type),i.verify_success=!1);break;case"default_value":"undefined"==typeof e.default_value?(T.error(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u53c2\u6570\u672a\u914d\u7f6e"),i.verify_success=!1):T.verifyStore.valueType(e.default_value,e.value_type)||(T.error(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u7c7b\u578b\u5fc5\u987b\u4e0evalue_type\u4e00\u81f4\uff01",e.default_value,e.value_type),i.verify_success=!1);break;case"callback":x.isFunction(e.callback)||(T.error(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0ccallback\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),i.verify_success=!1);break;default:i.verify_success=!1}else if("not_essential"===r)switch(a){case"timeout_milliseconds":e.timeout_milliseconds=e.timeout_milliseconds||T.para.timeout_milliseconds||T.default_para.timeout_milliseconds,(!x.isNumber(e.timeout_milliseconds)||x.isNumber(e.timeout_milliseconds)&&e.timeout_milliseconds<=0)&&(x.log("timeout_milliseconds \u53c2\u6570\u9519\u8bef",e.timeout_milliseconds),e.timeout_milliseconds=T.para.timeout_milliseconds),e.timeout_milliseconds<200&&(e.timeout_milliseconds=200);break;case"properties":e.properties=x.isObject(e.properties)?e.properties:{}}}),i.para=e,i}},T.getSA=function(t){return!!(x.isObject(t)&&x.isObject(t.readyState)&&t.readyState.state>=3)&&(this.sd=t,!0)},T.log=function(){if("object"==typeof console&&console.log){x.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]);try{return console.log.apply(console,arguments)}catch(t){console.log(arguments[0])}}},T.error=function(){if("object"==typeof console&&console.error)try{return console.error.apply(console,arguments)}catch(t){console.error(arguments[0])}},T.listenPageState=function(t){var e={visibleHandle:x.isFunction(t.visible)?t.visible:function(){},hiddenHandler:x.isFunction(t.hidden)?t.hidden:function(){},visibilityChange:null,hidden:null,isSupport:function(){return"undefined"!=typeof document[this.hidden]},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var t=this;document.addEventListener(t.visibilityChange,function(){document[t.hidden]?t.hiddenHandler():t.visibleHandle()},1)}else document.addEventListener?(window.addEventListener("focus",this.visibleHandle,1),window.addEventListener("blur",this.hiddenHandler,1)):(document.attachEvent("onfocusin",this.visibleHandle),document.attachEvent("onfocusout",this.hiddenHandler))}};e.init()},T.storage={set:function(t,e){T.state.storage.isSupport&&window.localStorage.setItem(e,JSON.stringify(t))},get:function(t){var e=null;T.state.storage.isSupport&&(e=window.localStorage.getItem(t));try{e=JSON.parse(e)}catch(r){x.log(r)}return e}},T.getStorageData=function(){return this.storage.get(T.state.storage.name)},T.setStorageData=function(t){this.storage.set(t,T.state.storage.name)},T.Mask=function(t){this.element=t,this.remove_timer=null,this.is_added=!1,this.is_abort=!1},T.Mask.prototype={show:function(t){var e=this,r=(new Date).getTime();return!!x.isElement(this.element)&&void x.contentLoaded(window,function(){if(e.is_abort)return!1;var i=document.getElementsByTagName("body")[0];if(x.isElement(i)&&(i.appendChild(e.element),e.is_added=!0,x.isNumber(t))){var a=(new Date).getTime()-r;t-=a,e.remove_timer=setTimeout(function(){e.remove()},t)}})},remove:function(){if(x.isElement(this.element)){if(this.is_abort||(this.is_abort=!0),this.is_added){this.is_added=!1;var t=document.getElementsByTagName("body")[0];if(!x.isElement(t))return;t.removeChild(this.element)}this.remove_timer&&(clearTimeout(this.remove_timer),this.remove_timer=null),this.element=null}}},T.asyncFetchABTest=function(){T.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},T.fastFetchABTest=function(){T.error("fastFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},T.fetchCacheABTest=function(){T.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},T.searchLocalExp=function(t){return T.localdata[t]?T.localdata[t]:null},T.getExpResult=function(t,e){var r=t.default_value,i=e?e:T.searchLocalExp(t.param_name);return x.isObject(i)?x.isObject(i.js_config)&&(i.js_config.type===t.value_type?(r=i.js_config.value,this.triggerHandle(i,t)):x.log("\u8bd5\u9a8c\u7ed3\u679c\u7c7b\u578b\u4e0e\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e0d\u4e00\u81f4\uff0cparam_name\uff1a"+t.param_name+"\uff0c\u5f53\u524d\u8fd4\u56de\u7c7b\u578b\u4e3a\uff1a"+i.js_config.type+"\uff0c\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e3a\uff1a"+t.value_type)):x.log("localdata\u672a\u67e5\u8be2\u5230\u8bd5\u9a8c\u6570\u636e\uff0c\u8bd5\u9a8c\u53c2\u6570\u540d\u79f0\uff1a"+t.param_name),r},T.resolveVariables=function(t){this.localdata={};var e=this;x.each(t,function(t){if(x.isObject(t)&&t.variables&&x.isArray(t.variables)){if(t.experiment_type&&"CODE"!==t.experiment_type)return!1;x.each(t.variables,function(r){x.isObject(r)&&!e.localdata[r.name]&&(e.localdata[r.name]={abtest_experiment_id:t.abtest_experiment_id,abtest_experiment_group_id:t.abtest_experiment_group_id,is_control_group:t.is_control_group,is_white_list:t.is_white_list,value:r.value,type:r.type,js_config:T.getRelativeValue(r.value,r.type),experiment_type:t.experiment_type})})}})},T.getRelativeValue=function(t,e){var r={},i={INTEGER:function(t){var e=parseFloat(t);isNaN(e)?x.log("\u539f\u59cb\u6570\u636e INTEGER \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t):(r.value=e,r.type="Number")},STRING:function(t){x.isString(t)?(r.value=t,r.type="String"):x.log("\u539f\u59cb\u6570\u636e STRING \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)},JSON:function(t){var e=JSON.parse(t);x.isObject(e)?(r.value=e,r.type="Object"):x.log("\u539f\u59cb\u6570\u636e JSON \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)},BOOLEAN:function(t){"true"===t?(r.value=!0,r.type="Boolean"):"false"===t?(r.value=!1,r.type="Boolean"):x.log("\u539f\u59cb\u6570\u636e BOOLEAN \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)}};try{i[e]?i[e](t):x.log("\u8bd5\u9a8c\u6570\u636e\u7c7b\u578b\u89e3\u6790\u5931\u8d25",e,t)}catch(a){x.log(a,t,e)}return r},T.link={isFirst:!0,start_time:null,mask_instance:null,is_filtered_out:!1,para:{timeout:500,use_mask:!1,pass_params:!0,control_link_search:"default",experiment_link_search:"default"},init:function(t){return this.initPara(t),this.para?x.getQueryParam(location.href,"saSDKMultilink")?(this.is_filtered_out=!0,!1):(this.start_time=(new Date).getTime(),this.para.use_mask&&this.initMask(),void this.addSinglePageListener()):(x.log("multilink is closed"),!1)},addSinglePageListener:function(){var t=this;x.addSinglePageEvent(function(e){return e!==location.href&&(t.is_filtered_out=!1,t.isFirst=!0,t.mask_instance&&t.mask_instance.remove(),x.getQueryParam(location.href,"saSDKMultilink")?(t.is_filtered_out=!0,!1):(t.start_time=(new Date).getTime(),t.para.use_mask&&t.initMask(),void t.resolve(T.originalData)))})},initMask:function(){var t=document.createElement("div");t.style.position="fixed",t.style.width="100%",t.style.height="100%",t.style.top="0px",t.style.left="0px",t.style.background="#fff",this.mask_instance=new T.Mask(t),this.mask_instance.show(this.para.timeout)},initPara:function(t){if(x.isFunction(t))try{t=t()}catch(e){return x.log("link para error!"),void(this.para=!1)}t===!1?this.para=!1:x.isObject(t)&&(this.para.timeout=x.isNumber(t.timeout)&&t.timeout<=5e3&&t.timeout>=0?t.timeout:500,this.para.use_mask=!!x.isBoolean(t.use_mask)&&t.use_mask,this.para.control_link_search=x.isString(t.control_link_search)?t.control_link_search:"default",this.para.experiment_link_search=x.isString(t.experiment_link_search)?t.experiment_link_search:"default",this.para.pass_params=!x.isBoolean(t.pass_params)||t.pass_params)},resolve:function(t){var e=this;if(!this.para)return!1;if(!x.isArray(t))return!1;if(this.is_filtered_out)return!1;if(!this.isFirst)return!1;if(this.isFirst=!1,0===this.para.timeout)return!1;if((new Date).getTime()-this.start_time>this.para.timeout)return x.log("The multilink was stopped because the request timeout"),!1;var r=!1;x.each(t,function(t){if(!x.isObject(t))return!1;if(r)return!1;if("LINK"!==t.experiment_type)return!1;if(e.isTriggerLinkExp(t)){r=!0;var i=T.triggerHandle(t);i?setTimeout(function(){e.redirectUrl(t)},80):setTimeout(function(){e.redirectUrl(t)},0)}}),!r&&this.para.use_mask&&this.mask_instance.remove()},stopTrigger:function(){this.isFirst=!1,x.log("The multilink was stopped because the request failed"),this.para.use_mask&&this.mask_instance.remove()},isTriggerLinkExp:function(t){return x.isString(t.control_link)&&x.isString(t.link_match_type)?!!x.checkUrlIsMatch(t.control_link,t.link_match_type)||(x.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",t.abtest_experiment_id),!1):(x.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u6570\u636e\u5f02\u5e38",t.abtest_experiment_id),!1)},redirectUrl:function(t){function e(t){return x.secCheck.isHttpUrl(t)?x.secCheck.removeScriptProtocol(t):(x.log("\u975e\u6cd5URL"),!1)}if(!t.experiment_link||!x.isString(t.experiment_link))return void x.log("\u9875\u9762\u8df3\u8f6c\u5931\u8d25\uff0cexperiment_link\u5b57\u6bb5\u5f02\u5e38",t.abtest_experiment_id);if(t.is_control_group!==!0||"STRICT"!==t.link_match_type){var r,i;this.para.pass_params?(i=this.getMergedUrl(t.is_control_group,t.experiment_link,location.href),r=e(i)):(i=this.getMergedUrl(t.is_control_group,t.experiment_link),r=e(i)),r&&(location.href=r)}},getMergedUrl:function(t,e,r){function i(t){var e=/([^?#]+)(\?[^#]*)?(#.*)?/,r=e.exec(t);if(r){var i=r[1]||"",a=r[2]||"",n=r[3]||"";return{host:i,search:a,hash:n}}}function a(t){var e={hash:"",search:""};if(!x.isString(t))return e;var r=t.indexOf("?");return r>-1?(e.search=t.slice(r),e.hash=t.slice(0,r)):e.hash=t,e}var n="",s="",o="",l={parse_url:null,search:""},u={parse_url:null,search:"",hash:""};return r&&(l.parse_url=i(r),!l.parse_url)?void x.log("url \u89e3\u6790\u5931\u8d25",r):(u.parse_url=i(e),u.parse_url?(r&&("after_hash"===this.para.control_link_search?l.search=a(l.parse_url.hash).search:l.search=l.parse_url.search),t?"after_hash"===this.para.control_link_search?(u.search=a(u.parse_url.hash).search,u.hash=a(u.parse_url.hash).hash):u.search=u.parse_url.search:"after_hash"===this.para.experiment_link_search?(u.search=a(u.parse_url.hash).search,u.hash=a(u.parse_url.hash).hash):u.search=u.parse_url.search,s=r?this.getSearchStr(l.search,u.search):this.getSearchStr(u.search),t&&"after_hash"===this.para.control_link_search||!t&&"after_hash"===this.para.experiment_link_search?n=u.hash.length>0?u.parse_url.host+u.parse_url.search+u.hash+s:u.parse_url.search.length>0?u.parse_url.host+u.parse_url.search+"&"+s.substring(1):u.parse_url.host+s:(o="after_hash"===this.para.control_link_search?u.parse_url.hash:r?u.parse_url.hash||l.parse_url.hash:u.parse_url.hash,n=u.parse_url.host+s+o),n):void x.log("url \u89e3\u6790\u5931\u8d25",e))},getSearchStr:function(t,e){function r(t){var e={};if(!t||!t.length||0!==t.indexOf("?"))return e;if(t=t.slice(1),!t.length)return e;for(var r=t.split("&"),i=0;i<r.length;i++)if(r[i].indexOf("=")<0)e[r[i]]=null;else{var a=r[i].split("=");e[a[0]]=a[1]}return e}var i=r(t),a=r(e),n=x.extend(i,a),s="";if(x.isEmptyObject(n))return"?saSDKMultilink=true";var o=!0;for(var l in n)o?(s+="?",o=!1):s+="&",null!==n[l]?s=s+l+"="+n[l]:s+=l;return s+="&saSDKMultilink=true"}},T.bridgeStore={init:function(t){return!!this.setPara(t)&&(x.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f"),T.state.storage.name="sawebjssdkabtest_bridge",T.abBridge=new T.sd.JSBridge({type:"abtest",app_call_js:function(t){try{t=x.base64Decode(t)}catch(e){x.log("App\u6570\u636ebase64\u89e3\u7801\u5f02\u5e38",t)}try{t=JSON.parse(t),t.message_id&&this["double"](t)}catch(e){x.log("App\u6570\u636e\u89e3\u6790\u5f02\u5e38",t)}}}),x.isObject(window.SensorsData_iOS_JS_Bridge)&&window.SensorsData_iOS_JS_Bridge.sensorsdata_abtest_module&&T.abBridge.hasAppBridge()?T.bridgeState="ab_bridge_ok":x.isObject(window.SensorsData_APP_New_H5_Bridge)&&x.isFunction(window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module)&&window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module()&&T.abBridge.hasAppBridge()?T.bridgeState="ab_bridge_ok":T.bridgeState="ab_no_abtest_bridge",void T.store.init(this.getResultFromApp,this))},setPara:function(t){var e=T.verifyStore.para("\u6253\u901a\u521d\u59cb\u5316",t,{timeout_milliseconds:"not_essential"});return T.para=x.extend({},T.default_para,e.para),x.isBoolean(T.para.collect_bridge_status)||(T.para.collect_bridge_status=!0),x.isNumber(T.para.update_interval)||(T.para.update_interval=6e5),!0},getResultFromApp:function(t){function e(){"ab_bridge_ok"===T.bridgeState?T.abBridge.requestToApp({data:{properties:r.properties,timeout:n,request_body:{origin_platform:"H5"}},callback:function(t){x.isObject(t)&&x.isObject(t.data)?(x.log("\u6210\u529f\u83b7\u53d6\u5230 App \u7aef\u8fd4\u56de\u7684\u8bd5\u9a8c\u6570\u636e","data:",t),T.dealResponseData(t.data),i&&i(t)):(x.log("App \u7aef\u8bf7\u6c42\u5931\u8d25"),a&&a()),T.fetchData.setNextFetch()},timeout:{time:n,callback:function(){x.log("\u83b7\u53d6App\u7aef\u6570\u636e\u5931\u8d25"),a&&a(),T.fetchData.setNextFetch()}}}):a&&(x.log("A/B Testing \u6253\u901a\u5931\u8d25\uff0c",T.bridgeState),a())}t=x.isObject(t)?t:{};var r=t.para||{},i=t.suc,a=t.err,n=r.timeout_milliseconds||T.para.timeout_milliseconds;x.log("\u5411App\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),e()},asyncFetch:function(t){T.bridgeStore.getResultFromApp({para:t,suc:function(e){if(x.isObject(e.properties)&&(t.properties=x.extend(e.properties,t.properties)),"SUCCESS"===e.data.status){var r=T.getExpResult(t);t.callback(r)}else t.callback(t.default_value)},err:function(){t.callback(t.default_value)}})}},T.bridgeStore.methods={asyncFetchABTest:function(t){if(!x.isObject(t))return T.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=T.verifyStore.para("asyncFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});e.verify_success&&(t=e.para,"ab_bridge_ok"===T.bridgeState?T.bridgeStore.asyncFetch(t):t.callback(t.default_value))},fastFetchABTest:function(t){if(!x.isObject(t))return T.error("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=T.verifyStore.para("fastFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(e.verify_success){t=e.para;var r=T.searchLocalExp(t.param_name);if(x.isObject(r)){var i=T.getExpResult(t,r);t.callback(i)}else x.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),"ab_bridge_ok"===T.bridgeState?T.bridgeStore.asyncFetch(t):t.callback(t.default_value)}},fetchCacheABTest:function(t){if(!x.isObject(t))return void T.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e");var e=T.verifyStore.para("fetchCacheABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential"});if(e.verify_success)return T.getExpResult(e.para)}},T.normalStore={init:function(t){return!!this.setPara(t)&&(T.bridgeState="ab_no_host_bridge",/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?T.state.platform="H5":T.state.platform="Web",x.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f\uff0c\u8bd5\u9a8c URL\uff1a",t.url),T.checkSADebug(),void T.store.init(this.getResultFromServer,this))},setPara:function(t){if(!x.isString(t.url)||"http"!==t.url.slice(0,4))return x.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1;if("https"===location.protocol.slice(0,5)&&"http:"===t.url.slice(0,5))return x.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0chttps \u9875\u9762\u5fc5\u987b\u4f7f\u7528 https \u7684 URL"),!1;var e=x.getQueryParam(t.url,"project-key");if(!e)return x.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff08\u5fc5\u987b\u5305\u542b project-key\uff09\uff01"),!1;t.project_key=e;var r=T.verifyStore.para("A/B Testing SDK \u521d\u59cb\u5316",t,{timeout_milliseconds:"not_essential"});return T.para=x.extend({},T.default_para,r.para),x.isBoolean(T.para.collect_bridge_status)||(T.para.collect_bridge_status=!0),x.isNumber(T.para.update_interval)||(T.para.update_interval=6e5),!0},asyncFetch:function(t){T.normalStore.getResultFromServer({para:t,suc:function(e){if(x.isObject(e)&&"SUCCESS"===e.status){var r=T.getExpResult(t);t.callback(r)}else t.callback(t.default_value)},err:function(){t.callback(t.default_value)}})},creatRequestData:function(t){var e="";x.isEmptyObject(T.sd.store._state)||(e=T.sd.store._state._first_id||T.sd.store._state.first_id||T.sd.store._state._distinct_id||T.sd.store._state.distinct_id);var r={anonymous_id:e,platform:T.state.platform,abtest_lib_version:T.lib_version,properties:{$is_first_day:T.sd._.cookie.getNewUser()}};return x.isObject(t.properties)&&(r.properties=x.extend({},r.properties,t.properties)),T.sd.store._state.first_id&&(r.login_id=T.sd.store.getDistinctId()),r},getResultFromServer:function(t){function e(){var t=T.sd.store.getDistinctId();T.sd._.ajax({url:T.para.url,type:"POST",data:JSON.stringify(n),credentials:!1,contentType:"application/json",timeout:r.timeout_milliseconds||T.para.timeout_milliseconds,cors:!0,success:function(e){T.dealResponseData(e,t),i&&i(e),T.fetchData.setNextFetch()},error:function(t){x.log("\u670d\u52a1\u7aef\u8bf7\u6c42\u53d1\u9001\u5931\u8d25",t),a&&a(),T.fetchData.setNextFetch()}})}t=x.isObject(t)?t:{};var r=t.para||{},i=t.suc,a=t.err,n=this.creatRequestData(r);x.log("\u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),e()}},T.normalStore.methods={asyncFetchABTest:function(t){if(!x.isObject(t))return T.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=T.verifyStore.para("asyncFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});e.verify_success&&(t=e.para,T.normalStore.asyncFetch(t))},fastFetchABTest:function(t){
if(!x.isObject(t))return T.error("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=T.verifyStore.para("fastFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(e.verify_success){t=e.para;var r=T.searchLocalExp(t.param_name);if(x.isObject(r)){var i=T.getExpResult(t,r);t.callback(i)}else x.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),T.normalStore.asyncFetch(t)}},fetchCacheABTest:function(t){if(!x.isObject(t))return void T.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e");var e=T.verifyStore.para("fetchCacheABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential"});if(e.verify_success)return T.getExpResult(e.para)}},window.MutationObserver||(window.MutationObserver=function(t){function e(t){this._watched=[],this._listener=t}function r(t){!function r(){var i=t.takeRecords();i.length&&t._listener(i,t),t._timeout=setTimeout(r,e._period)}()}function i(e){var r={type:null,target:null,addedNodes:[],removedNodes:[],previousSibling:null,nextSibling:null,attributeName:null,attributeNamespace:null,oldValue:null};for(var i in e)g(r,i)&&e[i]!==t&&(r[i]=e[i]);return r}function a(t,e){var r=u(t,e);return function(a){var n,s=a.length;e.charData&&3===t.nodeType&&t.nodeValue!==r.charData&&a.push(new i({type:"characterData",target:t,oldValue:r.charData})),e.attr&&r.attr&&o(a,t,r.attr,e.afilter),(e.kids||e.descendents)&&(n=l(a,t,r,e)),(n||a.length!==s)&&(r=u(t,e))}}function n(t,e){return e.value}function s(t,e){return"style"!==e.name?e.value:t.style.cssText}function o(t,e,r,a){for(var n,s,o={},l=e.attributes,u=l.length;u--;)n=l[u],s=n.name,a&&!g(a,s)||(v(e,n)!==r[s]&&t.push(i({type:"attributes",target:e,attributeName:s,oldValue:r[s],attributeNamespace:n.namespaceURI})),o[s]=!0);for(s in r)o[s]||t.push(i({target:e,type:"attributes",attributeName:s,oldValue:r[s]}))}function l(e,r,a,n){function s(t,r,a,s,u){for(var c,h,d,p=t.length-1,f=-~((p-u)/2);d=t.pop();)c=a[d.i],h=s[d.j],n.kids&&f&&Math.abs(d.i-d.j)>=p&&(e.push(i({type:"childList",target:r,addedNodes:[c],removedNodes:[c],nextSibling:c.nextSibling,previousSibling:c.previousSibling})),f--),n.attr&&h.attr&&o(e,c,h.attr,n.afilter),n.charData&&3===c.nodeType&&c.nodeValue!==h.charData&&e.push(i({type:"characterData",target:c,oldValue:h.charData})),n.descendents&&l(c,h)}function l(r,a){for(var d,p,g,_,m,v,b,y=r.childNodes,S=a.kids,k=y.length,w=S?S.length:0,T=0,x=0,D=0;x<k||D<w;)v=y[x],m=S[D],b=m&&m.node,v===b?(n.attr&&m.attr&&o(e,v,m.attr,n.afilter),n.charData&&m.charData!==t&&v.nodeValue!==m.charData&&e.push(i({type:"characterData",target:v,oldValue:m.charData})),p&&s(p,r,y,S,T),n.descendents&&(v.childNodes.length||m.kids&&m.kids.length)&&l(v,m),x++,D++):(u=!0,d||(d={},p=[]),v&&(d[g=h(v)]||(d[g]=!0,(_=c(S,v,D))===-1?n.kids&&(e.push(i({type:"childList",target:r,addedNodes:[v],nextSibling:v.nextSibling,previousSibling:v.previousSibling})),T++):p.push({i:x,j:_})),x++),b&&b!==y[x]&&(d[g=h(b)]||(d[g]=!0,(_=f(y,b,x))===-1?n.kids&&(e.push(i({type:"childList",target:a.node,removedNodes:[b],nextSibling:S[D+1],previousSibling:S[D-1]})),T--):p.push({i:_,j:D})),D++));p&&s(p,r,y,S,T)}var u;return l(r,a),u}function u(t,e){var r=!0;return function i(t){var a={node:t};return!e.charData||3!==t.nodeType&&8!==t.nodeType?(e.attr&&r&&1===t.nodeType&&(a.attr=p(t.attributes,function(r,i){return e.afilter&&!e.afilter[i.name]||(r[i.name]=v(t,i)),r},{})),r&&(e.kids||e.charData||e.attr&&e.descendents)&&(a.kids=d(t.childNodes,i)),r=e.descendents):a.charData=t.nodeValue,a}(t)}function c(t,e,r){return f(t,e,r,_("node"))}function h(t){try{return t.id||(t[y]=t[y]||b++)}catch(e){try{return t.nodeValue}catch(r){return b++}}}function d(t,e){for(var r=[],i=0;i<t.length;i++)r[i]=e(t[i],i,t);return r}function p(t,e,r){for(var i=0;i<t.length;i++)r=e(r,t[i],i,t);return r}function f(t,e,r,i){for(;r<t.length;r++)if((i?t[r][i]:t[r])===e)return r;return-1}function g(e,r){return e[r]!==t}function _(t){return t}e._period=30,e.prototype={observe:function(t,e){for(var i={attr:!!(e.attributes||e.attributeFilter||e.attributeOldValue),kids:!!e.childList,descendents:!!e.subtree,charData:!(!e.characterData&&!e.characterDataOldValue)},n=this._watched,s=0;s<n.length;s++)n[s].tar===t&&n.splice(s,1);e.attributeFilter&&(i.afilter=p(e.attributeFilter,function(t,e){return t[e]=!0,t},{})),n.push({tar:t,fn:a(t,i)}),this._timeout||r(this)},takeRecords:function(){for(var t=[],e=this._watched,r=0;r<e.length;r++)e[r].fn(t);return t},disconnect:function(){this._watched=[],clearTimeout(this._timeout),this._timeout=null}};var m=document.createElement("i");m.style.top=0,m="null"!=m.attributes.style.value;var v=m?n:s,b=1,y="mo_id";return e}(void 0)),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),r=this,i=function(){},a=function(){return r.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,a.prototype=new i,a}),w.prototype.init=function(t){this.initPara(t),this.enable_visualize!==!1&&(window.self!==window.top&&e()?(this.is_editor=!0,b(this.vabtest_url)):(this.start_time=(new Date).getTime(),this.use_mask&&this.initMask(),this.addSinglePageListener()))},w.prototype.initPara=function(t){if(x.isFunction(t))try{t=t()}catch(e){return x.log("ABTesting SDK  !"),void(this.para=!1)}if(!x.isObject(t))return void(this.para=!1);Object.prototype.hasOwnProperty.call(t,"enable_visualize")&&x.isBoolean(t.enable_visualize)?this.enable_visualize=t.enable_visualize:x.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 enable_visualize \u683c\u5f0f\u4e0d\u6b63\u786e\u3002 \u7c7b\u578b\u5e94\u4e3a Boolean"),this.use_mask=x.isBoolean(t.use_mask)?t.use_mask:this.use_mask,this.timeout=x.isNumber(t.timeout)&&t.timeout<=5e3&&t.timeout>=0?t.timeout:this.timeout;var r=x.isString(t.vabtest_url)?t.vabtest_url:"";r&&("https:"===location.protocol?"https:"===r.slice(0,6)?this.vabtest_url=r:x.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 vabtest_url \u534f\u8bae\u5934\u5e94\u8bbe\u7f6e\u4e3a https"):"http:"===r.slice(0,5)||"https:"===r.slice(0,6)?this.vabtest_url=r:x.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 vabtest_url \u5e94\u8bbe\u7f6e\u4e3a\u6709\u6548 URL"))},w.prototype.resolve=function(t){if(this.enable_visualize!==!1&&this.is_editor!==!0&&this.isFirst!==!1){if((new Date).getTime()-this.start_time>this.timeout)return x.log("\u8bf7\u6c42\u5b9e\u9a8c\u7ed3\u679c\u8d85\u65f6\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01"),!1;var e=this;this.isFirst=!1,x.each(t,function(t){if(!x.isObject(t)||"VISUAL"!==t.experiment_type)return!1;var r=t.experiment_value;if(!x.isArray(r))try{r=JSON.parse(t.experiment_value),t.experiment_value=r}catch(i){return!1}e.isTriggerVisualExp(t)&&(e.render(t),e.visualExp=t,T.triggerHandle(t))})}},w.prototype.initMask=function(){var t=document.createElement("div");t.style.position="fixed",t.style.width="100%",t.style.height="100%",t.style.top="0px",t.style.left="0px",t.style.background="#fff",this.mask_instance=new T.Mask(t),this.mask_instance.show(this.timeout)},w.prototype.destroyMask=function(){this.mask_instance.remove()},w.prototype.render=function(t){var e=this;r(window,function(){var r=t.experiment_value;x.isArray(r)&&x.each(r,function(t){var r=t.selector,i=u(r);if(i)try{var a=S(i,[]),n=a.eleInfo;_(i,t,n),e.originData.push(a)}catch(s){}}),e.use_mask&&e.destroyMask(),e.is_have_observer||(e.is_have_observer=!0,y(e.observerCallback.bind(e)))})},w.prototype.restoreElements=function(){x.each(this.originData,function(t){k(t)}),this.visualExp=null,this.isFirst=!0,this.start_time=(new Date).getTime(),this.originData=[]},w.prototype.addSinglePageListener=function(){var t=this;x.addSinglePageEvent(function(e){return e!==location.href&&(t.restoreElements(),t.resolve(T.originalData),void(t.mask_instance&&t.destroyMask()))})},w.prototype.observerCallback=function(){this.visualExp&&(x.each(this.originData,function(t){k(t)}),this.originData=[],this.render(this.visualExp))},w.prototype.stopTrigger=function(){this.isFirst=!1,x.log("\u8bf7\u6c42\u5b9e\u9a8c\u7ed3\u679c\u5931\u8d25\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01"),this.use_mask&&this.destroyMask()},w.prototype.isTriggerVisualExp=function(t){return x.isString(t.control_link)&&x.isString(t.link_match_type)?!!x.checkUrlIsMatch(t.control_link,t.link_match_type)||(x.log("\u53ef\u89c6\u5316\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",t.abtest_experiment_id),!1):(x.log("\u53ef\u89c6\u5316\u8bd5\u9a8c\u6570\u636e\u5f02\u5e38",t.abtest_experiment_id),!1)};var L=new w;return T.dealResponseData=function(t,e){x.isObject(t)?"SUCCESS"===t.status?x.isArray(t.results)&&(this.originalData=t.results,this.updateLocalData(t.results,e)):"FAILED"===t.status&&x.log("\u83b7\u53d6\u8bd5\u9a8c\u5931\u8d25\uff1aerror_type\uff1a"+t.error_type+",error\uff1a"+t.error):x.log("\u8bd5\u9a8c\u6570\u636e\u89e3\u6790\u5931\u8d25\uff0cresponse \uff1a",t)},T.updateLocalData=function(t,e){this.analyzeData(t),this.updateStorage(e),x.log("\u66f4\u65b0\u8bd5\u9a8c\u6570\u636e\u6210\u529f")},T.updateStorage=function(t){var e=(new Date).getTime(),r={data:this.originalData,updateTime:e,triggerList:this.triggerList,distinct_id:t||T.sd.store.getDistinctId()};this.setStorageData(r),this.updateTime=e},T.analyzeData=function(t){return x.isArray(t)?(T.link.resolve(t),L.resolve(t),void T.resolveVariables(t)):(x.log("\u89e3\u6790——\u6570\u636e\u683c\u5f0f\u9519\u8bef",t),!1)},T.triggerHandle=function(t,e){var r=x.isObject(e)&&x.isObject(e.properties)?e.properties:{},i=T.trackTestTrigger(t,r),a=t.abtest_experiment_id;if(x.isString(a)){var n=T.sd.store.getDistinctId();this.triggerList[n]&&x.isArray(this.triggerList[n])?(this.triggerList[n].push(a),this.triggerList[n]=x.unique(this.triggerList[n])):this.triggerList[n]=[a],this.updateStorage()}return i},T.trackTestTrigger=function(t,e){var r=T.sd.store.getDistinctId(),i=!0,a=!0;if(e=x.isObject(e)?e:{},!t.is_white_list){if(this.triggerList&&x.isObject(this.triggerList)&&("{}"!==JSON.stringify(this.triggerList)&&(a=!1),this.triggerList[r]&&x.isArray(this.triggerList[r])&&x.each(this.triggerList[r],function(e){e===t.abtest_experiment_id&&(i=!1)})),i){var n={$abtest_experiment_id:t.abtest_experiment_id,$abtest_experiment_group_id:t.abtest_experiment_group_id};if(T.para.collect_bridge_status&&(n.$sdk_bridge_status=T.bridgeState),a){var s="web_abtesting:"+this.lib_version;n.$lib_plugin_version=[s]}var o=x.extend(n,e);this.sd.track("$ABTestTrigger",o)}return i}},T.checkSADebug=function(){var t=x.getQueryParam(location.href,"sensors_abtest_url"),e=x.getQueryParam(location.href,"feature_code"),r=+x.getQueryParam(location.href,"account_id");if(t.length&&e.length&&x.isNumber(r)&&0!==r){var i={distinct_id:T.sd.store.getDistinctId(),feature_code:e,account_id:r};T.sd._.ajax({url:t,type:"POST",data:JSON.stringify(i),credentials:!1,contentType:"application/json",timeout:T.para.timeout_milliseconds,cors:!0,success:function(){},error:function(t){x.log("distinct_id\u53d1\u9001\u5931\u8d25,err:",t)}})}},T.initMethods=function(t){var e=["asyncFetchABTest","fastFetchABTest","fetchCacheABTest"];x.each(e,function(e){T[e]=t.methods[e]})},T.fetchData={timer:null,method:null,context:null,init:function(t,e){this.method=t,this.context=e,this.start(!0)},getServerData:function(t){t?this.method.call(this.context,{suc:function(e){t&&("ab_bridge_ok"===T.bridgeState&&(e=e.data),x.isObject(e)&&"SUCCESS"===e.status&&x.isArray(e.results)||(T.link.stopTrigger(),L.stopTrigger()))},err:function(){t&&(T.link.stopTrigger(),L.stopTrigger())}}):this.method.call(this.context)},setNextFetch:function(t){var e=this,r=t||T.para.update_interval;this.clearFetchTimer(this.timer),this.timer=setTimeout(function(){e.getServerData()},r)},start:function(t){var e=null,r=(new Date).getTime(),i=T.getStorageData(),a=T.sd.store.getDistinctId();if(i&&x.isObject(i)&&i.distinct_id===a)if(e=i.updateTime,t&&(T.originalData=i.data,e&&x.isNumber(e)&&r-e>0&&r-e<T.para.session_limit&&x.isObject(i.triggerList)&&(T.triggerList=i.triggerList),T.analyzeData(i.data)),e&&x.isNumber(e)&&r-e>0&&r-e<T.para.update_interval){x.log("\u6570\u636e\u4e0d\u66f4\u65b0",e,r);var n=r-e,s=T.para.update_interval-n;this.setNextFetch(s)}else x.log("\u7f13\u5b58\u6570\u636e\u8d85\u65f6",e,r),this.getServerData(t);else e=T.updateTime,e&&x.isNumber(e)&&r-e>0&&r-e<T.para.update_interval?x.log("\u6570\u636e\u4e0d\u66f4\u65b0",e,r):this.getServerData(t)},stop:function(){x.log("\u6e05\u7a7a\u62c9\u53d6\u5b9a\u65f6\u5668"),this.clearFetchTimer()},clearFetchTimer:function(){clearTimeout(this.timer),this.timer=null}},T.store={init:function(t,e){T.fetchData.init(t,e),T.initMethods(e),T.listenPageState({visible:function(){x.log("\u9875\u9762\u663e\u793a"),T.fetchData.start()},hidden:function(){T.fetchData.stop()}}),T.sd.events.on("changeDistinctId",function(t){T.localdata={},T.originalData=[],L.restoreElements(),T.updateStorage(),T.fetchData.getServerData()}),T.sd.events.isReady()}},T.init=function(t,e){return this.sd?(this.log("A/B Testing SDK \u91cd\u590d\u521d\u59cb\u5316\uff01\u53ea\u6709\u7b2c\u4e00\u6b21\u521d\u59cb\u5316\u6709\u6548\uff01"),!1):(x.log=function(){return x.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]),t.log.apply(this,arguments)},this.getSA(t)?x.isObject(e)?("object"==typeof localStorage&&this.sd._.localStorage.isSupport()||(x.log("localstorage\u5f02\u5e38"),this.state.storage.isSupport=!1),this.abtestingPara=e,void this.initTest()):(x.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f20\u5165\u6b63\u786e\u7684\u521d\u59cb\u5316\u53c2\u6570!para:",e),!1):(this.log("A/B Testing \u521d\u59cb\u5316\u5931\u8d25,Web JS SDK \u6ca1\u6709\u521d\u59cb\u5316\u5b8c\u6210"),!1))},T.initTest=function(){this.link.init(this.abtestingPara.multilink),L.init(this.abtestingPara.visualize),this.sd.bridge.is_verify_success?this.bridgeStore.init(this.abtestingPara):this.normalStore.init(this.abtestingPara)},window.SensorsDataWebJSSDKPlugin&&"[object Object]"==Object.prototype.toString.call(window.SensorsDataWebJSSDKPlugin)?window.SensorsDataWebJSSDKPlugin.SensorsABTest=window.SensorsDataWebJSSDKPlugin.SensorsABTest||T:window.SensorsDataWebJSSDKPlugin={SensorsABTest:T},T});